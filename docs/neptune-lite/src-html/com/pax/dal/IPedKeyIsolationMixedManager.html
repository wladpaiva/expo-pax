<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet_en.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>/*<a name="line.1"></a>
<span class="sourceLineNo">002</span> * ===========================================================================================<a name="line.2"></a>
<span class="sourceLineNo">003</span> * = COPYRIGHT<a name="line.3"></a>
<span class="sourceLineNo">004</span> *          PAX Computer Technology (Shenzhen) Co., Ltd. PROPRIETARY INFORMATION<a name="line.4"></a>
<span class="sourceLineNo">005</span> *   This software is supplied under the terms of a license agreement or nondisclosure<a name="line.5"></a>
<span class="sourceLineNo">006</span> *   agreement with PAX Computer Technology (Shenzhen) Co., Ltd. and may not be copied or<a name="line.6"></a>
<span class="sourceLineNo">007</span> *   disclosed except in accordance with the terms in that agreement.<a name="line.7"></a>
<span class="sourceLineNo">008</span> *     Copyright (C) 2017-2023 PAX Computer Technology (Shenzhen) Co., Ltd. All rights reserved.<a name="line.8"></a>
<span class="sourceLineNo">009</span> * Description: // Detail description about the function of this module,<a name="line.9"></a>
<span class="sourceLineNo">010</span> *             // interfaces with the other modules, and dependencies.<a name="line.10"></a>
<span class="sourceLineNo">011</span> * Revision History:<a name="line.11"></a>
<span class="sourceLineNo">012</span> * Date                         Author                        Action<a name="line.12"></a>
<span class="sourceLineNo">013</span> * 2017/04/01                   PAX                     Create/Add/Modify/Delete<a name="line.13"></a>
<span class="sourceLineNo">014</span> * ===========================================================================================<a name="line.14"></a>
<span class="sourceLineNo">015</span> */<a name="line.15"></a>
<span class="sourceLineNo">016</span><a name="line.16"></a>
<span class="sourceLineNo">017</span>package com.pax.dal;<a name="line.17"></a>
<span class="sourceLineNo">018</span><a name="line.18"></a>
<span class="sourceLineNo">019</span><a name="line.19"></a>
<span class="sourceLineNo">020</span>import com.pax.dal.entity.DUKPTResult;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import com.pax.dal.entity.EAesCheckMode;<a name="line.21"></a>
<span class="sourceLineNo">022</span>import com.pax.dal.entity.EAlgorithmType;<a name="line.22"></a>
<span class="sourceLineNo">023</span>import com.pax.dal.entity.ECheckMode;<a name="line.23"></a>
<span class="sourceLineNo">024</span>import com.pax.dal.entity.EKeyCode;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import com.pax.dal.entity.EPedKeyType;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import com.pax.dal.entity.EPedMacMode;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import com.pax.dal.entity.EPedType;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import com.pax.dal.entity.RSAKeyInfo;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import com.pax.dal.entity.RSARecoverInfo;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import com.pax.dal.exceptions.EPedDevException;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import com.pax.dal.exceptions.PedDevException;<a name="line.31"></a>
<span class="sourceLineNo">032</span><a name="line.32"></a>
<span class="sourceLineNo">033</span><a name="line.33"></a>
<span class="sourceLineNo">034</span>/**<a name="line.34"></a>
<span class="sourceLineNo">035</span> * &lt;div class="zh"&gt;PED密钥隔离混合管理模块。&lt;/div&gt;<a name="line.35"></a>
<span class="sourceLineNo">036</span> * &lt;div class="en"&gt;The PED key isolation mixed manager module. &lt;/div&gt;<a name="line.36"></a>
<span class="sourceLineNo">037</span> */<a name="line.37"></a>
<span class="sourceLineNo">038</span>public interface IPedKeyIsolationMixedManager {<a name="line.38"></a>
<span class="sourceLineNo">039</span><a name="line.39"></a>
<span class="sourceLineNo">040</span>    /**<a name="line.40"></a>
<span class="sourceLineNo">041</span>     * &lt;div class="zh"&gt; 设置输入PIN监听器。 &lt;/div&gt;<a name="line.41"></a>
<span class="sourceLineNo">042</span>     * &lt;div class="en"&gt; Set the input PIN listener. &lt;/div&gt;<a name="line.42"></a>
<span class="sourceLineNo">043</span>     * @param listener<a name="line.43"></a>
<span class="sourceLineNo">044</span>     *            {@link IPed.IPedInputPinListener}<a name="line.44"></a>
<span class="sourceLineNo">045</span>     *<a name="line.45"></a>
<span class="sourceLineNo">046</span>     */<a name="line.46"></a>
<span class="sourceLineNo">047</span>    void setInputPinListener(IPed.IPedInputPinListener listener);<a name="line.47"></a>
<span class="sourceLineNo">048</span><a name="line.48"></a>
<span class="sourceLineNo">049</span><a name="line.49"></a>
<span class="sourceLineNo">050</span><a name="line.50"></a>
<span class="sourceLineNo">051</span>    /**<a name="line.51"></a>
<span class="sourceLineNo">052</span>     * &lt;div class="zh"&gt;使用 AES DUKPT 的数据加解密密钥，对输入缓存内数据进行加密或解密。&lt;/div&gt;<a name="line.52"></a>
<span class="sourceLineNo">053</span>     * &lt;div class="en"&gt;Use the AES DUKPT data encryption and decryption key to encrypt or decrypt the data in the input buffer.&lt;/div&gt;<a name="line.53"></a>
<span class="sourceLineNo">054</span>     *<a name="line.54"></a>
<span class="sourceLineNo">055</span>     * @param groupIndex    &lt;div class="zh"&gt;AES DUKPT密钥组索引。范围1~40。&lt;/div&gt; &lt;div class="en"&gt;AES DUKPT key group index. The range is 1~40.&lt;/div&gt;<a name="line.55"></a>
<span class="sourceLineNo">056</span>     * @param keyVarType    &lt;div class="zh"&gt;<a name="line.56"></a>
<span class="sourceLineNo">057</span>     *                                             &lt;ul&gt;<a name="line.57"></a>
<span class="sourceLineNo">058</span>     *                                               &lt;li&gt;0x01: 用 AES DUKPT 数据加解密密钥运算。&lt;/li&gt;<a name="line.58"></a>
<span class="sourceLineNo">059</span>     *                                               &lt;li&gt;0x04: 使用应答数据密钥，仅支持加密模式，即mode 值只能为 0x01、0x03。&lt;/li&gt;<a name="line.59"></a>
<span class="sourceLineNo">060</span>     *                                               &lt;li&gt;0x05: 使用请求数据密钥，仅支持解密模式，即mode 值只能为 0x00、0x02。&lt;/li&gt;<a name="line.60"></a>
<span class="sourceLineNo">061</span>     *                                             &lt;/ul&gt;<a name="line.61"></a>
<span class="sourceLineNo">062</span>     *                                           &lt;/div&gt; &lt;div class="en"&gt;<a name="line.62"></a>
<span class="sourceLineNo">063</span>     *                                             &lt;ul&gt;<a name="line.63"></a>
<span class="sourceLineNo">064</span>     *                                               &lt;li&gt;0x01: Use AES DUKPT data encryption and decryption key operations.&lt;/li&gt;<a name="line.64"></a>
<span class="sourceLineNo">065</span>     *                                               &lt;li&gt;0x04: Using the response data key, only supports the encryption mode, that is, the mode value can only be 0x01, 0x03.&lt;/li&gt;<a name="line.65"></a>
<span class="sourceLineNo">066</span>     *                                               &lt;li&gt;0x05: When using the requested data key, only the decryption mode is supported, that is, the mode value can only be 0x00, 0x02.&lt;/li&gt;<a name="line.66"></a>
<span class="sourceLineNo">067</span>     *                                             &lt;/ul&gt;<a name="line.67"></a>
<span class="sourceLineNo">068</span>     *                                               &lt;/div&gt;<a name="line.68"></a>
<span class="sourceLineNo">069</span>     * @param iv            &lt;div class="zh"&gt; 8/16字节初始向量，CBC加解密时需要，如果传入NULL，将默认用“\x00\x00\x00\x00\x00\x00\x00\x00”或<a name="line.69"></a>
<span class="sourceLineNo">070</span>     *                                        “\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00”作为初始向量 &lt;/div&gt;<a name="line.70"></a>
<span class="sourceLineNo">071</span>     *                                        &lt;div class="en"&gt; 8/16 bytes initialization vector, used for CBC encryption or decryption. If set it to NULL,<a name="line.71"></a>
<span class="sourceLineNo">072</span>     *                                        it will use “\x00\x00\x00\x00\x00\x00\x00\x00” or “\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00”<a name="line.72"></a>
<span class="sourceLineNo">073</span>     *                                        as the initialization vector by default. &lt;/div&gt;<a name="line.73"></a>
<span class="sourceLineNo">074</span>     * @param dataIn        &lt;div class="zh"&gt;需要进行运算的数据。数据长度&lt;=8192，8(TDES)/16(AES)整除。&lt;/div&gt; &lt;div class="en"&gt;The data to be calculated. Data length&lt;=8192, evenly divided by 8(TDES)/16(AES).&lt;/div&gt;<a name="line.74"></a>
<span class="sourceLineNo">075</span>     * @param algorithmType &lt;div class="zh"&gt;<a name="line.75"></a>
<span class="sourceLineNo">076</span>     *                                             &lt;ul&gt;<a name="line.76"></a>
<span class="sourceLineNo">077</span>     *                                               &lt;li&gt;为{@link EAlgorithmType#_2TDEA_}或{@link EAlgorithmType#_3TDEA_}时，使用TDES算法计算。&lt;/li&gt;<a name="line.77"></a>
<span class="sourceLineNo">078</span>     *                                               &lt;li&gt;为{@link EAlgorithmType#_AES128_}或{@link EAlgorithmType#_AES192_}或{@link EAlgorithmType#_AES256_}时，使用AES算法计算。&lt;/li&gt;<a name="line.78"></a>
<span class="sourceLineNo">079</span>     *                                             &lt;/ul&gt;<a name="line.79"></a>
<span class="sourceLineNo">080</span>     *                                           &lt;/div&gt; &lt;div class="en"&gt;<a name="line.80"></a>
<span class="sourceLineNo">081</span>     *                                             &lt;ul&gt;<a name="line.81"></a>
<span class="sourceLineNo">082</span>     *                                               &lt;li&gt;When it is {@link EAlgorithmType#_2TDEA_} or {@link EAlgorithmType#_3TDEA_}, use the TDES algorithm for calculation.&lt;/li&gt;<a name="line.82"></a>
<span class="sourceLineNo">083</span>     *                                               &lt;li&gt;When it is {@link EAlgorithmType#_AES128_} or {@link EAlgorithmType#_AES192_} or {@link EAlgorithmType#_AES256_}, use the AES algorithm for calculation.&lt;/li&gt;<a name="line.83"></a>
<span class="sourceLineNo">084</span>     *                                             &lt;/ul&gt;<a name="line.84"></a>
<span class="sourceLineNo">085</span>     *                                               &lt;/div&gt;<a name="line.85"></a>
<span class="sourceLineNo">086</span>     * @param mode          &lt;div class="zh"&gt;<a name="line.86"></a>
<span class="sourceLineNo">087</span>     *                                             &lt;ul&gt;<a name="line.87"></a>
<span class="sourceLineNo">088</span>     *                                               &lt;li&gt;0x00: ECB 解密&lt;/li&gt;<a name="line.88"></a>
<span class="sourceLineNo">089</span>     *                                               &lt;li&gt;0x01: ECB 加密&lt;/li&gt;<a name="line.89"></a>
<span class="sourceLineNo">090</span>     *                                               &lt;li&gt;0x02: CBC 解密&lt;/li&gt;<a name="line.90"></a>
<span class="sourceLineNo">091</span>     *                                               &lt;li&gt;0x03: CBC 加密&lt;/li&gt;<a name="line.91"></a>
<span class="sourceLineNo">092</span>     *                                             &lt;/ul&gt;<a name="line.92"></a>
<span class="sourceLineNo">093</span>     *                                           &lt;/div&gt; &lt;div class="en"&gt;<a name="line.93"></a>
<span class="sourceLineNo">094</span>     *                                             &lt;ul&gt;<a name="line.94"></a>
<span class="sourceLineNo">095</span>     *                                               &lt;li&gt;0x00: ECB decryption.&lt;/li&gt;<a name="line.95"></a>
<span class="sourceLineNo">096</span>     *                                               &lt;li&gt;0x01: ECB encryption.&lt;/li&gt;<a name="line.96"></a>
<span class="sourceLineNo">097</span>     *                                               &lt;li&gt;0x02: CBC decryption.&lt;/li&gt;<a name="line.97"></a>
<span class="sourceLineNo">098</span>     *                                               &lt;li&gt;0x03: CBC encryption.&lt;/li&gt;<a name="line.98"></a>
<span class="sourceLineNo">099</span>     *                                             &lt;/ul&gt;<a name="line.99"></a>
<span class="sourceLineNo">100</span>     *                                               &lt;/div&gt;<a name="line.100"></a>
<span class="sourceLineNo">101</span>     * @return {@link DUKPTResult}<a name="line.101"></a>
<span class="sourceLineNo">102</span>     * @throws PedDevException PedDevException<a name="line.102"></a>
<span class="sourceLineNo">103</span>     * @since V4.00.00<a name="line.103"></a>
<span class="sourceLineNo">104</span>     */<a name="line.104"></a>
<span class="sourceLineNo">105</span>    DUKPTResult calcAesDUKPTData(byte groupIndex, byte keyVarType, byte[] iv, byte[] dataIn,<a name="line.105"></a>
<span class="sourceLineNo">106</span>                                 EAlgorithmType algorithmType, byte mode) throws PedDevException;<a name="line.106"></a>
<span class="sourceLineNo">107</span><a name="line.107"></a>
<span class="sourceLineNo">108</span><a name="line.108"></a>
<span class="sourceLineNo">109</span><a name="line.109"></a>
<span class="sourceLineNo">110</span>    /**<a name="line.110"></a>
<span class="sourceLineNo">111</span>     * &lt;div class="zh"&gt;使用 AES DUKPT 的 MAC 密钥计算 MAC。&lt;/div&gt; &lt;div class="en"&gt;Use AES DUKPT's MAC key to calculate MAC.&lt;/div&gt;<a name="line.111"></a>
<span class="sourceLineNo">112</span>     *<a name="line.112"></a>
<span class="sourceLineNo">113</span>     * @param groupIndex    &lt;div class="zh"&gt;AES DUKPT密钥组索引。范围1~40。&lt;/div&gt; &lt;div class="en"&gt;AES DUKPT key group index. The range is 1~40.&lt;/div&gt;<a name="line.113"></a>
<span class="sourceLineNo">114</span>     * @param dataIn        &lt;div class="zh"&gt;要进行 MAC 运算的数据内容。数据的长度&lt;=2048，长度不能被 8(TDES)/16(AES)整除，则自动补 0x00。&lt;/div&gt;<a name="line.114"></a>
<span class="sourceLineNo">115</span>     *                     &lt;div class="en"&gt;The data content to be MAC operation. The length of the data &lt;=2048, and the length cannot be divisible by 8(TDES)/16(AES), then 0x00 will be automatically added.&lt;/div&gt;<a name="line.115"></a>
<span class="sourceLineNo">116</span>     * @param algorithmType &lt;div class="zh"&gt;<a name="line.116"></a>
<span class="sourceLineNo">117</span>     *                        &lt;ul&gt;<a name="line.117"></a>
<span class="sourceLineNo">118</span>     *                          &lt;li&gt;为{@link EAlgorithmType#_2TDEA_}或{@link EAlgorithmType#_3TDEA_}时，使用TDES算法计算。&lt;/li&gt;<a name="line.118"></a>
<span class="sourceLineNo">119</span>     *                          &lt;li&gt;为{@link EAlgorithmType#_AES128_}或{@link EAlgorithmType#_AES192_}或{@link EAlgorithmType#_AES256_}时，使用AES算法计算。&lt;/li&gt;<a name="line.119"></a>
<span class="sourceLineNo">120</span>     *                          &lt;li&gt;为{@link EAlgorithmType#_HMAC128_}或{@link EAlgorithmType#_HMAC192_}或{@link EAlgorithmType#_HMAC256_}时，仅支持HMAC-SHA256算法计算。即mode为0x25/0x45/0x65。&lt;/li&gt;<a name="line.120"></a>
<span class="sourceLineNo">121</span>     *                        &lt;/ul&gt;<a name="line.121"></a>
<span class="sourceLineNo">122</span>     *                      &lt;/div&gt; &lt;div class="en"&gt;<a name="line.122"></a>
<span class="sourceLineNo">123</span>     *                        &lt;ul&gt;<a name="line.123"></a>
<span class="sourceLineNo">124</span>     *                          &lt;li&gt;When it is {@link EAlgorithmType#_2TDEA_} or {@link EAlgorithmType#_3TDEA_}, use the TDES algorithm for calculation.&lt;/li&gt;<a name="line.124"></a>
<span class="sourceLineNo">125</span>     *                          &lt;li&gt;When it is {@link EAlgorithmType#_AES128_} or {@link EAlgorithmType#_AES192_} or {@link EAlgorithmType#_AES256_}, use the AES algorithm for calculation.&lt;/li&gt;<a name="line.125"></a>
<span class="sourceLineNo">126</span>     *                          &lt;li&gt;When it is {@link EAlgorithmType#_HMAC128_} or {@link EAlgorithmType#_HMAC192_} or {@link EAlgorithmType#_HMAC256_}, only HMAC-SHA256 algorithm calculation is supported. That is, the mode is 0x25/0x45/0x65.&lt;/li&gt;<a name="line.126"></a>
<span class="sourceLineNo">127</span>     *                        &lt;/ul&gt;<a name="line.127"></a>
<span class="sourceLineNo">128</span>     *                      &lt;/div&gt;<a name="line.128"></a>
<span class="sourceLineNo">129</span>     * @param mode          &lt;div class="zh"&gt;<a name="line.129"></a>
<span class="sourceLineNo">130</span>     *                        &lt;ul&gt;<a name="line.130"></a>
<span class="sourceLineNo">131</span>     *                          &lt;li&gt;0x20: 根据ANSI X9.9规范，将 BLOCK1 用 MAC密钥做 TDES/AES 加密，加密结果与 BLOCK2进行逐位异或后再用MAC密钥做 TDES/AES加密，依次进行得到 8(TDES)/16(AES)字节的加密结果。 KSN 不自动加 1。&lt;/li&gt;<a name="line.131"></a>
<span class="sourceLineNo">132</span>     *                          &lt;li&gt;0x21: Hypercom Fast Mode，将 BLOCK1 和BLOCK2 进行逐位异或，异或结果与 BLOCK3进 行 逐 位 异 或 ， 依 次 进 行 ， 最 后 得 到8(TDES)/16(AES)字节的异或结果，将该结果用MAC 密钥进行 TDES/AES 加密运算。KSN 不自动加 1。&lt;/li&gt;<a name="line.132"></a>
<span class="sourceLineNo">133</span>     *                          &lt;li&gt;0x22: 根据 ANSIX9.19 规范，将 BLOCK1 用MAC密钥做DES 加密(只取前8个字节的key)，加密结果与 BLOCK2 进行逐位异或后再用MAC 密钥做 DES 加密，依次进行得到 8 字节的加密结果，直到最后一次采用 TDES 加密。 KSN不自动加 1。 (不支持 AES 算法。)&lt;/li&gt;<a name="line.133"></a>
<span class="sourceLineNo">134</span>     *                          &lt;li&gt;0x23: CMAC算法。 KSN不自动加1。其它值保留扩展MAC算法。&lt;/li&gt;<a name="line.134"></a>
<span class="sourceLineNo">135</span>     *                          &lt;li&gt;0x25: HMAC-SHA256算法。 KSN不自动加1。&lt;/li&gt;<a name="line.135"></a>
<span class="sourceLineNo">136</span>     *                          &lt;li&gt;0x40: 根据ANSI X9.9规范，将 BLOCK1 用 MAC密钥做 TDES/AES 加密，加密结果与 BLOCK2进行逐位异或后再用MAC密钥做 TDES/AES加密，依次进行得到 8(TDES)/16(AES)字节的加密结果。 KSN 不自动加 1。&lt;/li&gt;<a name="line.136"></a>
<span class="sourceLineNo">137</span>     *                          &lt;li&gt;0x41: Hypercom Fast Mode，将 BLOCK1 和BLOCK2 进行逐位异或，异或结果与 BLOCK3进 行 逐 位 异 或 ， 依 次 进 行 ， 最 后 得 到8(TDES)/16(AES)字节的异或结果，将该结果用MAC 密钥进行 TDES/AES 加密运算。KSN 不自动加 1 。&lt;/li&gt;<a name="line.137"></a>
<span class="sourceLineNo">138</span>     *                          &lt;li&gt;0x42: 根据 ANSIX9.19 规范，将 BLOCK1 用MAC密钥做DES 加密(只取前8个字节的key)，加密结果与 BLOCK2 进行逐位异或后再用MAC 密钥做 DES 加密，依次进行得到 8 字节的加密结果，直到最后一次采用 TDES 加密。 KSN不自动加 1。 (不支持 AES 算法。) &lt;/li&gt;<a name="line.138"></a>
<span class="sourceLineNo">139</span>     *                          &lt;li&gt;0x43: CMAC算法。 KSN不自动加1。其它值保留扩展MAC算法。&lt;/li&gt;<a name="line.139"></a>
<span class="sourceLineNo">140</span>     *                          &lt;li&gt;0x45: HMAC-SHA256算法。 KSN不自动加1。&lt;/li&gt;<a name="line.140"></a>
<span class="sourceLineNo">141</span>     *                          &lt;li&gt;0x60: 据ANSI X9.9规范，将 BLOCK1 用 MAC密钥做 TDES/AES 加密，加密结果与 BLOCK2进行逐位异或后再用MAC密钥做 TDES/AES加密，依次进行得到 8(TDES)/16(AES)字节的加密结果。 KSN 不自动加 1。&lt;/li&gt;<a name="line.141"></a>
<span class="sourceLineNo">142</span>     *                          &lt;li&gt;0x61: Hypercom Fast Mode，将 BLOCK1 和BLOCK2 进行逐位异或，异或结果与 BLOCK3进 行 逐 位 异 或 ， 依 次 进 行 ， 最 后 得 到8(TDES)/16(AES)字节的异或结果，将该结果用MAC 密钥进行 TDES/AES 加密运算。KSN 不自动加 1。&lt;/li&gt;<a name="line.142"></a>
<span class="sourceLineNo">143</span>     *                          &lt;li&gt;0x62: 根据 ANSIX9.19 规范，将 BLOCK1 用MAC密钥做DES 加密(只取前8个字节的key)，加密结果与 BLOCK2 进行逐位异或后再用MAC 密钥做 DES 加密，依次进行得到 8 字节的加密结果，直到最后一次采用 TDES 加密。 KSN不自动加 1。 (不支持 AES 算法。) &lt;/li&gt;<a name="line.143"></a>
<span class="sourceLineNo">144</span>     *                          &lt;li&gt;0x63: CMAC算法。KSN不自动加1。 其它值保留扩展MAC算法。&lt;/li&gt;<a name="line.144"></a>
<span class="sourceLineNo">145</span>     *                          &lt;li&gt;0x65: HMAC-SHA256算法。 KSN不自动加1。&lt;/li&gt;<a name="line.145"></a>
<span class="sourceLineNo">146</span>     *                        &lt;/ul&gt;<a name="line.146"></a>
<span class="sourceLineNo">147</span>     *                      &lt;/div&gt; &lt;div class="en"&gt;<a name="line.147"></a>
<span class="sourceLineNo">148</span>     *                        &lt;ul&gt;<a name="line.148"></a>
<span class="sourceLineNo">149</span>     *                          &lt;li&gt;0x20: According to the ANSI X9.9 specification, BLOCK1 is encrypted with MAC key for TDES/AES, the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for TDES/AES encryption, and then proceed to get 8(TDES)/16( AES) byte encryption result. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.149"></a>
<span class="sourceLineNo">150</span>     *                          &lt;li&gt;0x21: In Hypercom Fast Mode, BLOCK1 and BLOCK2 are XORed bit by bit, and the XOR result is XORed bit by bit with BLOCK3, and then proceeded in sequence. Finally, an XOR result of 8 (TDES)/16 (AES) bytes is obtained. Use this result The MAC key performs TDES/AES encryption operations. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.150"></a>
<span class="sourceLineNo">151</span>     *                          &lt;li&gt;0x22: According to the ANSIX9.19 specification, BLOCK1 is encrypted with MAC key for DES (only the key of the first 8 bytes is taken), and the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for DES encryption, and then proceed to get 8 The result of byte encryption until the last TDES encryption. KSN does not automatically increase by 1. (The AES algorithm is not supported.)&lt;/li&gt;<a name="line.151"></a>
<span class="sourceLineNo">152</span>     *                          &lt;li&gt;0x23: CMAC algorithm. KSN does not automatically increase by 1. Other values retain the extended MAC algorithm.&lt;/li&gt;<a name="line.152"></a>
<span class="sourceLineNo">153</span>     *                          &lt;li&gt;0x25: HMAC-SHA256 algorithm. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.153"></a>
<span class="sourceLineNo">154</span>     *                          &lt;li&gt;0x40: According to the ANSI X9.9 specification, BLOCK1 is encrypted with MAC key for TDES/AES, the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for TDES/AES encryption, and then proceed to get 8(TDES)/16( AES) byte encryption result. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.154"></a>
<span class="sourceLineNo">155</span>     *                          &lt;li&gt;0x41: In Hypercom Fast Mode, BLOCK1 and BLOCK2 are XORed bit by bit, and the XOR result is XORed bit by bit with BLOCK3, and then proceeded in sequence. Finally, an XOR result of 8 (TDES)/16 (AES) bytes is obtained. Use this result The MAC key performs TDES/AES encryption operations. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.155"></a>
<span class="sourceLineNo">156</span>     *                          &lt;li&gt;0x42: According to the ANSIX9.19 specification, BLOCK1 is encrypted with MAC key for DES (only the key of the first 8 bytes is taken), and the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for DES encryption, and then proceed to get 8 The result of byte encryption until the last TDES encryption. KSN does not automatically increase by 1. (The AES algorithm is not supported.)&lt;/li&gt;<a name="line.156"></a>
<span class="sourceLineNo">157</span>     *                          &lt;li&gt;0x43: CMAC algorithm. KSN does not automatically increase by 1. Other values retain the extended MAC algorithm.&lt;/li&gt;<a name="line.157"></a>
<span class="sourceLineNo">158</span>     *                          &lt;li&gt;0x45: HMAC-SHA256 algorithm. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.158"></a>
<span class="sourceLineNo">159</span>     *                          &lt;li&gt;0x60: According to the ANSI X9.9 specification, BLOCK1 is encrypted with MAC key for TDES/AES, the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for TDES/AES encryption, and then proceed to get 8(TDES)/16( AES) byte encryption result. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.159"></a>
<span class="sourceLineNo">160</span>     *                          &lt;li&gt;0x61: In Hypercom Fast Mode, BLOCK1 and BLOCK2 are XORed bit by bit, and the XOR result is XORed bit by bit with BLOCK3, and then proceeded in sequence. Finally, an XOR result of 8 (TDES)/16 (AES) bytes is obtained. Use this result The MAC key performs TDES/AES encryption operations. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.160"></a>
<span class="sourceLineNo">161</span>     *                          &lt;li&gt;0x62: According to the ANSIX9.19 specification, BLOCK1 is encrypted with MAC key for DES (only the key of the first 8 bytes is taken), and the encrypted result is XORed with BLOCK2 bit by bit, and then the MAC key is used for DES encryption, and then proceed to get 8 The result of byte encryption until the last TDES encryption. KSN does not automatically increase by 1. (The AES algorithm is not supported.)&lt;/li&gt;<a name="line.161"></a>
<span class="sourceLineNo">162</span>     *                          &lt;li&gt;0x63: CMAC algorithm. KSN does not automatically increase by 1. Other values retain the extended MAC algorithm.&lt;/li&gt;<a name="line.162"></a>
<span class="sourceLineNo">163</span>     *                          &lt;li&gt;0x65: HMAC-SHA256 algorithm. KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.163"></a>
<span class="sourceLineNo">164</span>     *                        &lt;/ul&gt;<a name="line.164"></a>
<span class="sourceLineNo">165</span>     *                          &lt;/div&gt;<a name="line.165"></a>
<span class="sourceLineNo">166</span>     * @return {@link DUKPTResult} &lt;div class="zh"&gt;当mode等于HMAC-SHA256算法是，输出长度为32字节。&lt;/div&gt;<a name="line.166"></a>
<span class="sourceLineNo">167</span>     *         &lt;div class="en"&gt;When the mode is equal to the HMAC-SHA256 algorithm, the output length is 32 bytes.&lt;/div&gt;<a name="line.167"></a>
<span class="sourceLineNo">168</span>     * @throws PedDevException PedDevException<a name="line.168"></a>
<span class="sourceLineNo">169</span>     * @since V4.00.00<a name="line.169"></a>
<span class="sourceLineNo">170</span>     */<a name="line.170"></a>
<span class="sourceLineNo">171</span>    DUKPTResult getAesDUKPTMac(byte groupIndex, byte[] dataIn, EAlgorithmType algorithmType, byte mode) throws PedDevException;<a name="line.171"></a>
<span class="sourceLineNo">172</span><a name="line.172"></a>
<span class="sourceLineNo">173</span><a name="line.173"></a>
<span class="sourceLineNo">174</span>    /**<a name="line.174"></a>
<span class="sourceLineNo">175</span>     * &lt;div class="zh"&gt;在 PED 上输入 PIN,并使 AES DUKPT 的 PIN 密钥计算 PINBlock。&lt;/div&gt;<a name="line.175"></a>
<span class="sourceLineNo">176</span>     * &lt;div class="en"&gt;Enter the PIN on the PED, and use the PIN key of AES DUKPT to calculate the PINBlock.&lt;/div&gt;<a name="line.176"></a>
<span class="sourceLineNo">177</span>     *<a name="line.177"></a>
<span class="sourceLineNo">178</span>     * @param groupIndex    &lt;div class="zh"&gt;AES DUKPT密钥组索引。范围1~40。&lt;/div&gt; &lt;div class="en"&gt;AES DUKPT key group index. The range is 1~40.&lt;/div&gt;<a name="line.178"></a>
<span class="sourceLineNo">179</span>     * @param exPinLen      &lt;div class="zh"&gt;可输入的合法密码长度字符串，应用程序把允许的密码长度全部枚举出来，并且用","号隔开每个长度，密码长度的有效取值为：0，4~12。若允许输入 4、6 位密码并且允许无密码直接按确认，则该字符串应该设置为"0，4，6"。<a name="line.179"></a>
<span class="sourceLineNo">180</span>     *                      若枚举 0 长度则示意可以不输任何数字而直接按确认键返回。若枚举字符串中存在长度的无效值，比如"2，6，7，10"，无效值将被忽略。&lt;/div&gt; &lt;div class="en"&gt;The valid password length string that can be entered, the application enumerates all the allowable password lengths,<a name="line.180"></a>
<span class="sourceLineNo">181</span>     *                      and separates each length with a "," sign. The valid value of the password length is 0, 4~12. If 4 or 6-digit passwords are allowed and you can press confirm without a password, the character string should be set to "0, 4, 6".<a name="line.181"></a>
<span class="sourceLineNo">182</span>     *                      If the length of the enumeration is 0, it means that you can directly press the enter key to return without entering any number. If there are invalid values of length in the enumerated string, such as "2, 6, 7, 10", the invalid value will be ignored.&lt;/div&gt;<a name="line.182"></a>
<span class="sourceLineNo">183</span>     * @param dataIn        &lt;div class="zh"&gt;<a name="line.183"></a>
<span class="sourceLineNo">184</span>     *                                             &lt;ul&gt;<a name="line.184"></a>
<span class="sourceLineNo">185</span>     *                                               &lt;li&gt;当mode=0x20时，dataIn指向卡号移位后生成的16位主帐号，不包含校验位。&lt;/li&gt;<a name="line.185"></a>
<span class="sourceLineNo">186</span>     *                                               &lt;li&gt;当mode=0x21时，dataIn未使用，但是不能为NULL。 &lt;/li&gt;<a name="line.186"></a>
<span class="sourceLineNo">187</span>     *                                               &lt;li&gt;当mode=0x22时，dataIn指向卡号移位后生成的16位主帐号，不包含校验位。&lt;/li&gt;<a name="line.187"></a>
<span class="sourceLineNo">188</span>     *                                               &lt;li&gt;当mode=0x23时，为交易流水号ISN [6 Bytes,ASCII码]。&lt;/li&gt;<a name="line.188"></a>
<span class="sourceLineNo">189</span>     *                                               &lt;li&gt;当mode=0x24时，dataIn为主账号。&lt;/li&gt;<a name="line.189"></a>
<span class="sourceLineNo">190</span>     *                                             &lt;/ul&gt;&lt;/div&gt;<a name="line.190"></a>
<span class="sourceLineNo">191</span>     *                                           &lt;div class="en"&gt;<a name="line.191"></a>
<span class="sourceLineNo">192</span>     *                                             &lt;ul&gt;<a name="line.192"></a>
<span class="sourceLineNo">193</span>     *                                               &lt;li&gt;When mode=0x20, dataIn points to the 16-bit primary account generated after the card number shift, excluding the check bit.&lt;/li&gt;<a name="line.193"></a>
<span class="sourceLineNo">194</span>     *                                               &lt;li&gt;When mode=0x21, dataIn is not in use, but cannot be NULL.&lt;/li&gt;<a name="line.194"></a>
<span class="sourceLineNo">195</span>     *                                               &lt;li&gt;When mode=0x22, dataIn points to the 16-bit primary account generated after the card number shift, excluding the check bit.&lt;/li&gt;<a name="line.195"></a>
<span class="sourceLineNo">196</span>     *                                               &lt;li&gt;When mode=0x23, is the transaction current number [6 Bytes,ASCII code].&lt;/li&gt;<a name="line.196"></a>
<span class="sourceLineNo">197</span>     *                                               &lt;li&gt;When mode=0x24, dataIn is primary account.&lt;/li&gt;<a name="line.197"></a>
<span class="sourceLineNo">198</span>     *                                             &lt;/ul&gt;&lt;/div&gt;<a name="line.198"></a>
<span class="sourceLineNo">199</span>     * @param algorithmType {@link EAlgorithmType} &lt;div class="zh"&gt;<a name="line.199"></a>
<span class="sourceLineNo">200</span>     *                                               &lt;ul&gt;<a name="line.200"></a>
<span class="sourceLineNo">201</span>     *                                                 &lt;li&gt;为{@link EAlgorithmType#_2TDEA_}或者{@link EAlgorithmType#_3TDEA_}时，使用 TDES算法计算(mode不能为0x24)。&lt;/li&gt;<a name="line.201"></a>
<span class="sourceLineNo">202</span>     *                                                 &lt;li&gt;为{@link EAlgorithmType#_AES128_}或者{@link EAlgorithmType#_AES192_}或者{@link EAlgorithmType#_AES256_}时，使用 AES 算法计算(mode只能为0x24)。&lt;/li&gt;<a name="line.202"></a>
<span class="sourceLineNo">203</span>     *                                               &lt;/ul&gt;<a name="line.203"></a>
<span class="sourceLineNo">204</span>     *                                            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.204"></a>
<span class="sourceLineNo">205</span>     *                                               &lt;ul&gt;<a name="line.205"></a>
<span class="sourceLineNo">206</span>     *                                                 &lt;li&gt;When it is {@link EAlgorithmType#_2TDEA_} or {@link EAlgorithmType#_3TDEA_}, use the TDES algorithm for calculation (mode cannot be 0x24).&lt;/li&gt;<a name="line.206"></a>
<span class="sourceLineNo">207</span>     *                                                 &lt;li&gt;When it is {@link EAlgorithmType#_AES128_} or {@link EAlgorithmType#_AES192_} or {@link EAlgorithmType#_AES256_}, use the AES algorithm for calculation (mode can only be 0x24).&lt;/li&gt;<a name="line.207"></a>
<span class="sourceLineNo">208</span>     *                                               &lt;/ul&gt;<a name="line.208"></a>
<span class="sourceLineNo">209</span>     *                                                &lt;/div&gt;<a name="line.209"></a>
<span class="sourceLineNo">210</span>     * @param mode          &lt;div class="zh"&gt;<a name="line.210"></a>
<span class="sourceLineNo">211</span>     *                                             &lt;ul&gt;<a name="line.211"></a>
<span class="sourceLineNo">212</span>     *                                               &lt;li&gt;0x20:ISO9564 格式0，KSN不自动加1。&lt;/li&gt;<a name="line.212"></a>
<span class="sourceLineNo">213</span>     *                                               &lt;li&gt;0x21:ISO9564 格式1，KSN不自动加1。&lt;/li&gt;<a name="line.213"></a>
<span class="sourceLineNo">214</span>     *                                               &lt;li&gt;0x22:ISO9564 格式3，KSN不自动加1。&lt;/li&gt;<a name="line.214"></a>
<span class="sourceLineNo">215</span>     *                                               &lt;li&gt;0x23:HK EPS格式， KSN不自动加1。&lt;/li&gt;<a name="line.215"></a>
<span class="sourceLineNo">216</span>     *                                               &lt;li&gt;0x24:ISO9564 格式4，KSN不自动加1。&lt;/li&gt;<a name="line.216"></a>
<span class="sourceLineNo">217</span>     *                                             &lt;/ul&gt;&lt;/div&gt;<a name="line.217"></a>
<span class="sourceLineNo">218</span>     *                                           &lt;div class="en"&gt;<a name="line.218"></a>
<span class="sourceLineNo">219</span>     *                                             &lt;ul&gt;<a name="line.219"></a>
<span class="sourceLineNo">220</span>     *                                               &lt;li&gt;0x20:ISO9564 format 0,KSN doesn't automatically add 1。&lt;/li&gt;<a name="line.220"></a>
<span class="sourceLineNo">221</span>     *                                               &lt;li&gt;0x21:ISO9564 format 1,KSN doesn't automatically add 1。&lt;/li&gt;<a name="line.221"></a>
<span class="sourceLineNo">222</span>     *                                               &lt;li&gt;0x22:ISO9564 format 3,KSN doesn't automatically add 1。&lt;/li&gt;<a name="line.222"></a>
<span class="sourceLineNo">223</span>     *                                               &lt;li&gt;0x23:HK EPS format, KSN doesn't automatically add 1。&lt;/li&gt;<a name="line.223"></a>
<span class="sourceLineNo">224</span>     *                                               &lt;li&gt;0x24:ISO9564 format 4,KSN doesn't automatically add 1。&lt;/li&gt;<a name="line.224"></a>
<span class="sourceLineNo">225</span>     *                                             &lt;/ul&gt;&lt;/div&gt;<a name="line.225"></a>
<span class="sourceLineNo">226</span>     * @param timeoutMs     &lt;div class="zh"&gt;&lt;/div&gt; &lt;div class="en"&gt;&lt;/div&gt;<a name="line.226"></a>
<span class="sourceLineNo">227</span>     * @return &lt;div class="zh"&gt;输入 PIN 的超时时间。单位：毫秒，最大值为 300000ms。0表示没有超时时间，PED 不做超时控制。&lt;/div&gt;<a name="line.227"></a>
<span class="sourceLineNo">228</span>     * &lt;div class="en"&gt;Enter the PIN timeout period. Unit: milliseconds, the maximum value is 300000ms. 0 means there is no timeout period, and PED does not do timeout control.&lt;/div&gt;<a name="line.228"></a>
<span class="sourceLineNo">229</span>     * @throws PedDevException PedDevException<a name="line.229"></a>
<span class="sourceLineNo">230</span>     * @since V4.00.00<a name="line.230"></a>
<span class="sourceLineNo">231</span>     */<a name="line.231"></a>
<span class="sourceLineNo">232</span>    DUKPTResult getAesDUKPTPin(byte groupIndex, String exPinLen, byte[] dataIn, EAlgorithmType algorithmType, byte mode,<a name="line.232"></a>
<span class="sourceLineNo">233</span>                               long timeoutMs) throws PedDevException;<a name="line.233"></a>
<span class="sourceLineNo">234</span><a name="line.234"></a>
<span class="sourceLineNo">235</span><a name="line.235"></a>
<span class="sourceLineNo">236</span>    /**<a name="line.236"></a>
<span class="sourceLineNo">237</span>     * &lt;div class="zh"&gt;写入 AES DUKPT 初始密钥 AESTIK，并可以选择使用 KCV 验证密钥正确性。&lt;/div&gt;<a name="line.237"></a>
<span class="sourceLineNo">238</span>     * &lt;div class="en"&gt;Write the AES DUKPT initial key AESTIK, and you can choose to use KCV to verify the correctness of the key.&lt;/div&gt;<a name="line.238"></a>
<span class="sourceLineNo">239</span>     *<a name="line.239"></a>
<span class="sourceLineNo">240</span>     * @param groupIndex  &lt;div class="zh"&gt;AES DUKPT密钥组索引。范围1~40。&lt;/div&gt; &lt;div class="en"&gt;AES DUKPT key group index. The range is 1~40.&lt;/div&gt;<a name="line.240"></a>
<span class="sourceLineNo">241</span>     * @param srcKeyIndex &lt;div class="zh"&gt;用于分散的密钥的密钥索引。范围0~1。目前仅支持明文写入，索引仅支持0。&lt;/div&gt; &lt;div class="en"&gt;The key index for the decentralized key. The range is 0~1. Currently, only plaintext writing is supported, and the index only supports 0.&lt;/div&gt;<a name="line.241"></a>
<span class="sourceLineNo">242</span>     * @param keyValue    &lt;div class="zh"&gt;AESTIK 的明文。目前AES DUKPT 算法支持 16/24/32 字节长度的密钥。&lt;/div&gt; &lt;div class="en"&gt;The plain text of AESTIK. Currently, the AES DUKPT algorithm supports keys with a length of 16/24/32 bytes.&lt;/div&gt;<a name="line.242"></a>
<span class="sourceLineNo">243</span>     * @param ksn         &lt;div class="zh"&gt;初始化 KSN。长度10/12 字节，只有在兼容模式才会是 10 字节。&lt;/div&gt; &lt;div class="en"&gt;Initialize KSN. The length is 10/12 bytes, only in compatibility mode will it be 10 bytes.&lt;/div&gt;<a name="line.243"></a>
<span class="sourceLineNo">244</span>     * @param checkMode   &lt;div class="zh"&gt;验证模式。<a name="line.244"></a>
<span class="sourceLineNo">245</span>     *                                         &lt;ul&gt;<a name="line.245"></a>
<span class="sourceLineNo">246</span>     *                                           &lt;li&gt;0x00:无校验。&lt;/li&gt;<a name="line.246"></a>
<span class="sourceLineNo">247</span>     *                                           &lt;li&gt;0x05:对16个字节的 0x00进行AES加密,得到的密文的前3个字节即为KCV。&lt;/li&gt;<a name="line.247"></a>
<span class="sourceLineNo">248</span>     *                                           &lt;li&gt;0x06:对16个字节的 0x00进行AES CMAC加密,得到的密文的前3个字节即为KCV。&lt;/li&gt;<a name="line.248"></a>
<span class="sourceLineNo">249</span>     *                                         &lt;/ul&gt;<a name="line.249"></a>
<span class="sourceLineNo">250</span>     *                                       &lt;/div&gt; &lt;div class="en"&gt;Check mode.<a name="line.250"></a>
<span class="sourceLineNo">251</span>     *                                         &lt;ul&gt;<a name="line.251"></a>
<span class="sourceLineNo">252</span>     *                                           &lt;li&gt;0x00: No check.&lt;/li&gt;<a name="line.252"></a>
<span class="sourceLineNo">253</span>     *                                           &lt;li&gt;0x05:Perform AES encryption on the 16 bytes of 0x00, and the first 3 bytes of the ciphertext obtained are KCV.&lt;/li&gt;<a name="line.253"></a>
<span class="sourceLineNo">254</span>     *                                           &lt;li&gt;0x06:Perform AES CMAC encryption on the 16 bytes of 0x00, and the first 3 bytes of the ciphertext obtained are KCV.&lt;/li&gt;<a name="line.254"></a>
<span class="sourceLineNo">255</span>     *                                         &lt;/ul&gt;    &lt;/div&gt;<a name="line.255"></a>
<span class="sourceLineNo">256</span>     * @param checkBuf    &lt;div class="zh"&gt;<a name="line.256"></a>
<span class="sourceLineNo">257</span>     *                                         &lt;ul&gt;<a name="line.257"></a>
<span class="sourceLineNo">258</span>     *                                           &lt;li&gt;当checkMode=0x00时，checkBuf的值无效，系统认为不验证KCV。&lt;/li&gt;<a name="line.258"></a>
<span class="sourceLineNo">259</span>     *                                           &lt;li&gt;当checkMode=0x05/0x06时，checkBuf[0]=KCV的长度，checkBuf[1]开始是KCV的值。&lt;/li&gt;<a name="line.259"></a>
<span class="sourceLineNo">260</span>     *                                         &lt;/ul&gt;<a name="line.260"></a>
<span class="sourceLineNo">261</span>     *                                       &lt;/div&gt; &lt;div class="en"&gt;<a name="line.261"></a>
<span class="sourceLineNo">262</span>     *                                         &lt;ul&gt;<a name="line.262"></a>
<span class="sourceLineNo">263</span>     *                                           &lt;li&gt;When checkMode=0x00, the value of checkBuf is invalid, and the system considers that KCV is not verified.&lt;/li&gt;<a name="line.263"></a>
<span class="sourceLineNo">264</span>     *                                           &lt;li&gt;When checkMode=0x05/0x06, checkBuf[0]=KCV length, checkBuf[1] starts with the value of KCV.&lt;/li&gt;<a name="line.264"></a>
<span class="sourceLineNo">265</span>     *                                         &lt;/ul&gt;<a name="line.265"></a>
<span class="sourceLineNo">266</span>     *                                           &lt;/div&gt;<a name="line.266"></a>
<span class="sourceLineNo">267</span>     * @throws PedDevException PedDevException<a name="line.267"></a>
<span class="sourceLineNo">268</span>     * @since V4.00.00<a name="line.268"></a>
<span class="sourceLineNo">269</span>     */<a name="line.269"></a>
<span class="sourceLineNo">270</span>    void writeAesDUKPTTIK(byte groupIndex, byte srcKeyIndex, byte[] keyValue, byte[] ksn, byte checkMode,<a name="line.270"></a>
<span class="sourceLineNo">271</span>                          byte[] checkBuf) throws PedDevException;<a name="line.271"></a>
<span class="sourceLineNo">272</span><a name="line.272"></a>
<span class="sourceLineNo">273</span><a name="line.273"></a>
<span class="sourceLineNo">274</span>    /**<a name="line.274"></a>
<span class="sourceLineNo">275</span>     * &lt;div class="zh"&gt; 使用AES算法进行加密和解密&lt;/div&gt;<a name="line.275"></a>
<span class="sourceLineNo">276</span>     * &lt;div class="en"&gt; Use AES algorithm for encryption and decryption. &lt;/div&gt;<a name="line.276"></a>
<span class="sourceLineNo">277</span>     *<a name="line.277"></a>
<span class="sourceLineNo">278</span>     * @param keyIndex<a name="line.278"></a>
<span class="sourceLineNo">279</span>     *            &lt;div class="zh"&gt;AES_TDK密钥序号: 1~100 &lt;/div&gt; &lt;div class="en"&gt; [1~100] AES_TDK index &lt;/div&gt;<a name="line.279"></a>
<span class="sourceLineNo">280</span>     *<a name="line.280"></a>
<span class="sourceLineNo">281</span>     * @param initVector<a name="line.281"></a>
<span class="sourceLineNo">282</span>     *            &lt;div class="zh"&gt;ECB模式: 初始向量为空。 CBC/OFB模式: 初始向量, 16字节。  &lt;/div&gt;<a name="line.282"></a>
<span class="sourceLineNo">283</span>     *            &lt;div class="en"&gt; ECB mode: init vector is null .CBC/OFB mode: init vector, 16 bytes. &lt;/div&gt;<a name="line.283"></a>
<span class="sourceLineNo">284</span>     *<a name="line.284"></a>
<span class="sourceLineNo">285</span>     * @param dataIn<a name="line.285"></a>
<span class="sourceLineNo">286</span>     *            &lt;div class="zh"&gt;用于加密或解密的数据，最大长度 &lt;= 1024, 且为16的倍数。  &lt;/div&gt;<a name="line.286"></a>
<span class="sourceLineNo">287</span>     *            &lt;div class="en"&gt; the data to be calculated. The maximum length is &lt;= 1024, and is a multiple of 16. &lt;/div&gt;<a name="line.287"></a>
<span class="sourceLineNo">288</span>     *<a name="line.288"></a>
<span class="sourceLineNo">289</span>     * @param mode<a name="line.289"></a>
<span class="sourceLineNo">290</span>     *            &lt;div class="zh"&gt;<a name="line.290"></a>
<span class="sourceLineNo">291</span>     *            &lt;ul&gt;<a name="line.291"></a>
<span class="sourceLineNo">292</span>     *            &lt;li&gt;0x00: ECB模式解密&lt;/li&gt;<a name="line.292"></a>
<span class="sourceLineNo">293</span>     *            &lt;li&gt;0x01: ECB模式加密&lt;/li&gt;<a name="line.293"></a>
<span class="sourceLineNo">294</span>     *            &lt;li&gt;0x02: CBC模式解密&lt;/li&gt;<a name="line.294"></a>
<span class="sourceLineNo">295</span>     *            &lt;li&gt;0x03: CBC模式加密&lt;/li&gt;<a name="line.295"></a>
<span class="sourceLineNo">296</span>     *            &lt;li&gt;0x04: OFB模式解密&lt;/li&gt;<a name="line.296"></a>
<span class="sourceLineNo">297</span>     *            &lt;li&gt;0x05: OFB模式加密&lt;/li&gt;<a name="line.297"></a>
<span class="sourceLineNo">298</span>     *            &lt;/ul&gt;<a name="line.298"></a>
<span class="sourceLineNo">299</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.299"></a>
<span class="sourceLineNo">300</span>     *            &lt;ul&gt;<a name="line.300"></a>
<span class="sourceLineNo">301</span>     *            &lt;li&gt;0x00: DECRYPT#ECB&lt;/li&gt;<a name="line.301"></a>
<span class="sourceLineNo">302</span>     *            &lt;li&gt;0x01: ENCRYPT#ECB&lt;/li&gt;<a name="line.302"></a>
<span class="sourceLineNo">303</span>     *            &lt;li&gt;0x02: DECRYPT#CBC&lt;/li&gt;<a name="line.303"></a>
<span class="sourceLineNo">304</span>     *            &lt;li&gt;0x03: ENCRYPT#CBC&lt;/li&gt;<a name="line.304"></a>
<span class="sourceLineNo">305</span>     *            &lt;li&gt;0x04: DECRYPT#OFB&lt;/li&gt;<a name="line.305"></a>
<span class="sourceLineNo">306</span>     *            &lt;li&gt;0x05: ENCRYPT#OFB&lt;/li&gt;<a name="line.306"></a>
<span class="sourceLineNo">307</span>     *            &lt;/ul&gt;<a name="line.307"></a>
<span class="sourceLineNo">308</span>     *            &lt;/div&gt;<a name="line.308"></a>
<span class="sourceLineNo">309</span>     *<a name="line.309"></a>
<span class="sourceLineNo">310</span>     * @return &lt;div class="zh"&gt; 返回运算后的数据 &lt;/div&gt; &lt;div class="en"&gt; the data after calculation. &lt;/div&gt;<a name="line.310"></a>
<span class="sourceLineNo">311</span>     *<a name="line.311"></a>
<span class="sourceLineNo">312</span>     * @throws PedDevException<a name="line.312"></a>
<span class="sourceLineNo">313</span>     * @since V4.00.00<a name="line.313"></a>
<span class="sourceLineNo">314</span>     */<a name="line.314"></a>
<span class="sourceLineNo">315</span>    byte[] calcAes(byte keyIndex, byte[] initVector, byte[] dataIn, byte mode) throws PedDevException;<a name="line.315"></a>
<span class="sourceLineNo">316</span><a name="line.316"></a>
<span class="sourceLineNo">317</span><a name="line.317"></a>
<span class="sourceLineNo">318</span>    /**<a name="line.318"></a>
<span class="sourceLineNo">319</span>     * &lt;div class="zh"&gt; 使用TDK对dataIn数据进行DES/TDES运算，使用DES或TDES根据密钥的长度而定。除0，1模式没有向量外，其他模式有向量但默认为NULL。&lt;/div&gt;<a name="line.319"></a>
<span class="sourceLineNo">320</span>     * &lt;div class="en"&gt; To use TDK encrypt or decrypt data by DES/TDES. Using DES or TDES depends on the key length.<a name="line.320"></a>
<span class="sourceLineNo">321</span>     * Except for 0, 1 mode which does not have a vector, other modes have a vector but default to NULL.&lt;/div&gt;<a name="line.321"></a>
<span class="sourceLineNo">322</span>     *<a name="line.322"></a>
<span class="sourceLineNo">323</span>     * @param keyIndex<a name="line.323"></a>
<span class="sourceLineNo">324</span>     *            &lt;div class="zh"&gt; [1~100] TDK的索引 。&lt;/div&gt; &lt;div class="en"&gt; [1~100] TDK index.&lt;/div&gt;<a name="line.324"></a>
<span class="sourceLineNo">325</span>     *<a name="line.325"></a>
<span class="sourceLineNo">326</span>     * @param dataIn<a name="line.326"></a>
<span class="sourceLineNo">327</span>     *            &lt;div class="zh"&gt; 用于运算的数据.除ECB和CBC最大支持8K bytes，其他模式的输入长度最大支持2048。&lt;/div&gt;<a name="line.327"></a>
<span class="sourceLineNo">328</span>     *            &lt;div class="en"&gt; Data used for calculation. Except for ECB and CBC, which support a maximum of 8K bytes, other modes supports a maximum of 2048.&lt;/div&gt;<a name="line.328"></a>
<span class="sourceLineNo">329</span>     *<a name="line.329"></a>
<span class="sourceLineNo">330</span>     * @param mode<a name="line.330"></a>
<span class="sourceLineNo">331</span>     *            &lt;div class="zh"&gt;<a name="line.331"></a>
<span class="sourceLineNo">332</span>     *            &lt;ul&gt;<a name="line.332"></a>
<span class="sourceLineNo">333</span>     *            &lt;li&gt;0x00: ECB模式解密&lt;/li&gt;<a name="line.333"></a>
<span class="sourceLineNo">334</span>     *            &lt;li&gt;0x01: ECB模式加密&lt;/li&gt;<a name="line.334"></a>
<span class="sourceLineNo">335</span>     *            &lt;li&gt;0x02: CBC模式解密&lt;/li&gt;<a name="line.335"></a>
<span class="sourceLineNo">336</span>     *            &lt;li&gt;0x03: CBC模式加密&lt;/li&gt;<a name="line.336"></a>
<span class="sourceLineNo">337</span>     *            &lt;li&gt;0x04: OFB模式解密&lt;/li&gt;<a name="line.337"></a>
<span class="sourceLineNo">338</span>     *            &lt;li&gt;0x05: OFB模式加密&lt;/li&gt;<a name="line.338"></a>
<span class="sourceLineNo">339</span>     *            &lt;li&gt;0x06: CFB8模式解密&lt;/li&gt;<a name="line.339"></a>
<span class="sourceLineNo">340</span>     *            &lt;li&gt;0x07: CFB8模式加密&lt;/li&gt;<a name="line.340"></a>
<span class="sourceLineNo">341</span>     *            &lt;/ul&gt;<a name="line.341"></a>
<span class="sourceLineNo">342</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.342"></a>
<span class="sourceLineNo">343</span>     *            &lt;ul&gt;<a name="line.343"></a>
<span class="sourceLineNo">344</span>     *            &lt;li&gt;0x00: DECRYPT#ECB&lt;/li&gt;<a name="line.344"></a>
<span class="sourceLineNo">345</span>     *            &lt;li&gt;0x01: ENCRYPT#ECB&lt;/li&gt;<a name="line.345"></a>
<span class="sourceLineNo">346</span>     *            &lt;li&gt;0x02: DECRYPT#CBC&lt;/li&gt;<a name="line.346"></a>
<span class="sourceLineNo">347</span>     *            &lt;li&gt;0x03: ENCRYPT#CBC&lt;/li&gt;<a name="line.347"></a>
<span class="sourceLineNo">348</span>     *            &lt;li&gt;0x04: DECRYPT#OFB&lt;/li&gt;<a name="line.348"></a>
<span class="sourceLineNo">349</span>     *            &lt;li&gt;0x05: ENCRYPT#OFB&lt;/li&gt;<a name="line.349"></a>
<span class="sourceLineNo">350</span>     *            &lt;li&gt;0x06: DECRYPT#CFB8&lt;/li&gt;<a name="line.350"></a>
<span class="sourceLineNo">351</span>     *            &lt;li&gt;0x07: ENCRYPT#CFB8&lt;/li&gt;<a name="line.351"></a>
<span class="sourceLineNo">352</span>     *            &lt;/ul&gt;<a name="line.352"></a>
<span class="sourceLineNo">353</span>     *            &lt;/div&gt;<a name="line.353"></a>
<span class="sourceLineNo">354</span>     *<a name="line.354"></a>
<span class="sourceLineNo">355</span>     * @return &lt;div class="zh"&gt; 运算后的数据 。&lt;/div&gt; &lt;div class="en"&gt; The data which have been calculated. &lt;/div&gt;<a name="line.355"></a>
<span class="sourceLineNo">356</span>     *<a name="line.356"></a>
<span class="sourceLineNo">357</span>     * @throws PedDevException<a name="line.357"></a>
<span class="sourceLineNo">358</span>     */<a name="line.358"></a>
<span class="sourceLineNo">359</span>    byte[] calcDes(byte keyIndex, byte[] dataIn, byte mode) throws PedDevException;<a name="line.359"></a>
<span class="sourceLineNo">360</span><a name="line.360"></a>
<span class="sourceLineNo">361</span><a name="line.361"></a>
<span class="sourceLineNo">362</span>    /**<a name="line.362"></a>
<span class="sourceLineNo">363</span>     * &lt;div class="zh"&gt; 使用TDK对数据进行DES/TDES解密或加密运算，输出明文或密文；一个指定的 TDK，只能用于加密或解密运算。&lt;/div&gt;<a name="line.363"></a>
<span class="sourceLineNo">364</span>     * &lt;div class="en"&gt; Use TDK to perform DES/TDES decryption or encryption operations on data, and output plaintext or ciphertext;<a name="line.364"></a>
<span class="sourceLineNo">365</span>     * a specified TDK can only be used for encryption or decryption operations&lt;/div&gt;<a name="line.365"></a>
<span class="sourceLineNo">366</span>     *<a name="line.366"></a>
<span class="sourceLineNo">367</span>     * @param keyIndex<a name="line.367"></a>
<span class="sourceLineNo">368</span>     *            &lt;div class="zh"&gt; [1~100] TDK的索引 &lt;/div&gt; &lt;div class="en"&gt; [1~100] TDK index &lt;/div&gt;<a name="line.368"></a>
<span class="sourceLineNo">369</span>     *<a name="line.369"></a>
<span class="sourceLineNo">370</span>     * @param initVector<a name="line.370"></a>
<span class="sourceLineNo">371</span>     *            &lt;div class="zh"&gt;加解密运算的初始向量，长度为8字节，无论长度多少，只有前8字节有效。 &lt;/div&gt;<a name="line.371"></a>
<span class="sourceLineNo">372</span>     *            &lt;diV class="en"&gt;The initial vector for encryption and decryption operations, the length is 8 bytes, no matter how long it is, only the first 8 bytes are valid.&lt;/div&gt;<a name="line.372"></a>
<span class="sourceLineNo">373</span>     *<a name="line.373"></a>
<span class="sourceLineNo">374</span>     * @param dataIn<a name="line.374"></a>
<span class="sourceLineNo">375</span>     *            &lt;div class="zh"&gt; 需要进行运算的数据,以字节为单位, 除0,1模式最大支持8K之外，其他模式最大支持1024 &lt;/div&gt;<a name="line.375"></a>
<span class="sourceLineNo">376</span>     *            &lt;div class="en"&gt; The data that needs to be calculated, in bytes, except for the 0,1 mode that supports a maximum of 8K, other modes support a maximum of 1024.&lt;/div&gt;<a name="line.376"></a>
<span class="sourceLineNo">377</span>     *<a name="line.377"></a>
<span class="sourceLineNo">378</span>     * @param mode<a name="line.378"></a>
<span class="sourceLineNo">379</span>     *            &lt;div class="zh"&gt;<a name="line.379"></a>
<span class="sourceLineNo">380</span>     *            &lt;ul&gt;<a name="line.380"></a>
<span class="sourceLineNo">381</span>     *            &lt;li&gt;0x00: CBC模式解密&lt;/li&gt;<a name="line.381"></a>
<span class="sourceLineNo">382</span>     *            &lt;li&gt;0x01: CBC模式加密&lt;/li&gt;<a name="line.382"></a>
<span class="sourceLineNo">383</span>     *            &lt;li&gt;0x04: OFB模式解密&lt;/li&gt;<a name="line.383"></a>
<span class="sourceLineNo">384</span>     *            &lt;li&gt;0x05: OFB模式加密&lt;/li&gt;<a name="line.384"></a>
<span class="sourceLineNo">385</span>     *            &lt;li&gt;0x06: CFB8模式解密&lt;/li&gt;<a name="line.385"></a>
<span class="sourceLineNo">386</span>     *            &lt;li&gt;0x07: CFB8模式加密&lt;/li&gt;<a name="line.386"></a>
<span class="sourceLineNo">387</span>     *            &lt;/ul&gt;<a name="line.387"></a>
<span class="sourceLineNo">388</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.388"></a>
<span class="sourceLineNo">389</span>     *            &lt;ul&gt;<a name="line.389"></a>
<span class="sourceLineNo">390</span>     *            &lt;li&gt;0x00: DECRYPT#CBC&lt;/li&gt;<a name="line.390"></a>
<span class="sourceLineNo">391</span>     *            &lt;li&gt;0x01: ENCRYPT#CBC&lt;/li&gt;<a name="line.391"></a>
<span class="sourceLineNo">392</span>     *            &lt;li&gt;0x04: DECRYPT#OFB&lt;/li&gt;<a name="line.392"></a>
<span class="sourceLineNo">393</span>     *            &lt;li&gt;0x05: ENCRYPT#OFB&lt;/li&gt;<a name="line.393"></a>
<span class="sourceLineNo">394</span>     *            &lt;li&gt;0x06: DECRYPT#CFB8&lt;/li&gt;<a name="line.394"></a>
<span class="sourceLineNo">395</span>     *            &lt;li&gt;0x07: ENCRYPT#CFB8&lt;/li&gt;<a name="line.395"></a>
<span class="sourceLineNo">396</span>     *            &lt;/ul&gt;<a name="line.396"></a>
<span class="sourceLineNo">397</span>     *            &lt;/div&gt;<a name="line.397"></a>
<span class="sourceLineNo">398</span>     *<a name="line.398"></a>
<span class="sourceLineNo">399</span>     * @return &lt;div class="zh"&gt; 返回运算后的数据 &lt;/div&gt; &lt;div class="en"&gt; the data after calculation. &lt;/div&gt;<a name="line.399"></a>
<span class="sourceLineNo">400</span>     *<a name="line.400"></a>
<span class="sourceLineNo">401</span>     * @throws PedDevException<a name="line.401"></a>
<span class="sourceLineNo">402</span>     * @since V4.00.00<a name="line.402"></a>
<span class="sourceLineNo">403</span>     */<a name="line.403"></a>
<span class="sourceLineNo">404</span>    byte[] calcDesExMode(byte keyIndex, byte[] initVector, byte[] dataIn, byte mode) throws PedDevException;<a name="line.404"></a>
<span class="sourceLineNo">405</span><a name="line.405"></a>
<span class="sourceLineNo">406</span><a name="line.406"></a>
<span class="sourceLineNo">407</span>    /**<a name="line.407"></a>
<span class="sourceLineNo">408</span>     * &lt;div class="zh"&gt; 使用DUKPT的MAC密钥或DES密钥，对输入缓存内数据进行加密或解密。&lt;/div&gt;<a name="line.408"></a>
<span class="sourceLineNo">409</span>     * &lt;div class="en"&gt; Use MAC key or DES key of DUKPT to encrypt or decrypt the data in the input buffer.&lt;/div&gt;<a name="line.409"></a>
<span class="sourceLineNo">410</span>     *<a name="line.410"></a>
<span class="sourceLineNo">411</span>     * @param groupIndex<a name="line.411"></a>
<span class="sourceLineNo">412</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100] DUKPT group ID &lt;/div&gt;<a name="line.412"></a>
<span class="sourceLineNo">413</span>     *<a name="line.413"></a>
<span class="sourceLineNo">414</span>     * @param keyVarType<a name="line.414"></a>
<span class="sourceLineNo">415</span>     *            &lt;div class="zh"&gt;<a name="line.415"></a>
<span class="sourceLineNo">416</span>     *            &lt;ul&gt;<a name="line.416"></a>
<span class="sourceLineNo">417</span>     *              &lt;li&gt;0x00: 使用请求和应答MAC密钥。&lt;/li&gt;<a name="line.417"></a>
<span class="sourceLineNo">418</span>     *              &lt;li&gt;0x01: 使用DUKPT DES密钥运算。&lt;/li&gt;<a name="line.418"></a>
<span class="sourceLineNo">419</span>     *              &lt;li&gt;0x02: 使用DUKPT PIN密钥做ECB加密。Mode 只能取值 0x01:ECB 加密。&lt;/li&gt;<a name="line.419"></a>
<span class="sourceLineNo">420</span>     *              &lt;li&gt;0x03: 使用应答 MAC 密钥。仅支持加密模式，mode只能是0x01、0x03、0x05。&lt;/li&gt;<a name="line.420"></a>
<span class="sourceLineNo">421</span>     *              &lt;li&gt;0x04: 使用应答 DES 密钥。仅支持加密模式，mode只能是0x01、0x03、0x05。&lt;/li&gt;<a name="line.421"></a>
<span class="sourceLineNo">422</span>     *             &lt;/ul&gt;<a name="line.422"></a>
<span class="sourceLineNo">423</span>     *            &lt;/div&gt;<a name="line.423"></a>
<span class="sourceLineNo">424</span>     *            &lt;div class="en"&gt;<a name="line.424"></a>
<span class="sourceLineNo">425</span>     *             &lt;ul&gt;<a name="line.425"></a>
<span class="sourceLineNo">426</span>     *              &lt;li&gt;0x00: Use request and response MAC key.&lt;/li&gt;<a name="line.426"></a>
<span class="sourceLineNo">427</span>     *              &lt;li&gt;0x01: Use DUKPT DES key operation.&lt;/li&gt;<a name="line.427"></a>
<span class="sourceLineNo">428</span>     *              &lt;li&gt;0x02: Use DUKPT PIN key to do the ECB encryption. mode can only be 0x01:ENCRYPT#ECB.&lt;/li&gt;<a name="line.428"></a>
<span class="sourceLineNo">429</span>     *              &lt;li&gt;0x03: Use the response MAC key. Only encryption mode is supported, mode can only be 0x01、0x03、0x05.&lt;/li&gt;<a name="line.429"></a>
<span class="sourceLineNo">430</span>     *              &lt;li&gt;0x04: Use the response DES key. Only encryption mode is supported, mode can only be 0x01、0x03、0x05.&lt;/li&gt;<a name="line.430"></a>
<span class="sourceLineNo">431</span>     *             &lt;/ul&gt;<a name="line.431"></a>
<span class="sourceLineNo">432</span>     *            &lt;/div&gt;<a name="line.432"></a>
<span class="sourceLineNo">433</span>     *<a name="line.433"></a>
<span class="sourceLineNo">434</span>     * @param iv<a name="line.434"></a>
<span class="sourceLineNo">435</span>     *            &lt;div class="zh"&gt; 8字节初始向量，CBC加解密时需要，如果传入NULL，将默认用“\x00\x00\x00\x00\x00\x00\x00\x00”作为初始向量 &lt;/div&gt; &lt;div<a name="line.435"></a>
<span class="sourceLineNo">436</span>     *            class="en"&gt; 8 bytes initialization vector, used for CBC encryption or decryption. If set it to NULL,<a name="line.436"></a>
<span class="sourceLineNo">437</span>     *            it will use “\x00\x00\x00\x00\x00\x00\x00\x00” as the initialization vector by default. &lt;/div&gt;<a name="line.437"></a>
<span class="sourceLineNo">438</span>     *<a name="line.438"></a>
<span class="sourceLineNo">439</span>     * @param dataIn<a name="line.439"></a>
<span class="sourceLineNo">440</span>     *            &lt;div class="zh"&gt; 指向需要进行运算的数据, 数据长度&lt;=8192，8整除 &lt;/div&gt; &lt;div class="en"&gt; Point to the data which need to<a name="line.440"></a>
<span class="sourceLineNo">441</span>     *            be computed.Data length less than or equal to 8192, it is divisible by 8. &lt;/div&gt;<a name="line.441"></a>
<span class="sourceLineNo">442</span>     *<a name="line.442"></a>
<span class="sourceLineNo">443</span>     * @param mode<a name="line.443"></a>
<span class="sourceLineNo">444</span>     *            &lt;div class="zh"&gt;<a name="line.444"></a>
<span class="sourceLineNo">445</span>     *            &lt;ul&gt;<a name="line.445"></a>
<span class="sourceLineNo">446</span>     *            &lt;li&gt;0x00: ECB模式解密&lt;/li&gt;<a name="line.446"></a>
<span class="sourceLineNo">447</span>     *            &lt;li&gt;0x01: ECB模式加密&lt;/li&gt;<a name="line.447"></a>
<span class="sourceLineNo">448</span>     *            &lt;li&gt;0x02: CBC模式解密&lt;/li&gt;<a name="line.448"></a>
<span class="sourceLineNo">449</span>     *            &lt;li&gt;0x03: CBC模式加密&lt;/li&gt;<a name="line.449"></a>
<span class="sourceLineNo">450</span>     *            &lt;li&gt;0x04: OFB模式解密&lt;/li&gt;<a name="line.450"></a>
<span class="sourceLineNo">451</span>     *            &lt;li&gt;0x05: OFB模式加密&lt;/li&gt;<a name="line.451"></a>
<span class="sourceLineNo">452</span>     *            &lt;/ul&gt;<a name="line.452"></a>
<span class="sourceLineNo">453</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.453"></a>
<span class="sourceLineNo">454</span>     *            &lt;ul&gt;<a name="line.454"></a>
<span class="sourceLineNo">455</span>     *            &lt;li&gt;0x00: DECRYPT#ECB&lt;/li&gt;<a name="line.455"></a>
<span class="sourceLineNo">456</span>     *            &lt;li&gt;0x01: ENCRYPT#ECB&lt;/li&gt;<a name="line.456"></a>
<span class="sourceLineNo">457</span>     *            &lt;li&gt;0x02: DECRYPT#CBC&lt;/li&gt;<a name="line.457"></a>
<span class="sourceLineNo">458</span>     *            &lt;li&gt;0x03: ENCRYPT#CBC&lt;/li&gt;<a name="line.458"></a>
<span class="sourceLineNo">459</span>     *            &lt;li&gt;0x04: DECRYPT#OFB&lt;/li&gt;<a name="line.459"></a>
<span class="sourceLineNo">460</span>     *            &lt;li&gt;0x05: ENCRYPT#OFB&lt;/li&gt;<a name="line.460"></a>
<span class="sourceLineNo">461</span>     *            &lt;/ul&gt;<a name="line.461"></a>
<span class="sourceLineNo">462</span>     *            &lt;/div&gt;<a name="line.462"></a>
<span class="sourceLineNo">463</span>     * @return {@link DUKPTResult}<a name="line.463"></a>
<span class="sourceLineNo">464</span>     * @throws PedDevException<a name="line.464"></a>
<span class="sourceLineNo">465</span>     * @since V4.00.00<a name="line.465"></a>
<span class="sourceLineNo">466</span>     */<a name="line.466"></a>
<span class="sourceLineNo">467</span>    DUKPTResult calcDUKPTDes(byte groupIndex, byte keyVarType, byte[] iv, byte[] dataIn, byte mode) throws PedDevException;<a name="line.467"></a>
<span class="sourceLineNo">468</span><a name="line.468"></a>
<span class="sourceLineNo">469</span><a name="line.469"></a>
<span class="sourceLineNo">470</span>    /**<a name="line.470"></a>
<span class="sourceLineNo">471</span>     * &lt;div class="zh"&gt;扫描键盘上输入的PIN并输出由 Mode指定算法加密的 PIN BLOCK。 &lt;/div&gt;<a name="line.471"></a>
<span class="sourceLineNo">472</span>     * &lt;div class="en"&gt;Scan the PIN entered on the keyboard and output the PIN BLOCK encrypted by the algorithm specified by Mode.&lt;/div&gt;<a name="line.472"></a>
<span class="sourceLineNo">473</span>     *<a name="line.473"></a>
<span class="sourceLineNo">474</span>     *<a name="line.474"></a>
<span class="sourceLineNo">475</span>     * @param keyIdx<a name="line.475"></a>
<span class="sourceLineNo">476</span>     *            &lt;div class="zh"&gt; [1~100] TPK的索引 &lt;/div&gt; &lt;div class="en"&gt; [1~100] TPK index &lt;/div&gt;<a name="line.476"></a>
<span class="sourceLineNo">477</span>     *<a name="line.477"></a>
<span class="sourceLineNo">478</span>     * @param expPinLen<a name="line.478"></a>
<span class="sourceLineNo">479</span>     *            &lt;div class="zh"&gt; 0~12的枚举集合<a name="line.479"></a>
<span class="sourceLineNo">480</span>     *            可输入的合法密码长度字符串，应用程序把允许的密码长度全部枚举出来，并且用"，"号隔开每个长度，如允许输入4、6位密码并且允许无密码直接按确认，则该字符串应该设置为"0,4,6"。<a name="line.480"></a>
<span class="sourceLineNo">481</span>     *            若枚举0长度则示意可以不输任何数字而直接按确认键返回。<a name="line.481"></a>
<span class="sourceLineNo">482</span>     *            &lt;p&gt;<a name="line.482"></a>
<span class="sourceLineNo">483</span>     *            当mode=0x05的时候，该参数为"5"<a name="line.483"></a>
<span class="sourceLineNo">484</span>     *            &lt;/p&gt;<a name="line.484"></a>
<span class="sourceLineNo">485</span>     *            &lt;/div&gt; &lt;div class="en"&gt; Enumeration of 0-12.The enter password string with legal length. Application<a name="line.485"></a>
<span class="sourceLineNo">486</span>     *            enumerates of all possible lengths of PIN. ","will be used to separate each number of length. If no<a name="line.486"></a>
<span class="sourceLineNo">487</span>     *            PIN,or 4 or 6 digits of PIN are allowed, the string will be set as "0,4,6". 0 means that no PIN is<a name="line.487"></a>
<span class="sourceLineNo">488</span>     *            required, and pressing "Enter" will return.<a name="line.488"></a>
<span class="sourceLineNo">489</span>     *            &lt;p&gt;<a name="line.489"></a>
<span class="sourceLineNo">490</span>     *            When mode=0x05，it should be "5"<a name="line.490"></a>
<span class="sourceLineNo">491</span>     *            &lt;/p&gt;<a name="line.491"></a>
<span class="sourceLineNo">492</span>     *            &lt;/div&gt;<a name="line.492"></a>
<span class="sourceLineNo">493</span>     *<a name="line.493"></a>
<span class="sourceLineNo">494</span>     * @param dataIn<a name="line.494"></a>
<span class="sourceLineNo">495</span>     *            &lt;div class="zh"&gt;<a name="line.495"></a>
<span class="sourceLineNo">496</span>     *            &lt;ul&gt;<a name="line.496"></a>
<span class="sourceLineNo">497</span>     *            &lt;li&gt;当mode=0x00时, DataIn指向卡号移位后生成的16位主帐号。&lt;/li&gt;<a name="line.497"></a>
<span class="sourceLineNo">498</span>     *            &lt;li&gt;当mode=0x01时, 输入参数为参与PinBlock的格式化,8字节数据(根据ISO9564的规范,该数据可以是随机数、交易流水号或时间戳等)。&lt;/li&gt;<a name="line.498"></a>
<span class="sourceLineNo">499</span>     *            &lt;li&gt;当mode=0x02时, DataIn指向卡号移位后生成的16位主帐号,DataIn+16指向参与PinBlock格式化的8字节数据(根据ISO9564的规范<a name="line.499"></a>
<span class="sourceLineNo">500</span>     *            ,该数据可以是随机数、交易流水号或时间戳等,但是每个字节的高4位和低4位,均必须在0xA~0xF之间,所以当Mode为0x02时,应用需要将该8字节的数据做此检查,如果不满足要求将返回错误)&lt;/li&gt;<a name="line.500"></a>
<span class="sourceLineNo">501</span>     *            &lt;li&gt;当mode=0x03时, 为交易流水号ISN [6 Bytes,ASCII码]&lt;/li&gt;<a name="line.501"></a>
<span class="sourceLineNo">502</span>     *            &lt;li&gt;当Mode=0x05时, DataIn包含卡账号和CCS数据，格式为PANlen(1个字节) + CCSlen（1个字节） + PAN（PANlen个字节） +<a name="line.502"></a>
<span class="sourceLineNo">503</span>     *            CCS（CCSlen个字节）。其中PAN为卡账号（ASCII码），目前限定PANlen必须为18，CCSlen必须为0或者8，CCS为ASCII码格式。&lt;/li&gt;<a name="line.503"></a>
<span class="sourceLineNo">504</span>     *            &lt;li&gt;当mode=0x14时，DataIn为原始主帐号。&lt;/li&gt;<a name="line.504"></a>
<span class="sourceLineNo">505</span>     *            &lt;/ul&gt;<a name="line.505"></a>
<span class="sourceLineNo">506</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.506"></a>
<span class="sourceLineNo">507</span>     *            &lt;ul&gt;<a name="line.507"></a>
<span class="sourceLineNo">508</span>     *            &lt;li&gt;When mode=0x00, DataIn is the 16 bytes primary account number after shifting.&lt;/li&gt;<a name="line.508"></a>
<span class="sourceLineNo">509</span>     *            &lt;li&gt;When mode=0x01, Input parameters for participation in PinBlock formatting, 8 bytes data. (refer to<a name="line.509"></a>
<span class="sourceLineNo">510</span>     *            ISO9564 standard, this data can be Random number, the transaction serial number or time stamp, etc.)&lt;/li&gt;<a name="line.510"></a>
<span class="sourceLineNo">511</span>     *            &lt;li&gt;When mode=0x02, DataIn is the 16 bytes primary account number after shifting. DataIn+16 point to<a name="line.511"></a>
<span class="sourceLineNo">512</span>     *            the 8 bytes data which has participated in PinBlock formatting. (refer to ISO9564 standard, this data<a name="line.512"></a>
<span class="sourceLineNo">513</span>     *            can be Random number, the transaction serial number or time stamp,etc. But the higher 4 bits and lower<a name="line.513"></a>
<span class="sourceLineNo">514</span>     *            4 bits of each byte should between 0xA~0xF. So, if the Mode=0x02, the bottom level will do this check<a name="line.514"></a>
<span class="sourceLineNo">515</span>     *            for the 8 bytes data, it will return an error if does not meet the requirement.).&lt;/li&gt;<a name="line.515"></a>
<span class="sourceLineNo">516</span>     *            &lt;li&gt;When mode=0x03, dataIn is ISN [6 Bytes, ASCII code]&lt;/li&gt;<a name="line.516"></a>
<span class="sourceLineNo">517</span>     *            &lt;li&gt;When Mode=0x05, DataIn contains card account and CCS data. The format is PANlen (1 bytes) + CCSlen<a name="line.517"></a>
<span class="sourceLineNo">518</span>     *            (1 bytes) + PAN (PANlen byte) + CCS (CCSlen byte). In which PAN is a card account (ASCII code), the<a name="line.518"></a>
<span class="sourceLineNo">519</span>     *            current limited PANlen must be 18, CCSlen must be 0 or 8, CCS is ASCII code format.&lt;/li&gt;<a name="line.519"></a>
<span class="sourceLineNo">520</span>     *            &lt;li&gt;When mode=0x14, DataIn is the original primary account.&lt;/li&gt;<a name="line.520"></a>
<span class="sourceLineNo">521</span>     *            &lt;/ul&gt;<a name="line.521"></a>
<span class="sourceLineNo">522</span>     *            &lt;/div&gt;<a name="line.522"></a>
<span class="sourceLineNo">523</span>     *<a name="line.523"></a>
<span class="sourceLineNo">524</span>     * @param mode<a name="line.524"></a>
<span class="sourceLineNo">525</span>     *            &lt;div class="zh"&gt; PIN BLOCK的格式<a name="line.525"></a>
<span class="sourceLineNo">526</span>     *            &lt;ul&gt;<a name="line.526"></a>
<span class="sourceLineNo">527</span>     *            &lt;li&gt;0x00:ISO9564_0&lt;/li&gt;<a name="line.527"></a>
<span class="sourceLineNo">528</span>     *            &lt;li&gt;0x01:ISO9564_1&lt;/li&gt;<a name="line.528"></a>
<span class="sourceLineNo">529</span>     *            &lt;li&gt;0x02:ISO9564_3&lt;/li&gt;<a name="line.529"></a>
<span class="sourceLineNo">530</span>     *            &lt;li&gt;0x03:HK EPS&lt;/li&gt;<a name="line.530"></a>
<span class="sourceLineNo">531</span>     *            &lt;li&gt;0x04:预留&lt;/li&gt;<a name="line.531"></a>
<span class="sourceLineNo">532</span>     *            &lt;li&gt;0x05:Italy 专用模式&lt;/li&gt;<a name="line.532"></a>
<span class="sourceLineNo">533</span>     *            &lt;li&gt;0x06:AS2805 zero length PIN block mode。不会要求输入PIN，不会弹出输PIN窗口，expPinLen必须为0。&lt;/li&gt;<a name="line.533"></a>
<span class="sourceLineNo">534</span>     *            &lt;li&gt;0x11:使用AES_TPK加密,pinblock是日本的hit特殊模式&lt;/li&gt;<a name="line.534"></a>
<span class="sourceLineNo">535</span>     *            &lt;li&gt;0x12:使用AES_TPK加密,pinblock是日本的PKCS7模式&lt;/li&gt;<a name="line.535"></a>
<span class="sourceLineNo">536</span>     *            &lt;li&gt;0x14:使用AES_TPK加密,pinblock是ISO9564 格式4&lt;/li&gt;<a name="line.536"></a>
<span class="sourceLineNo">537</span>     *            &lt;li&gt;0x50:3DES-CBC&lt;/li&gt;<a name="line.537"></a>
<span class="sourceLineNo">538</span>     *            &lt;/ul&gt;<a name="line.538"></a>
<span class="sourceLineNo">539</span>     *            &lt;/div&gt; &lt;div class="en"&gt; PIN BLOCK Format<a name="line.539"></a>
<span class="sourceLineNo">540</span>     *            &lt;ul&gt;<a name="line.540"></a>
<span class="sourceLineNo">541</span>     *            &lt;li&gt;0x00:ISO9564_0&lt;/li&gt;<a name="line.541"></a>
<span class="sourceLineNo">542</span>     *            &lt;li&gt;0x01:ISO9564_1&lt;/li&gt;<a name="line.542"></a>
<span class="sourceLineNo">543</span>     *            &lt;li&gt;0x02:ISO9564_3&lt;/li&gt;<a name="line.543"></a>
<span class="sourceLineNo">544</span>     *            &lt;li&gt;0x03:HK EPS -EPS PINBLOCK Format&lt;/li&gt;<a name="line.544"></a>
<span class="sourceLineNo">545</span>     *            &lt;li&gt;0x04:Reserved&lt;/li&gt;<a name="line.545"></a>
<span class="sourceLineNo">546</span>     *            &lt;li&gt;0x05:Italy special mode&lt;/li&gt;<a name="line.546"></a>
<span class="sourceLineNo">547</span>     *            &lt;li&gt;0x06:AS2805 zero length PIN block mode。The pin input window will not pop up. expPinLen must be 0.&lt;/li&gt;<a name="line.547"></a>
<span class="sourceLineNo">548</span>     *            &lt;li&gt;0x11:Using AES_TPK encryption, pinblock is Japan's hit special mode&lt;/li&gt;<a name="line.548"></a>
<span class="sourceLineNo">549</span>     *            &lt;li&gt;0x12:Using AES_TPK encryption, pinblock is Japan's PKCS7 mode&lt;/li&gt;<a name="line.549"></a>
<span class="sourceLineNo">550</span>     *            &lt;li&gt;0x14:Using AES_TPK encryption, pinblock is in ISO9564 format 4&lt;/li&gt;<a name="line.550"></a>
<span class="sourceLineNo">551</span>     *            &lt;li&gt;0x50:3DES-CBC&lt;/li&gt;<a name="line.551"></a>
<span class="sourceLineNo">552</span>     *            &lt;/ul&gt;<a name="line.552"></a>
<span class="sourceLineNo">553</span>     *            &lt;/div&gt;<a name="line.553"></a>
<span class="sourceLineNo">554</span>     *<a name="line.554"></a>
<span class="sourceLineNo">555</span>     * @param timeoutMs<a name="line.555"></a>
<span class="sourceLineNo">556</span>     *            &lt;div class="zh"&gt;<a name="line.556"></a>
<span class="sourceLineNo">557</span>     *            &lt;p&gt;<a name="line.557"></a>
<span class="sourceLineNo">558</span>     *            输入PIN的超时时间,单位：毫秒 最大值为300000ms<a name="line.558"></a>
<span class="sourceLineNo">559</span>     *            &lt;/p&gt;<a name="line.559"></a>
<span class="sourceLineNo">560</span>     *            &lt;/div&gt;<a name="line.560"></a>
<span class="sourceLineNo">561</span>     *            &lt;div class="en"&gt;<a name="line.561"></a>
<span class="sourceLineNo">562</span>     *            &lt;p&gt;<a name="line.562"></a>
<span class="sourceLineNo">563</span>     *            The timeout of PIN entry [unit:ms] Maximum is 300000ms.<a name="line.563"></a>
<span class="sourceLineNo">564</span>     *            &lt;/p&gt;<a name="line.564"></a>
<span class="sourceLineNo">565</span>     *            &lt;/div&gt;<a name="line.565"></a>
<span class="sourceLineNo">566</span>     *<a name="line.566"></a>
<span class="sourceLineNo">567</span>     * @return &lt;div class="zh"&gt; 8/16字节的PINBlock(Mode是0x11/0x12/0x14是16字节)  &lt;/div&gt;<a name="line.567"></a>
<span class="sourceLineNo">568</span>     * &lt;div class="en"&gt;8/16 bytes of PINBlock (16 bytes when Mode is 0x11/0x12/0x14).&lt;/div&gt;<a name="line.568"></a>
<span class="sourceLineNo">569</span>     *<a name="line.569"></a>
<span class="sourceLineNo">570</span>     * @throws PedDevException<a name="line.570"></a>
<span class="sourceLineNo">571</span>     * @since V4.00.00<a name="line.571"></a>
<span class="sourceLineNo">572</span>     */<a name="line.572"></a>
<span class="sourceLineNo">573</span>    byte[] getPinBlock(byte keyIdx, String expPinLen, byte[] dataIn, byte mode, int timeoutMs) throws PedDevException;<a name="line.573"></a>
<span class="sourceLineNo">574</span><a name="line.574"></a>
<span class="sourceLineNo">575</span><a name="line.575"></a>
<span class="sourceLineNo">576</span>    /**<a name="line.576"></a>
<span class="sourceLineNo">577</span>     * &lt;div class="zh"&gt;扫描键盘上输入的PIN并输出由 Mode指定算法加密的 PIN BLOCK。 &lt;/div&gt;<a name="line.577"></a>
<span class="sourceLineNo">578</span>     * &lt;div class="en"&gt;Scan the PIN entered on the keyboard and output the PIN BLOCK encrypted by the algorithm specified by Mode.&lt;/div&gt;<a name="line.578"></a>
<span class="sourceLineNo">579</span>     *<a name="line.579"></a>
<span class="sourceLineNo">580</span>     *<a name="line.580"></a>
<span class="sourceLineNo">581</span>     * @param keyIdx<a name="line.581"></a>
<span class="sourceLineNo">582</span>     *            &lt;div class="zh"&gt; [1~100] TPK的索引 &lt;/div&gt; &lt;div class="en"&gt; [1~100] TPK index &lt;/div&gt;<a name="line.582"></a>
<span class="sourceLineNo">583</span>     *<a name="line.583"></a>
<span class="sourceLineNo">584</span>     * @param expPinLen<a name="line.584"></a>
<span class="sourceLineNo">585</span>     *            &lt;div class="zh"&gt; 0~12的枚举集合<a name="line.585"></a>
<span class="sourceLineNo">586</span>     *            可输入的合法密码长度字符串，应用程序把允许的密码长度全部枚举出来，并且用"，"号隔开每个长度，如允许输入4、6位密码并且允许无密码直接按确认，则该字符串应该设置为"0,4,6"。<a name="line.586"></a>
<span class="sourceLineNo">587</span>     *            若枚举0长度则示意可以不输任何数字而直接按确认键返回。<a name="line.587"></a>
<span class="sourceLineNo">588</span>     *            &lt;p&gt;<a name="line.588"></a>
<span class="sourceLineNo">589</span>     *            当mode=0x05的时候，该参数为"5"<a name="line.589"></a>
<span class="sourceLineNo">590</span>     *            &lt;/p&gt;<a name="line.590"></a>
<span class="sourceLineNo">591</span>     *            &lt;/div&gt; &lt;div class="en"&gt; Enumeration of 0-12.The enter password string with legal length. Application<a name="line.591"></a>
<span class="sourceLineNo">592</span>     *            enumerates of all possible lengths of PIN. ","will be used to separate each number of length. If no<a name="line.592"></a>
<span class="sourceLineNo">593</span>     *            PIN,or 4 or 6 digits of PIN are allowed, the string will be set as "0,4,6". 0 means that no PIN is<a name="line.593"></a>
<span class="sourceLineNo">594</span>     *            required, and pressing "Enter" will return.<a name="line.594"></a>
<span class="sourceLineNo">595</span>     *            &lt;p&gt;<a name="line.595"></a>
<span class="sourceLineNo">596</span>     *            When mode=0x05，it should be "5"<a name="line.596"></a>
<span class="sourceLineNo">597</span>     *            &lt;/p&gt;<a name="line.597"></a>
<span class="sourceLineNo">598</span>     *            &lt;/div&gt;<a name="line.598"></a>
<span class="sourceLineNo">599</span>     *<a name="line.599"></a>
<span class="sourceLineNo">600</span>     * @param dataIn<a name="line.600"></a>
<span class="sourceLineNo">601</span>     *            &lt;div class="zh"&gt;<a name="line.601"></a>
<span class="sourceLineNo">602</span>     *            &lt;ul&gt;<a name="line.602"></a>
<span class="sourceLineNo">603</span>     *            &lt;li&gt;当mode=0x00时, DataIn指向卡号移位后生成的16位主帐号。&lt;/li&gt;<a name="line.603"></a>
<span class="sourceLineNo">604</span>     *            &lt;li&gt;当mode=0x01时, 输入参数为参与PinBlock的格式化,8字节数据(根据ISO9564的规范,该数据可以是随机数、交易流水号或时间戳等)。&lt;/li&gt;<a name="line.604"></a>
<span class="sourceLineNo">605</span>     *            &lt;li&gt;当mode=0x02时, DataIn指向卡号移位后生成的16位主帐号,DataIn+16指向参与PinBlock格式化的8字节数据(根据ISO9564的规范<a name="line.605"></a>
<span class="sourceLineNo">606</span>     *            ,该数据可以是随机数、交易流水号或时间戳等,但是每个字节的高4位和低4位,均必须在0xA~0xF之间,所以当Mode为0x02时,应用需要将该8字节的数据做此检查,如果不满足要求将返回错误)&lt;/li&gt;<a name="line.606"></a>
<span class="sourceLineNo">607</span>     *            &lt;li&gt;当mode=0x03时, 为交易流水号ISN [6 Bytes,ASCII码]&lt;/li&gt;<a name="line.607"></a>
<span class="sourceLineNo">608</span>     *            &lt;li&gt;当Mode=0x05时, DataIn包含卡账号和CCS数据，格式为PANlen(1个字节) + CCSlen（1个字节） + PAN（PANlen个字节） +<a name="line.608"></a>
<span class="sourceLineNo">609</span>     *            CCS（CCSlen个字节）。其中PAN为卡账号（ASCII码），目前限定PANlen必须为18，CCSlen必须为0或者8，CCS为ASCII码格式。&lt;/li&gt;<a name="line.609"></a>
<span class="sourceLineNo">610</span>     *            &lt;li&gt;当mode=0x14时，DataIn为原始主帐号。&lt;/li&gt;<a name="line.610"></a>
<span class="sourceLineNo">611</span>     *            &lt;/ul&gt;<a name="line.611"></a>
<span class="sourceLineNo">612</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.612"></a>
<span class="sourceLineNo">613</span>     *            &lt;ul&gt;<a name="line.613"></a>
<span class="sourceLineNo">614</span>     *            &lt;li&gt;When mode=0x00, DataIn is the 16 bytes primary account number after shifting.&lt;/li&gt;<a name="line.614"></a>
<span class="sourceLineNo">615</span>     *            &lt;li&gt;When mode=0x01, Input parameters for participation in PinBlock formatting, 8 bytes data. (refer to<a name="line.615"></a>
<span class="sourceLineNo">616</span>     *            ISO9564 standard, this data can be Random number, the transaction serial number or time stamp, etc.)&lt;/li&gt;<a name="line.616"></a>
<span class="sourceLineNo">617</span>     *            &lt;li&gt;When mode=0x02, DataIn is the 16 bytes primary account number after shifting. DataIn+16 point to<a name="line.617"></a>
<span class="sourceLineNo">618</span>     *            the 8 bytes data which has participated in PinBlock formatting. (refer to ISO9564 standard, this data<a name="line.618"></a>
<span class="sourceLineNo">619</span>     *            can be Random number, the transaction serial number or time stamp,etc. But the higher 4 bits and lower<a name="line.619"></a>
<span class="sourceLineNo">620</span>     *            4 bits of each byte should between 0xA~0xF. So, if the Mode=0x02, the bottom level will do this check<a name="line.620"></a>
<span class="sourceLineNo">621</span>     *            for the 8 bytes data, it will return an error if does not meet the requirement.).&lt;/li&gt;<a name="line.621"></a>
<span class="sourceLineNo">622</span>     *            &lt;li&gt;When mode=0x03, dataIn is ISN [6 Bytes, ASCII code]&lt;/li&gt;<a name="line.622"></a>
<span class="sourceLineNo">623</span>     *            &lt;li&gt;When Mode=0x05, DataIn contains card account and CCS data. The format is PANlen (1 bytes) + CCSlen<a name="line.623"></a>
<span class="sourceLineNo">624</span>     *            (1 bytes) + PAN (PANlen byte) + CCS (CCSlen byte). In which PAN is a card account (ASCII code), the<a name="line.624"></a>
<span class="sourceLineNo">625</span>     *            current limited PANlen must be 18, CCSlen must be 0 or 8, CCS is ASCII code format.&lt;/li&gt;<a name="line.625"></a>
<span class="sourceLineNo">626</span>     *            &lt;li&gt;When mode=0x14, DataIn is the original primary account.&lt;/li&gt;<a name="line.626"></a>
<span class="sourceLineNo">627</span>     *            &lt;/ul&gt;<a name="line.627"></a>
<span class="sourceLineNo">628</span>     *            &lt;/div&gt;<a name="line.628"></a>
<span class="sourceLineNo">629</span>     *<a name="line.629"></a>
<span class="sourceLineNo">630</span>     * @param mode<a name="line.630"></a>
<span class="sourceLineNo">631</span>     *            &lt;div class="zh"&gt; PIN BLOCK的格式<a name="line.631"></a>
<span class="sourceLineNo">632</span>     *            &lt;ul&gt;<a name="line.632"></a>
<span class="sourceLineNo">633</span>     *            &lt;li&gt;0x00:ISO9564_0&lt;/li&gt;<a name="line.633"></a>
<span class="sourceLineNo">634</span>     *            &lt;li&gt;0x01:ISO9564_1&lt;/li&gt;<a name="line.634"></a>
<span class="sourceLineNo">635</span>     *            &lt;li&gt;0x02:ISO9564_3&lt;/li&gt;<a name="line.635"></a>
<span class="sourceLineNo">636</span>     *            &lt;li&gt;0x03:HK EPS&lt;/li&gt;<a name="line.636"></a>
<span class="sourceLineNo">637</span>     *            &lt;li&gt;0x04:预留&lt;/li&gt;<a name="line.637"></a>
<span class="sourceLineNo">638</span>     *            &lt;li&gt;0x05:Italy 专用模式&lt;/li&gt;<a name="line.638"></a>
<span class="sourceLineNo">639</span>     *            &lt;li&gt;0x11:使用AES_TPK加密,pinblock是日本的hit特殊模式&lt;/li&gt;<a name="line.639"></a>
<span class="sourceLineNo">640</span>     *            &lt;li&gt;0x12:使用AES_TPK加密,pinblock是日本的PKCS7模式&lt;/li&gt;<a name="line.640"></a>
<span class="sourceLineNo">641</span>     *            &lt;li&gt;0x14:使用AES_TPK加密,pinblock是ISO9564 格式4&lt;/li&gt;<a name="line.641"></a>
<span class="sourceLineNo">642</span>     *            &lt;li&gt;0x50:3DES-CBC&lt;/li&gt;<a name="line.642"></a>
<span class="sourceLineNo">643</span>     *            &lt;/ul&gt;<a name="line.643"></a>
<span class="sourceLineNo">644</span>     *            &lt;/div&gt; &lt;div class="en"&gt; PIN BLOCK Format<a name="line.644"></a>
<span class="sourceLineNo">645</span>     *            &lt;ul&gt;<a name="line.645"></a>
<span class="sourceLineNo">646</span>     *            &lt;li&gt;0x00:ISO9564_0&lt;/li&gt;<a name="line.646"></a>
<span class="sourceLineNo">647</span>     *            &lt;li&gt;0x01:ISO9564_1&lt;/li&gt;<a name="line.647"></a>
<span class="sourceLineNo">648</span>     *            &lt;li&gt;0x02:ISO9564_3&lt;/li&gt;<a name="line.648"></a>
<span class="sourceLineNo">649</span>     *            &lt;li&gt;0x03:HK EPS -EPS PINBLOCK Format&lt;/li&gt;<a name="line.649"></a>
<span class="sourceLineNo">650</span>     *            &lt;li&gt;0x04:Reserved&lt;/li&gt;<a name="line.650"></a>
<span class="sourceLineNo">651</span>     *            &lt;li&gt;0x05:Italy special mode&lt;/li&gt;<a name="line.651"></a>
<span class="sourceLineNo">652</span>     *            &lt;li&gt;0x11:Using AES_TPK encryption, pinblock is Japan's hit special mode&lt;/li&gt;<a name="line.652"></a>
<span class="sourceLineNo">653</span>     *            &lt;li&gt;0x12:Using AES_TPK encryption, pinblock is Japan's PKCS7 mode&lt;/li&gt;<a name="line.653"></a>
<span class="sourceLineNo">654</span>     *            &lt;li&gt;0x14:Using AES_TPK encryption, pinblock is in ISO9564 format 4&lt;/li&gt;<a name="line.654"></a>
<span class="sourceLineNo">655</span>     *            &lt;li&gt;0x50:3DES-CBC&lt;/li&gt;<a name="line.655"></a>
<span class="sourceLineNo">656</span>     *            &lt;/ul&gt;<a name="line.656"></a>
<span class="sourceLineNo">657</span>     *            &lt;/div&gt;<a name="line.657"></a>
<span class="sourceLineNo">658</span>     *<a name="line.658"></a>
<span class="sourceLineNo">659</span>     * @param timeoutMs<a name="line.659"></a>
<span class="sourceLineNo">660</span>     *            &lt;div class="zh"&gt;<a name="line.660"></a>
<span class="sourceLineNo">661</span>     *            &lt;p&gt;<a name="line.661"></a>
<span class="sourceLineNo">662</span>     *            输入PIN的超时时间,单位：毫秒 最大值为300000ms<a name="line.662"></a>
<span class="sourceLineNo">663</span>     *            &lt;/p&gt;<a name="line.663"></a>
<span class="sourceLineNo">664</span>     *            &lt;/div&gt;<a name="line.664"></a>
<span class="sourceLineNo">665</span>     *            &lt;div class="en"&gt;<a name="line.665"></a>
<span class="sourceLineNo">666</span>     *            &lt;p&gt;<a name="line.666"></a>
<span class="sourceLineNo">667</span>     *            The timeout of PIN entry [unit:ms] Maximum is 300000ms.<a name="line.667"></a>
<span class="sourceLineNo">668</span>     *            &lt;/p&gt;<a name="line.668"></a>
<span class="sourceLineNo">669</span>     *            &lt;/div&gt;<a name="line.669"></a>
<span class="sourceLineNo">670</span>     *<a name="line.670"></a>
<span class="sourceLineNo">671</span>     * @param controlTime &lt;div class="zh"&gt; 等待第二个及之后的按键的超时时间,单位：毫秒(超过30s的为30s) &lt;/div&gt;<a name="line.671"></a>
<span class="sourceLineNo">672</span>     *        &lt;div class="en"&gt; The time-out for waiting for the second and subsequent keys in milliseconds (30 seconds for more than 30 seconds) &lt;/div&gt;<a name="line.672"></a>
<span class="sourceLineNo">673</span>     *<a name="line.673"></a>
<span class="sourceLineNo">674</span>     * @return &lt;div class="zh"&gt; 8/16字节的PINBlock(Mode是0x11/0x12/0x14是16字节)  &lt;/div&gt;<a name="line.674"></a>
<span class="sourceLineNo">675</span>     * &lt;div class="en"&gt;8/16 bytes of PINBlock (16 bytes when Mode is 0x11/0x12/0x14).&lt;/div&gt;<a name="line.675"></a>
<span class="sourceLineNo">676</span>     *<a name="line.676"></a>
<span class="sourceLineNo">677</span>     * @throws PedDevException<a name="line.677"></a>
<span class="sourceLineNo">678</span>     * @since V4.00.00<a name="line.678"></a>
<span class="sourceLineNo">679</span>     */<a name="line.679"></a>
<span class="sourceLineNo">680</span>    byte[] getPinBlock(byte keyIdx, String expPinLen, byte[] dataIn, byte mode, int timeoutMs, int controlTime)throws PedDevException;<a name="line.680"></a>
<span class="sourceLineNo">681</span><a name="line.681"></a>
<span class="sourceLineNo">682</span><a name="line.682"></a>
<span class="sourceLineNo">683</span>    /**<a name="line.683"></a>
<span class="sourceLineNo">684</span>     * &lt;div class="zh"&gt; 用KeyIdx指定的MAC密钥对DataIn进行mode指定的算法进行MAC运算，将MAC结果返回。&lt;/div&gt;<a name="line.684"></a>
<span class="sourceLineNo">685</span>     * &lt;div class="en"&gt; To use KeyIdx MAC key calculate the DataIn following the specified Mode algorithm, return the MAC result.&lt;/div&gt;<a name="line.685"></a>
<span class="sourceLineNo">686</span>     *<a name="line.686"></a>
<span class="sourceLineNo">687</span>     * @param keyIndex<a name="line.687"></a>
<span class="sourceLineNo">688</span>     *            &lt;div class="zh"&gt; [1~100] TAK的索引 &lt;/div&gt; &lt;div class="en"&gt; [1~100] TAK index &lt;/div&gt;<a name="line.688"></a>
<span class="sourceLineNo">689</span>     *<a name="line.689"></a>
<span class="sourceLineNo">690</span>     * @param dataIn<a name="line.690"></a>
<span class="sourceLineNo">691</span>     *            &lt;div class="zh"&gt; 需进行 MAC 运算的数据包.DataIn在mode=0和2时最大支持8K bytes,其他模式最大2048 bytes, 长度不为8字节整除，则自动补"\x00"。 &lt;/div&gt;<a name="line.691"></a>
<span class="sourceLineNo">692</span>     *            &lt;div class="en"&gt; The data packets that need to perform MAC operations. DataIn supports a maximum of 8K bytes when mode=0 and 2, and a maximum of 2048 bytes in other modes.<a name="line.692"></a>
<span class="sourceLineNo">693</span>     *            If the length is not divisible by 8 bytes, "\x00" will be automatically filled.&lt;/div&gt;<a name="line.693"></a>
<span class="sourceLineNo">694</span>     *<a name="line.694"></a>
<span class="sourceLineNo">695</span>     * @param mode<a name="line.695"></a>
<span class="sourceLineNo">696</span>     *            &lt;div class="zh"&gt;<a name="line.696"></a>
<span class="sourceLineNo">697</span>     *            &lt;ul&gt;<a name="line.697"></a>
<span class="sourceLineNo">698</span>     *            &lt;li&gt;0x00:将BLOCK1用MAC密钥做DES/TDES加密，加密结果与BLOCK2进行逐位异或后再用TAK做DES/TDES加密，依次进行得到8字节的加密结果。&lt;/li&gt;<a name="line.698"></a>
<span class="sourceLineNo">699</span>     *            &lt;li&gt;0x01:将BLOCK1和BLOCK2进行逐位异或，异或结果与BLOCK3进行逐位异或，依次进行，最后得到8字节的异或结果，将该结果用TAK进行DES/TDES加密运算。&lt;/li&gt;<a name="line.699"></a>
<span class="sourceLineNo">700</span>     *            &lt;li&gt;0x02:ANSIX9.19规范，将BLOCK1用TAK做DES加密(只取前8个字节的key)，加密结果与BLOCK2进行逐位异或后再用TAK做DES加密，依次进行得到8字节的加密结果，直到最后一次采用DES/TDES加密。&lt;/li&gt;<a name="line.700"></a>
<span class="sourceLineNo">701</span>     *            &lt;li&gt;0x03:CMAC算法。&lt;/li&gt;<a name="line.701"></a>
<span class="sourceLineNo">702</span>     *            &lt;li&gt;0x05: hmac-sha256算法。&lt;/li&gt;<a name="line.702"></a>
<span class="sourceLineNo">703</span>     *            &lt;/ul&gt;<a name="line.703"></a>
<span class="sourceLineNo">704</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.704"></a>
<span class="sourceLineNo">705</span>     *            &lt;ul&gt;<a name="line.705"></a>
<span class="sourceLineNo">706</span>     *            &lt;li&gt;0x00: Doing DES/TDES encryption for BLOCK1 by usingMAC key. Doing DES/TDES encryption again by<a name="line.706"></a>
<span class="sourceLineNo">707</span>     *            using TAK when and after bitwise XOR the previous encryption result with BLOCK2. Processing in turn to<a name="line.707"></a>
<span class="sourceLineNo">708</span>     *            get the 8 bytes encryption result.&lt;/li&gt;<a name="line.708"></a>
<span class="sourceLineNo">709</span>     *            &lt;li&gt;0x01: Doing bitwise XOR for BLOCK1 and BLOCK2; Do bitwise XOR again by using previous XOR<a name="line.709"></a>
<span class="sourceLineNo">710</span>     *            result with BLOCK3. Do it in turn and finally get the 8 bytes XOR result. Using TAK to process<a name="line.710"></a>
<span class="sourceLineNo">711</span>     *            DES/TDES encryption for the result&lt;/li&gt;<a name="line.711"></a>
<span class="sourceLineNo">712</span>     *            &lt;li&gt;0x02: ANSIX9.19 standard, Do DES encryption for BLOCK1 by using TAK (only take the first 8<a name="line.712"></a>
<span class="sourceLineNo">713</span>     *            bytes of key). The encryption result wills bitwise XOR with BLOCK2,and then doing DES encryption by<a name="line.713"></a>
<span class="sourceLineNo">714</span>     *            using TAK again. Do it in turn and get the 8 bytes encryption result. Using DES/TDES to encrypt in the<a name="line.714"></a>
<span class="sourceLineNo">715</span>     *            last time.&lt;/li&gt;<a name="line.715"></a>
<span class="sourceLineNo">716</span>     *            &lt;li&gt;0x03: CMAC algorithm.&lt;/li&gt;<a name="line.716"></a>
<span class="sourceLineNo">717</span>     *            &lt;li&gt;0x05: HMAC-SHA256 algorithm.&lt;/li&gt;<a name="line.717"></a>
<span class="sourceLineNo">718</span>     *            &lt;/ul&gt;<a name="line.718"></a>
<span class="sourceLineNo">719</span>     *            &lt;/div&gt;<a name="line.719"></a>
<span class="sourceLineNo">720</span>     *<a name="line.720"></a>
<span class="sourceLineNo">721</span>     * @return &lt;div class="zh"&gt; 返回MAC结果。当mode等于0x05，输出长度为32字节。其他为8字节。&lt;/div&gt;<a name="line.721"></a>
<span class="sourceLineNo">722</span>     * &lt;div class="en"&gt; return the MAC data。When the mode is 0x05, the output length is 32 bytes. Others are 8 bytes.&lt;/div&gt;<a name="line.722"></a>
<span class="sourceLineNo">723</span>     *<a name="line.723"></a>
<span class="sourceLineNo">724</span>     * @throws PedDevException<a name="line.724"></a>
<span class="sourceLineNo">725</span>     * @since V4.00.00<a name="line.725"></a>
<span class="sourceLineNo">726</span>     */<a name="line.726"></a>
<span class="sourceLineNo">727</span><a name="line.727"></a>
<span class="sourceLineNo">728</span>    byte[] getMac(byte keyIndex, byte[] dataIn, byte mode) throws PedDevException;<a name="line.728"></a>
<span class="sourceLineNo">729</span><a name="line.729"></a>
<span class="sourceLineNo">730</span><a name="line.730"></a>
<span class="sourceLineNo">731</span>    /**<a name="line.731"></a>
<span class="sourceLineNo">732</span>     * &lt;div class="zh"&gt; 在PED上输入PIN，并使DUKPT的PIN密钥计算PINBlock。&lt;/div&gt;<a name="line.732"></a>
<span class="sourceLineNo">733</span>     * &lt;div class="en"&gt; PINBlock Input the PIN on PED,and use the PINkey of DUKPT to calculate the PINBlock.&lt;/div&gt;<a name="line.733"></a>
<span class="sourceLineNo">734</span>     *<a name="line.734"></a>
<span class="sourceLineNo">735</span>     * @param groupIndex<a name="line.735"></a>
<span class="sourceLineNo">736</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100] DUKPT key group id &lt;/div&gt;<a name="line.736"></a>
<span class="sourceLineNo">737</span>     *<a name="line.737"></a>
<span class="sourceLineNo">738</span>     * @param expPinLen<a name="line.738"></a>
<span class="sourceLineNo">739</span>     *            &lt;div class="zh"&gt; 0~12的枚举集合<a name="line.739"></a>
<span class="sourceLineNo">740</span>     *            可输入的合法密码长度字符串，应用程序把允许的密码长度全部枚举出来，并且用"，"号隔开每个长度，如允许输入4、6位密码并且允许无密码直接按确认，则该字符串应该设置为"0,4,6"。<a name="line.740"></a>
<span class="sourceLineNo">741</span>     *            若枚举0长度则示意可以不输任何数字而直接按确认键返回。&lt;/div&gt; &lt;div class="en"&gt; Enumeration of 0-12.The enter password string with<a name="line.741"></a>
<span class="sourceLineNo">742</span>     *            legal length. Application enumerates of all possible lengths of PIN. ","will be used to separate each<a name="line.742"></a>
<span class="sourceLineNo">743</span>     *            number of length. If no PIN,or 4 or 6 digits of PIN are allowed, the string will be set as "0,4,6". 0<a name="line.743"></a>
<span class="sourceLineNo">744</span>     *            means that no PIN is required, and pressing "Enter" will return. &lt;/div&gt;<a name="line.744"></a>
<span class="sourceLineNo">745</span>     *<a name="line.745"></a>
<span class="sourceLineNo">746</span>     * @param dataIn<a name="line.746"></a>
<span class="sourceLineNo">747</span>     *            &lt;div class="zh"&gt;<a name="line.747"></a>
<span class="sourceLineNo">748</span>     *            &lt;ul&gt;<a name="line.748"></a>
<span class="sourceLineNo">749</span>     *            &lt;li&gt;当mode=0时, DataIn指向卡号移位后生成的16位主帐号。&lt;/li&gt;<a name="line.749"></a>
<span class="sourceLineNo">750</span>     *            &lt;li&gt;当mode=1时,<a name="line.750"></a>
<span class="sourceLineNo">751</span>     *            输入参数为参与PinBlock的格式化,8字节数据(根据ISO9564的规范,该数据可以是随机数、交易流水号或时间戳等)。&lt;/li&gt;<a name="line.751"></a>
<span class="sourceLineNo">752</span>     *            &lt;li&gt;当mode=2时,<a name="line.752"></a>
<span class="sourceLineNo">753</span>     *            DataIn指向卡号移位后生成的16位主帐号,DataIn+16指向参与PinBlock格式化的8字节数据(根据ISO9564的规范<a name="line.753"></a>
<span class="sourceLineNo">754</span>     *            ,该数据可以是随机数、交易流水号或时间戳等,但是每个字节的高4位和低4位,均必须在0xA~0xF之间,所以当Mode为0x02时,应用需要将该8字节的数据做此检查,如果不满足要求将返回错误)&lt;/li&gt;<a name="line.754"></a>
<span class="sourceLineNo">755</span>     *            &lt;li&gt;当mode=3时, 为交易流水号ISN [6 Bytes,ASCII码]&lt;/li&gt;<a name="line.755"></a>
<span class="sourceLineNo">756</span>     *            &lt;/ul&gt;<a name="line.756"></a>
<span class="sourceLineNo">757</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.757"></a>
<span class="sourceLineNo">758</span>     *            &lt;ul&gt;<a name="line.758"></a>
<span class="sourceLineNo">759</span>     *            &lt;li&gt;When mode=0, DataIn is the 16 bytes primary account number after shifting.&lt;/li&gt;<a name="line.759"></a>
<span class="sourceLineNo">760</span>     *            &lt;li&gt;When mode=1, Input parameters for participation in PinBlock formatting, 8 bytes data.<a name="line.760"></a>
<span class="sourceLineNo">761</span>     *            (refer to ISO9564 standard, this data can be Random number, the transaction serial number or time<a name="line.761"></a>
<span class="sourceLineNo">762</span>     *            stamp, etc.)&lt;/li&gt;<a name="line.762"></a>
<span class="sourceLineNo">763</span>     *            &lt;li&gt;When mode=2, DataIn is the 16 bytes primary account number after shifting. DataIn+16 point<a name="line.763"></a>
<span class="sourceLineNo">764</span>     *            to the 8 bytes data which has participated in PinBlock formatting. (refer to ISO9564 standard, this<a name="line.764"></a>
<span class="sourceLineNo">765</span>     *            data can be Random number, the transaction serial number or time stamp,etc. But the higher 4 bits and<a name="line.765"></a>
<span class="sourceLineNo">766</span>     *            lower 4 bits of each byte should between 0xA~0xF. So, if the Mode=0x02, the bottom level will do this<a name="line.766"></a>
<span class="sourceLineNo">767</span>     *            check for the 8 bytes data, it will return an error if does not meet the requirement.).&lt;/li&gt;<a name="line.767"></a>
<span class="sourceLineNo">768</span>     *            &lt;li&gt;When mode=3, dataIn is ISN [6 Bytes, ASCII code]&lt;/li&gt;<a name="line.768"></a>
<span class="sourceLineNo">769</span>     *            &lt;/ul&gt;<a name="line.769"></a>
<span class="sourceLineNo">770</span>     *            &lt;/div&gt;<a name="line.770"></a>
<span class="sourceLineNo">771</span>     *<a name="line.771"></a>
<span class="sourceLineNo">772</span>     * @param mode<a name="line.772"></a>
<span class="sourceLineNo">773</span>     *            &lt;div class="zh"&gt;<a name="line.773"></a>
<span class="sourceLineNo">774</span>     *                &lt;ul&gt;<a name="line.774"></a>
<span class="sourceLineNo">775</span>     *                    &lt;li&gt;0: ISO9564 格式 0 KSN 自动加 1&lt;/li&gt;<a name="line.775"></a>
<span class="sourceLineNo">776</span>     *                    &lt;li&gt;1: ISO9564 格式 1 KSN 自动加 1 &lt;/li&gt;<a name="line.776"></a>
<span class="sourceLineNo">777</span>     *                    &lt;li&gt;2: ISO9564 格式 3 KSN 自动加 1 &lt;/li&gt;<a name="line.777"></a>
<span class="sourceLineNo">778</span>     *                    &lt;li&gt;3: HK EPS 格式 KSN 自动加 1&lt;/li&gt;<a name="line.778"></a>
<span class="sourceLineNo">779</span>     *                    &lt;li&gt;6: AS2805 zero length PIN block mode。该模式不会要求输入PIN，不会弹出输PIN窗口。KSN 自动加1 &lt;/li&gt;<a name="line.779"></a>
<span class="sourceLineNo">780</span>     *                    &lt;li&gt;20: ISO9564 格式 0 KSN 不自动加 1 &lt;/li&gt;<a name="line.780"></a>
<span class="sourceLineNo">781</span>     *                    &lt;li&gt;21: ISO9564 格式 1 KSN 不自动加 1&lt;/li&gt;<a name="line.781"></a>
<span class="sourceLineNo">782</span>     *                    &lt;li&gt;22: ISO9564 格式 3 KSN 不自动加 1&lt;/li&gt;<a name="line.782"></a>
<span class="sourceLineNo">783</span>     *                    &lt;li&gt;23: HK EPS 格式 KSN 不自动加 1&lt;/li&gt;<a name="line.783"></a>
<span class="sourceLineNo">784</span>     *                    &lt;li&gt;26:AS2805 zero length PIN block mode。该模式不会要求输入PIN，不会弹出输PIN窗口。KSN 不自动加1&lt;/li&gt;<a name="line.784"></a>
<span class="sourceLineNo">785</span>     *                &lt;/ul&gt;&lt;/div&gt;<a name="line.785"></a>
<span class="sourceLineNo">786</span>     *             &lt;div class="en"&gt;<a name="line.786"></a>
<span class="sourceLineNo">787</span>     *                 &lt;ul&gt;<a name="line.787"></a>
<span class="sourceLineNo">788</span>     *                    &lt;li&gt;0: ISO9564_0, KSN automatically incremented by 1&lt;/li&gt;<a name="line.788"></a>
<span class="sourceLineNo">789</span>     *                    &lt;li&gt;1: ISO9564_1, KSN automatically incremented by 1&lt;/li&gt;<a name="line.789"></a>
<span class="sourceLineNo">790</span>     *                    &lt;li&gt;2: ISO9564_3, KSN automatically incremented by 1&lt;/li&gt;<a name="line.790"></a>
<span class="sourceLineNo">791</span>     *                    &lt;li&gt;3: HK EPS,KSN automatically incremented by 1&lt;/li&gt;<a name="line.791"></a>
<span class="sourceLineNo">792</span>     *                    &lt;li&gt;6: AS2805 zero length PIN block mode. This mode will not ask for a PIN, and will not pop up a PIN input window. KSN automatically incremented by 1 &lt;/li&gt;<a name="line.792"></a>
<span class="sourceLineNo">793</span>     *                    &lt;li&gt;20: ISO9564_0, KSN does not automatically increase by 1 &lt;/li&gt;<a name="line.793"></a>
<span class="sourceLineNo">794</span>     *                    &lt;li&gt;21: ISO9564_1, KSN does not automatically increase by 1&lt;/li&gt;<a name="line.794"></a>
<span class="sourceLineNo">795</span>     *                    &lt;li&gt;22: ISO9564_3, KSN does not automatically increase by 1&lt;/li&gt;<a name="line.795"></a>
<span class="sourceLineNo">796</span>     *                    &lt;li&gt;23: HK EPS, KSN does not automatically increase by 1&lt;/li&gt;<a name="line.796"></a>
<span class="sourceLineNo">797</span>     *                    &lt;li&gt;26: AS2805 zero length PIN block mode. This mode will not ask for a PIN, and will not pop up a PIN input window. KSN does not automatically incremented by 1 &lt;/li&gt;<a name="line.797"></a>
<span class="sourceLineNo">798</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.798"></a>
<span class="sourceLineNo">799</span>     * @param timeoutMs<a name="line.799"></a>
<span class="sourceLineNo">800</span>     *            &lt;div class="zh"&gt;<a name="line.800"></a>
<span class="sourceLineNo">801</span>     *            &lt;p&gt;<a name="line.801"></a>
<span class="sourceLineNo">802</span>     *            输入PIN的超时时间,单位：毫秒 最大值为300000ms<a name="line.802"></a>
<span class="sourceLineNo">803</span>     *            &lt;/p&gt;<a name="line.803"></a>
<span class="sourceLineNo">804</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.804"></a>
<span class="sourceLineNo">805</span>     *            &lt;p&gt;<a name="line.805"></a>
<span class="sourceLineNo">806</span>     *            The timeout of PIN entry [unit:ms] Maximum is 300000ms.<a name="line.806"></a>
<span class="sourceLineNo">807</span>     *            &lt;/p&gt;<a name="line.807"></a>
<span class="sourceLineNo">808</span>     *            &lt;/div&gt;<a name="line.808"></a>
<span class="sourceLineNo">809</span>     *<a name="line.809"></a>
<span class="sourceLineNo">810</span>     * @return DUKPTResult {@link DUKPTResult}<a name="line.810"></a>
<span class="sourceLineNo">811</span>     * @throws PedDevException<a name="line.811"></a>
<span class="sourceLineNo">812</span>     * @since V4.00.00<a name="line.812"></a>
<span class="sourceLineNo">813</span>     */<a name="line.813"></a>
<span class="sourceLineNo">814</span>    DUKPTResult getDUKPTPin(byte groupIndex, String expPinLen, byte[] dataIn, byte mode, int timeoutMs) throws PedDevException;<a name="line.814"></a>
<span class="sourceLineNo">815</span><a name="line.815"></a>
<span class="sourceLineNo">816</span><a name="line.816"></a>
<span class="sourceLineNo">817</span>    /**<a name="line.817"></a>
<span class="sourceLineNo">818</span>     * &lt;div class="zh"&gt; 使用DUKPT的MAC密钥计算MAC。&lt;/div&gt;<a name="line.818"></a>
<span class="sourceLineNo">819</span>     * &lt;div class="en"&gt; Use MAC Key to calculate MAC.&lt;/div&gt;<a name="line.819"></a>
<span class="sourceLineNo">820</span>     *<a name="line.820"></a>
<span class="sourceLineNo">821</span>     * @param groupIndex<a name="line.821"></a>
<span class="sourceLineNo">822</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100] DUKPT key group index id &lt;/div&gt;<a name="line.822"></a>
<span class="sourceLineNo">823</span>     *<a name="line.823"></a>
<span class="sourceLineNo">824</span>     * @param dataIn<a name="line.824"></a>
<span class="sourceLineNo">825</span>     *            &lt;div class="zh"&gt; 指向需要计算MAC的数据内容 &lt;/div&gt; &lt;div class="en"&gt; The MAC data content needs to be calculated&lt;/div&gt;<a name="line.825"></a>
<span class="sourceLineNo">826</span>     *<a name="line.826"></a>
<span class="sourceLineNo">827</span>     * @param mode &lt;div class="zh"&gt;<a name="line.827"></a>
<span class="sourceLineNo">828</span>     * &lt;ul&gt;<a name="line.828"></a>
<span class="sourceLineNo">829</span>     * &lt;li&gt;0:将 BLOCK1 用 MAC 密钥做 TDES 加密,加密结果与 BLOCK2 进行逐位异或后再用 MAC 密钥 做 TDES 加密,依次进行得到 8 字节的加密结果。 KSN 自动加 1 &lt;/li&gt;<a name="line.829"></a>
<span class="sourceLineNo">830</span>     * &lt;li&gt;1:将 BLOCK1 和 BLOCK2 进行逐位异或,异或结果与 BLOCK3 进行逐位异或,依次进行,最后得 到 8 字节的异或结果,将该结果用 MAC 密钥进行TDES 加密运算。 KSN 自动加 1 &lt;/li&gt;<a name="line.830"></a>
<span class="sourceLineNo">831</span>     * &lt;li&gt;2: ANSIX9.19 规范,将 BLOCK1 用 MAC 密钥做DES 加密(只取前 8 个字节的 key), 加密结果与BLOCK2进行逐位异或后再用 MAC 密钥做 DES 加密,依次进行得到 8 字节的加密结果, 直到最后一次采用TDES 加密。 KSN 自动加 1&lt;/li&gt;<a name="line.831"></a>
<span class="sourceLineNo">832</span>     * &lt;li&gt;5: hmac-sha256模式。将MAC密钥作为hmac 密钥。使用DUKPT_MAC_BOTH_KEY（request and response MAC密钥），KSN 自动加 1&lt;/li&gt;<a name="line.832"></a>
<span class="sourceLineNo">833</span>     * &lt;li&gt;20:将 BLOCK1 用 MAC 密钥做 TDES 加密,加密结果与 BLOCK2 进行逐位异或后再用 MAC 密钥 做 TDES 加密,依次进行得到 8 字节的加密结果。 KSN 不自动加1&lt;/li&gt;<a name="line.833"></a>
<span class="sourceLineNo">834</span>     * &lt;li&gt;21:将 BLOCK1 和 BLOCK2 进行逐位异或,异或结果与 BLOCK3 进行逐位异或,依次进行,最后得 到 8 字节的异或结果,将该结果用 MAC 密钥进行TDES 加密运算。 KSN 不自动加 1&lt;/li&gt;<a name="line.834"></a>
<span class="sourceLineNo">835</span>     * &lt;li&gt;22:ANSIX9.19 规范,将 BLOCK1 用 MAC 密钥做DES加密(只取前 8个字节的 key), 加密结果与 BLOCK2 进行逐位异或后再用 MAC 密钥做 DES 加密,依次进行得到 8 字节的加密结果, 直到最后一次采用TDES 加密。 KSN 不自动加 1其它值保留扩展 MAC 算法。&lt;/li&gt;<a name="line.835"></a>
<span class="sourceLineNo">836</span>     * &lt;li&gt;25: hmac-sha256模式。将MAC密钥作为hmac 密钥。使用DUKPT_MAC_BOTH_KEY（request and response MAC密钥），KSN 不自动加1&lt;/li&gt;<a name="line.836"></a>
<span class="sourceLineNo">837</span>     * &lt;li&gt;40: 将 BLOCK1 用 MAC 密钥做 TDES 加密,加密结果与 BLOCK2 进行逐位异或后再用 MAC 密钥 做 TDES 加密,依次进行得到 8 字节的加密结果。 KSN 不自动加 1&lt;/li&gt;<a name="line.837"></a>
<span class="sourceLineNo">838</span>     * &lt;li&gt;41:将 BLOCK1 和 BLOCK2 进行逐位异或,异或结果与 BLOCK3 进行逐位异或,依次进行,最后得 到 8 字节的异或结果,将该结果用 MAC 密钥进行TDES 加密运算。 KSN 不自动加 1&lt;/li&gt;<a name="line.838"></a>
<span class="sourceLineNo">839</span>     * &lt;li&gt;42:ANSIX9.19 规范,将 BLOCK1 用 MAC 密钥做DES加密(只取前 8个字节的 key),加密结果与 BLOCK2 进行逐位异或后再用 TAK 做 DES 加密,依次进行得到 8 字节的加密结果,直到最后一次采用 TDES加密。 KSN 不自动加 1 其它值保留扩展 MAC 算法。&lt;/li&gt;<a name="line.839"></a>
<span class="sourceLineNo">840</span>     * &lt;li&gt;45:hmac-sha256模式。将MAC密钥作为hmac 密钥。使用DUKPT_MAC_RSP_KEY（response MAC密钥），KSN 不自动加1&lt;/li&gt;<a name="line.840"></a>
<span class="sourceLineNo">841</span>     * &lt;/ul&gt;<a name="line.841"></a>
<span class="sourceLineNo">842</span>     * &lt;/div&gt;<a name="line.842"></a>
<span class="sourceLineNo">843</span>     * &lt;div class="en"&gt;<a name="line.843"></a>
<span class="sourceLineNo">844</span>     * &lt;ul&gt;<a name="line.844"></a>
<span class="sourceLineNo">845</span>     * &lt;li&gt;0:Doing TDES encryption for BLOCK1 by using MAC key. Doing TDES encryption again by using MAC key when<a name="line.845"></a>
<span class="sourceLineNo">846</span>     *       and after bitwise XOR the previous encryption result with BLOCK2. Processing in turn to get the 8 bytes<a name="line.846"></a>
<span class="sourceLineNo">847</span>     *       encryption result.KSN auto-add 1 &lt;/li&gt;<a name="line.847"></a>
<span class="sourceLineNo">848</span>     * &lt;li&gt;1:Doing bitwise XOR for BLOCK1 and BLOCK2; Do bitwise XOR again by using previous XOR result with<a name="line.848"></a>
<span class="sourceLineNo">849</span>     *       BLOCK3. Do it in turn and finally get the 8 bytes XOR result. Using MAC key to process TDES encryption for the<a name="line.849"></a>
<span class="sourceLineNo">850</span>     *       result.KSN auto-add 1 &lt;/li&gt;<a name="line.850"></a>
<span class="sourceLineNo">851</span>     * &lt;li&gt;2:ANSIX9.19 standard, Do DES encryption for BLOCK1 by using MAC key (only take the<a name="line.851"></a>
<span class="sourceLineNo">852</span>     *       first 8 bytes of key). The encryption result wills bitwise XOR with BLOCK2,and then doing DES encryption by using<a name="line.852"></a>
<span class="sourceLineNo">853</span>     *       MAC key again. Do it in turn and get the 8 bytes encryption result. Using TDES to encrypt in the last time.KSN<a name="line.853"></a>
<span class="sourceLineNo">854</span>     *       auto-add 1 &lt;/li&gt;<a name="line.854"></a>
<span class="sourceLineNo">855</span>     * &lt;li&gt;5:hmac-sha256 mode. Use the MAC key as the hmac key. Using DUKPT_MAC_BOTH_KEY (request and response MAC key), KSN is automatically incremented by 1&lt;/li&gt;<a name="line.855"></a>
<span class="sourceLineNo">856</span>     * &lt;li&gt;20: Doing TDES encryption for BLOCK1 by using MAC key. Doing TDES encryption again by using MAC key when<a name="line.856"></a>
<span class="sourceLineNo">857</span>     *        and after bitwise XOR the previous encryption result with BLOCK2. Processing in turn to get the 8 bytes<a name="line.857"></a>
<span class="sourceLineNo">858</span>     *        encryption result.KSN won't auto-add 1&lt;/li&gt;<a name="line.858"></a>
<span class="sourceLineNo">859</span>     * &lt;li&gt;21:Doing bitwise XOR for BLOCK1 and BLOCK2; Do bitwise XOR again by using previous XOR result with<a name="line.859"></a>
<span class="sourceLineNo">860</span>     *        BLOCK3. Do it in turn and finally get the 8 bytes XOR result. Using MAC key to process TDES encryption for the<a name="line.860"></a>
<span class="sourceLineNo">861</span>     *        result.KSN won't auto-add 1&lt;/li&gt;<a name="line.861"></a>
<span class="sourceLineNo">862</span>     * &lt;li&gt;22: ANSIX9.19 standard, Do DES encryption for BLOCK1 by using MAC<a name="line.862"></a>
<span class="sourceLineNo">863</span>     *        key (only take the first 8 bytes of key). The encryption result wills bitwise XOR with BLOCK2,and then doing DES<a name="line.863"></a>
<span class="sourceLineNo">864</span>     *        encryption by using MAC key again. Do it in turn and get the 8 bytes encryption result. Using TDES to encrypt in<a name="line.864"></a>
<span class="sourceLineNo">865</span>     *        the last time.KSN won't auto-add 1&lt;/li&gt;<a name="line.865"></a>
<span class="sourceLineNo">866</span>     * &lt;li&gt;25:hmac-sha256 mode. Use the MAC key as the hmac key. With DUKPT_MAC_BOTH_KEY (request and response MAC key), KSN is not automatically incremented by 1&lt;/li&gt;<a name="line.866"></a>
<span class="sourceLineNo">867</span>     * &lt;li&gt;40:Doing TDES encryption for BLOCK1 by using MAC key. Doing TDES encryption again by using MAC key when<a name="line.867"></a>
<span class="sourceLineNo">868</span>     *        and after bitwise XOR the previous encryption result with BLOCK2. Processing in turn to get the 8 bytes<a name="line.868"></a>
<span class="sourceLineNo">869</span>     *        encryption result.KSN won't auto-add 1 &lt;/li&gt;<a name="line.869"></a>
<span class="sourceLineNo">870</span>     * &lt;li&gt;41: Doing bitwise XOR for BLOCK1 and BLOCK2; Do bitwise XOR again by using previous XOR result with<a name="line.870"></a>
<span class="sourceLineNo">871</span>     *        BLOCK3. Do it in turn and finally get the 8 bytes XOR result. Using MAC key to process TDES encryption for the<a name="line.871"></a>
<span class="sourceLineNo">872</span>     *        result.KSN won't auto-add 1 &lt;/li&gt;<a name="line.872"></a>
<span class="sourceLineNo">873</span>     * &lt;li&gt;42:ANSIX9.19 standard, Do DES encryption for BLOCK1 by using MAC key (only take<a name="line.873"></a>
<span class="sourceLineNo">874</span>     *        the first 8 bytes of key). The encryption result wills bitwise XOR with BLOCK2,and then doing DES encryption by<a name="line.874"></a>
<span class="sourceLineNo">875</span>     *        using MAC key again. Do it in turn and get the 8 bytes encryption result. Using TDES to encrypt in the last<a name="line.875"></a>
<span class="sourceLineNo">876</span>     *        time.KSN won't auto-add 1&lt;/li&gt;<a name="line.876"></a>
<span class="sourceLineNo">877</span>     * &lt;li&gt;45:hmac-sha256 mode. Use the MAC key as the hmac key. If DUKPT_MAC_RSP_KEY (response MAC key) is used, KSN is not automatically incremented by 1&lt;/li&gt;<a name="line.877"></a>
<span class="sourceLineNo">878</span>     * &lt;/ul&gt;<a name="line.878"></a>
<span class="sourceLineNo">879</span>     * &lt;/div&gt;<a name="line.879"></a>
<span class="sourceLineNo">880</span>     *<a name="line.880"></a>
<span class="sourceLineNo">881</span>     * @return {@link DUKPTResult}<a name="line.881"></a>
<span class="sourceLineNo">882</span>     * @throws PedDevException<a name="line.882"></a>
<span class="sourceLineNo">883</span>     * @since V4.00.00<a name="line.883"></a>
<span class="sourceLineNo">884</span>     */<a name="line.884"></a>
<span class="sourceLineNo">885</span>    DUKPTResult getDUKPTMac(byte groupIndex, byte[] dataIn, byte mode) throws PedDevException;<a name="line.885"></a>
<span class="sourceLineNo">886</span><a name="line.886"></a>
<span class="sourceLineNo">887</span><a name="line.887"></a>
<span class="sourceLineNo">888</span>    /**<a name="line.888"></a>
<span class="sourceLineNo">889</span>     * &lt;div class="zh"&gt; 获取密钥的KCV值，以供对话双方进行密钥验证，用指定的密钥及算法对一段数据进行加密，&lt;/div&gt;<a name="line.889"></a>
<span class="sourceLineNo">890</span>     * &lt;div class="en"&gt; Getting value of KCV for key verification of to side, using specific key and algorithm to encrypt data, and then return part of cryptograph.&lt;/div&gt;<a name="line.890"></a>
<span class="sourceLineNo">891</span>     *<a name="line.891"></a>
<span class="sourceLineNo">892</span>     * @param type<a name="line.892"></a>
<span class="sourceLineNo">893</span>     *            &lt;div&gt;&lt;ul&gt;<a name="line.893"></a>
<span class="sourceLineNo">894</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.894"></a>
<span class="sourceLineNo">895</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.895"></a>
<span class="sourceLineNo">896</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.896"></a>
<span class="sourceLineNo">897</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.897"></a>
<span class="sourceLineNo">898</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.898"></a>
<span class="sourceLineNo">899</span>     *                &lt;li&gt;0x07:TIK&lt;/li&gt;<a name="line.899"></a>
<span class="sourceLineNo">900</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.900"></a>
<span class="sourceLineNo">901</span>     *                &lt;li&gt;0x33:SM4_TPK&lt;/li&gt;<a name="line.901"></a>
<span class="sourceLineNo">902</span>     *                &lt;li&gt;0x34:SM4_TAK&lt;/li&gt;<a name="line.902"></a>
<span class="sourceLineNo">903</span>     *                &lt;li&gt;0x35:SM4_TDK&lt;/li&gt;<a name="line.903"></a>
<span class="sourceLineNo">904</span>     *                &lt;li&gt;0x44:PPAD_TPK&lt;/li&gt;<a name="line.904"></a>
<span class="sourceLineNo">905</span>     *                &lt;li&gt;0x45:TIDK&lt;/li&gt;<a name="line.905"></a>
<span class="sourceLineNo">906</span>     *                &lt;li&gt;0x22:AES_TMK&lt;/li&gt;<a name="line.906"></a>
<span class="sourceLineNo">907</span>     *                &lt;li&gt;0x23:AES_TPK&lt;/li&gt;<a name="line.907"></a>
<span class="sourceLineNo">908</span>     *                &lt;li&gt;0x24:AES_TAK&lt;/li&gt;<a name="line.908"></a>
<span class="sourceLineNo">909</span>     *                &lt;li&gt;0x20:AES_TDK&lt;/li&gt;<a name="line.909"></a>
<span class="sourceLineNo">910</span>     *                &lt;li&gt;0x51:AES_TIK&lt;/li&gt;<a name="line.910"></a>
<span class="sourceLineNo">911</span>     *            &lt;/ul&gt;&lt;/div&gt;<a name="line.911"></a>
<span class="sourceLineNo">912</span>     * @param keyIndex<a name="line.912"></a>
<span class="sourceLineNo">913</span>     *            &lt;div class="zh"&gt; 密钥的索引号<a name="line.913"></a>
<span class="sourceLineNo">914</span>     *            &lt;ul&gt;<a name="line.914"></a>
<span class="sourceLineNo">915</span>     *            &lt;li&gt;TLK, keyIndex只能为1&lt;/li&gt;<a name="line.915"></a>
<span class="sourceLineNo">916</span>     *            &lt;li&gt;TMK, 取值[1~100]&lt;/li&gt;<a name="line.916"></a>
<span class="sourceLineNo">917</span>     *            &lt;li&gt;TWK,取值[1~100]&lt;/li&gt;<a name="line.917"></a>
<span class="sourceLineNo">918</span>     *            &lt;li&gt;TIK,取值[1~100]&lt;/li&gt;<a name="line.918"></a>
<span class="sourceLineNo">919</span>     *            &lt;/ul&gt;<a name="line.919"></a>
<span class="sourceLineNo">920</span>     *            &lt;/div&gt; &lt;div class="en"&gt; key index<a name="line.920"></a>
<span class="sourceLineNo">921</span>     *            &lt;ul&gt;<a name="line.921"></a>
<span class="sourceLineNo">922</span>     *            &lt;li&gt;TLK, keyIndex can only be 1.&lt;/li&gt;<a name="line.922"></a>
<span class="sourceLineNo">923</span>     *            &lt;li&gt;TMK, can select from [1~100].&lt;/li&gt;<a name="line.923"></a>
<span class="sourceLineNo">924</span>     *            &lt;li&gt;TWK, can select from [1~100].&lt;/li&gt;<a name="line.924"></a>
<span class="sourceLineNo">925</span>     *            &lt;li&gt;TIK, can select from [1~100].&lt;/li&gt;<a name="line.925"></a>
<span class="sourceLineNo">926</span>     *            &lt;/ul&gt;<a name="line.926"></a>
<span class="sourceLineNo">927</span>     *            &lt;/div&gt;<a name="line.927"></a>
<span class="sourceLineNo">928</span>     *<a name="line.928"></a>
<span class="sourceLineNo">929</span>     * @param checkMode<a name="line.929"></a>
<span class="sourceLineNo">930</span>     *            &lt;div class="zh"&gt;<a name="line.930"></a>
<span class="sourceLineNo">931</span>     *            &lt;ul&gt;<a name="line.931"></a>
<span class="sourceLineNo">932</span>     *            &lt;li&gt;checkMode=0x00时， 使用该密钥对一段数据进行DES/TDES加密运算，生成的密文的前4个字节即为KCV,该模式适用于TLK/TMK/TAK/TPK/TDK/PPAD_TXK。&lt;/li&gt;<a name="line.932"></a>
<span class="sourceLineNo">933</span>     *            &lt;li&gt;checkMode=0x00时， 返回注入密钥时写入的KCV值。该模式适用于TIK/AES_TIK。&lt;/li&gt;<a name="line.933"></a>
<span class="sourceLineNo">934</span>     *            &lt;li&gt;checkMode=0x03时， 使用该密钥对一段数据进行CMAC加密运算，生成的密文的前5个字节即为KCV。该模式适用于TLK/TMK/TAK/TPK/TDK/PPAD_TXK/AES_TLK/AES_TMK/AES_TAK/AES_TPK/AES_TDK。&lt;/li&gt;<a name="line.934"></a>
<span class="sourceLineNo">935</span>     *            &lt;li&gt;checkMode=0x04时， 使用该密钥对一段数据进行SM4加密运算，生成的密文的前4个字节即为KCV。该模式适用于SM4_TMK/SM4_TAK/SM4_TPK/SM4_TDK。&lt;/li&gt;<a name="line.935"></a>
<span class="sourceLineNo">936</span>     *            &lt;/ul&gt;<a name="line.936"></a>
<span class="sourceLineNo">937</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.937"></a>
<span class="sourceLineNo">938</span>     *            &lt;ul&gt;<a name="line.938"></a>
<span class="sourceLineNo">939</span>     *            &lt;li&gt;When checkMode=0x00, use this key pair to do DES/TDES entryption for a block of data, the first 4<a name="line.939"></a>
<span class="sourceLineNo">940</span>     *            bytes of the generated ciphertext is KCV.This mode is suitable for TLK/TMK/TAK/TPK/TDK/PPAD_TXK.&lt;/li&gt;<a name="line.940"></a>
<span class="sourceLineNo">941</span>     *            &lt;li&gt;When checkMode=0x00, the KCV value written during key injection is returned. This mode is suitable<a name="line.941"></a>
<span class="sourceLineNo">942</span>     *            for TIK/AES_TIK.&lt;/li&gt;<a name="line.942"></a>
<span class="sourceLineNo">943</span>     *            &lt;li&gt;When checkMode=0x03, use this key to do CMAC encryption operation for a block of data, and the first<a name="line.943"></a>
<span class="sourceLineNo">944</span>     *            5 bytes of the generated ciphertext are KCV. This mode is suitable for TLK/ TMK/ TAK/ TPK/<a name="line.944"></a>
<span class="sourceLineNo">945</span>     *            TDK/ PPAD_TXK/ AES_TLK/ AES_TMK/ AES_TAK/ AES_TPK/ AES_TDK.&lt;/li&gt;<a name="line.945"></a>
<span class="sourceLineNo">946</span>     *            &lt;li&gt;When checkMode=0x04, use this key to do SM4 encryption operation for a block of data, and the first<a name="line.946"></a>
<span class="sourceLineNo">947</span>     *            4 bytes of the generated ciphertext are KCV. This mode is suitable for SM4_TMK/ SM4_TAK/ SM4_TPK/ SM4_TDK.&lt;/li&gt;<a name="line.947"></a>
<span class="sourceLineNo">948</span>     *            &lt;/ul&gt;<a name="line.948"></a>
<span class="sourceLineNo">949</span>     *            &lt;/div&gt;<a name="line.949"></a>
<span class="sourceLineNo">950</span>     *<a name="line.950"></a>
<span class="sourceLineNo">951</span>     * @param checkBuf<a name="line.951"></a>
<span class="sourceLineNo">952</span>     *            &lt;div class="zh"&gt;<a name="line.952"></a>
<span class="sourceLineNo">953</span>     *            &lt;ul&gt;<a name="line.953"></a>
<span class="sourceLineNo">954</span>     *            &lt;li&gt;当checkMode =0x00/0x04时, 指向需运算的数据,进行运算的数据必须是8/16的倍数&lt;/li&gt;<a name="line.954"></a>
<span class="sourceLineNo">955</span>     *            &lt;/ul&gt;<a name="line.955"></a>
<span class="sourceLineNo">956</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.956"></a>
<span class="sourceLineNo">957</span>     *            &lt;ul&gt;<a name="line.957"></a>
<span class="sourceLineNo">958</span>     *            &lt;li&gt;When checkMode=0x00/0x04, The data needing to compute must be a multiple of 8/16.&lt;/li&gt;<a name="line.958"></a>
<span class="sourceLineNo">959</span>     *            &lt;/ul&gt;<a name="line.959"></a>
<span class="sourceLineNo">960</span>     *            &lt;/div&gt;<a name="line.960"></a>
<span class="sourceLineNo">961</span>     *<a name="line.961"></a>
<span class="sourceLineNo">962</span>     * @return &lt;div class="zh"&gt;Kcv 信息(4 字节) &lt;/div&gt; &lt;div class="en"&gt;Kcv information (4 bytes)&lt;/div&gt;<a name="line.962"></a>
<span class="sourceLineNo">963</span>     *<a name="line.963"></a>
<span class="sourceLineNo">964</span>     * @throws PedDevException<a name="line.964"></a>
<span class="sourceLineNo">965</span>     * @since V4.00.00<a name="line.965"></a>
<span class="sourceLineNo">966</span>     */<a name="line.966"></a>
<span class="sourceLineNo">967</span>    byte[] getKCV(byte type, byte keyIndex, byte checkMode, byte[] checkBuf) throws PedDevException;<a name="line.967"></a>
<span class="sourceLineNo">968</span><a name="line.968"></a>
<span class="sourceLineNo">969</span><a name="line.969"></a>
<span class="sourceLineNo">970</span><a name="line.970"></a>
<span class="sourceLineNo">971</span>    /**<a name="line.971"></a>
<span class="sourceLineNo">972</span>     * &lt;div class="zh"&gt; 读取下一次计算的KSN。&lt;/div&gt;<a name="line.972"></a>
<span class="sourceLineNo">973</span>     * &lt;div class="en"&gt; KSN Reading the KSN which will be computed at next time.&lt;/div&gt;<a name="line.973"></a>
<span class="sourceLineNo">974</span>     *<a name="line.974"></a>
<span class="sourceLineNo">975</span>     * @param groupIndex<a name="line.975"></a>
<span class="sourceLineNo">976</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100] DUKPT group index ID &lt;/div&gt;<a name="line.976"></a>
<span class="sourceLineNo">977</span>     *<a name="line.977"></a>
<span class="sourceLineNo">978</span>     * @return &lt;div class="zh"&gt; 当前的KSN &lt;/div&gt; &lt;div class="en"&gt; KSN currently. &lt;/div&gt;<a name="line.978"></a>
<span class="sourceLineNo">979</span>     *<a name="line.979"></a>
<span class="sourceLineNo">980</span>     * @throws PedDevException<a name="line.980"></a>
<span class="sourceLineNo">981</span>     * @since V4.00.00<a name="line.981"></a>
<span class="sourceLineNo">982</span>     */<a name="line.982"></a>
<span class="sourceLineNo">983</span>    byte[] getDUKPTKsn(byte groupIndex) throws PedDevException;<a name="line.983"></a>
<span class="sourceLineNo">984</span><a name="line.984"></a>
<span class="sourceLineNo">985</span>    /**<a name="line.985"></a>
<span class="sourceLineNo">986</span>     * &lt;div class="zh"&gt; 每个KSN对应的DUKPT密钥，最多只能使用256次，当单个密钥使用 256次后，将返回{@link EPedDevException#PED_ERR_DUKPT_NEED_INC_KSN}异常，<a name="line.986"></a>
<span class="sourceLineNo">987</span>     * 需要调用该接口，给 KSN加1。 &lt;/div&gt;<a name="line.987"></a>
<span class="sourceLineNo">988</span>     * &lt;div class="en"&gt; The DUKPT key corresponding to each KSN can only be used up to 256 times. When a single key is used 256 times, it will return {@link EPedDevException#PED_ERR_DUKPT_NEED_INC_KSN} exception,<a name="line.988"></a>
<span class="sourceLineNo">989</span>     * To call this interface, increment KSN by 1.&lt;/div&gt;<a name="line.989"></a>
<span class="sourceLineNo">990</span>     *<a name="line.990"></a>
<span class="sourceLineNo">991</span>     * @param groupIndex<a name="line.991"></a>
<span class="sourceLineNo">992</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100] DUKPT group ID &lt;/div&gt;<a name="line.992"></a>
<span class="sourceLineNo">993</span>     *<a name="line.993"></a>
<span class="sourceLineNo">994</span>     * @throws PedDevException<a name="line.994"></a>
<span class="sourceLineNo">995</span>     * @since V4.00.00<a name="line.995"></a>
<span class="sourceLineNo">996</span>     */<a name="line.996"></a>
<span class="sourceLineNo">997</span>    void incDUKPTKsn(byte groupIndex) throws PedDevException;<a name="line.997"></a>
<span class="sourceLineNo">998</span><a name="line.998"></a>
<span class="sourceLineNo">999</span>    /**<a name="line.999"></a>
<span class="sourceLineNo">1000</span>     * &lt;div class="zh"&gt; 读取RSA公钥密钥。&lt;/div&gt; &lt;div class="en"&gt; Read rsa public key.&lt;/div&gt;<a name="line.1000"></a>
<span class="sourceLineNo">1001</span>     *<a name="line.1001"></a>
<span class="sourceLineNo">1002</span>     * @param rsaKeyIndex<a name="line.1002"></a>
<span class="sourceLineNo">1003</span>     *            &lt;div class="zh"&gt; RSA密钥索引[1-10] &lt;/div&gt; &lt;div class="en"&gt; RSA key index [1-10] &lt;/div&gt;<a name="line.1003"></a>
<span class="sourceLineNo">1004</span>     * @return &lt;div class="zh"&gt; {@link RSAKeyInfo} &lt;/div&gt; &lt;div class="en"&gt; {@link RSAKeyInfo}&lt;/div&gt;<a name="line.1004"></a>
<span class="sourceLineNo">1005</span>     * @throws PedDevException<a name="line.1005"></a>
<span class="sourceLineNo">1006</span>     * @since V4.00.00<a name="line.1006"></a>
<span class="sourceLineNo">1007</span>     */<a name="line.1007"></a>
<span class="sourceLineNo">1008</span>    RSAKeyInfo readRSAKey(byte rsaKeyIndex) throws PedDevException;<a name="line.1008"></a>
<span class="sourceLineNo">1009</span><a name="line.1009"></a>
<span class="sourceLineNo">1010</span><a name="line.1010"></a>
<span class="sourceLineNo">1011</span>    /**<a name="line.1011"></a>
<span class="sourceLineNo">1012</span>     * &lt;div class="zh"&gt; 用存储在PED的RSA密钥进行数据RSA数据运算。<a name="line.1012"></a>
<span class="sourceLineNo">1013</span>     * &lt;br&gt;注意: 1.该函数对dataIn进行RSA加解密运算，运算结果输出到RSARecoverInfo<a name="line.1013"></a>
<span class="sourceLineNo">1014</span>     * &lt;br&gt;2.当rsaKeyIndex指定的密钥为私钥时，如果dataIn是对应公钥的加密密文，则RSARecoverInfo为dataIn的明文，否则RSARecoverInfo为dataIn的RSA密文；<a name="line.1014"></a>
<span class="sourceLineNo">1015</span>     * &lt;br&gt;3.当rsaKeyIndex指定的密钥为公钥时，如果dataIn是对应私钥的加密密文，则RSARecoverInfo为dataIn的明文，否则RSARecoverInfo为dataIn的RSA密文；<a name="line.1015"></a>
<span class="sourceLineNo">1016</span>     * &lt;br&gt;4.该方法可实现长度不超过4096bits的RSA运算。&lt;/div&gt;<a name="line.1016"></a>
<span class="sourceLineNo">1017</span>     * &lt;div class="en"&gt; Using the RSA key stored in PED to do the RSA data operation.<a name="line.1017"></a>
<span class="sourceLineNo">1018</span>     * &lt;br&gt;Note: 1. This function performs RSA encryption and decryption operation on dataIn, and the operation result is output to RSARecoverInfo<a name="line.1018"></a>
<span class="sourceLineNo">1019</span>     * &lt;br&gt;2. When the key specified by rsaKeyIndex is a private key, if dataIn is the encrypted ciphertext corresponding to the public key, then RSARecoverInfo is the plaintext of dataIn, otherwise RSARecoverInfo is the RSA ciphertext of dataIn;<a name="line.1019"></a>
<span class="sourceLineNo">1020</span>     * &lt;br&gt;3. When the key specified by rsaKeyIndex is a public key, if dataIn is the encrypted ciphertext corresponding to the private key, then RSARecoverInfo is the plaintext of dataIn, otherwise RSARecoverInfo is the RSA ciphertext of dataIn;<a name="line.1020"></a>
<span class="sourceLineNo">1021</span>     * &lt;br&gt;4. This method can realize the RSA operation whose length does not exceed 4096bits.&lt;/div&gt;<a name="line.1021"></a>
<span class="sourceLineNo">1022</span>     *<a name="line.1022"></a>
<span class="sourceLineNo">1023</span>     * @param rsaKeyIndex<a name="line.1023"></a>
<span class="sourceLineNo">1024</span>     *            &lt;div class="zh"&gt; 密钥索引[1~10] &lt;/div&gt; &lt;div class="en"&gt; Key Index [1~10] &lt;/div&gt;<a name="line.1024"></a>
<span class="sourceLineNo">1025</span>     *<a name="line.1025"></a>
<span class="sourceLineNo">1026</span>     * @param dataIn<a name="line.1026"></a>
<span class="sourceLineNo">1027</span>     *            &lt;div class="zh"&gt; 被加解密的数据，和模等长 &lt;/div&gt; &lt;div class="en"&gt; The encrypted/decrypted data, which has the same<a name="line.1027"></a>
<span class="sourceLineNo">1028</span>     *            length as the modulus. &lt;/div&gt;<a name="line.1028"></a>
<span class="sourceLineNo">1029</span>     *<a name="line.1029"></a>
<span class="sourceLineNo">1030</span>     * @return {@link RSARecoverInfo}<a name="line.1030"></a>
<span class="sourceLineNo">1031</span>     * @throws PedDevException<a name="line.1031"></a>
<span class="sourceLineNo">1032</span>     * @since V4.00.00<a name="line.1032"></a>
<span class="sourceLineNo">1033</span>     */<a name="line.1033"></a>
<span class="sourceLineNo">1034</span>    RSARecoverInfo RSARecover(byte rsaKeyIndex, byte[] dataIn) throws PedDevException;<a name="line.1034"></a>
<span class="sourceLineNo">1035</span><a name="line.1035"></a>
<span class="sourceLineNo">1036</span><a name="line.1036"></a>
<span class="sourceLineNo">1037</span>    /**<a name="line.1037"></a>
<span class="sourceLineNo">1038</span>     * &lt;div class="zh"&gt; 写入一个密钥，包括TLK，TMK和TWK的写入、发散，并可以选择使用KCV验证密钥正确性。<a name="line.1038"></a>
<span class="sourceLineNo">1039</span>     * &lt;p&gt;<a name="line.1039"></a>
<span class="sourceLineNo">1040</span>     * 当写入PED_TLK时，PED首先格式化，清除所有已经下载的密钥，再写入PED_TLK。 当明文写入密钥时，srcKeyIndex=0。<a name="line.1040"></a>
<span class="sourceLineNo">1041</span>     * &lt;/p&gt;<a name="line.1041"></a>
<span class="sourceLineNo">1042</span>     * &lt;/div&gt;<a name="line.1042"></a>
<span class="sourceLineNo">1043</span>     * &lt;div class="en"&gt; Write in one key includes write in and divergent of TLK, TMK and TWK. And use KCV to check the<a name="line.1043"></a>
<span class="sourceLineNo">1044</span>     * key correction.<a name="line.1044"></a>
<span class="sourceLineNo">1045</span>     * &lt;p&gt;<a name="line.1045"></a>
<span class="sourceLineNo">1046</span>     * When write PED_TLK,PED will format ,clear all the key has been downloaded,then write in PED_TLK.<a name="line.1046"></a>
<span class="sourceLineNo">1047</span>     * When srckeyindex = 0, the plaintext key is written.<a name="line.1047"></a>
<span class="sourceLineNo">1048</span>     * &lt;/p&gt;<a name="line.1048"></a>
<span class="sourceLineNo">1049</span>     * &lt;/div&gt;<a name="line.1049"></a>
<span class="sourceLineNo">1050</span>     *<a name="line.1050"></a>
<span class="sourceLineNo">1051</span>     * @param srcKeyType<a name="line.1051"></a>
<span class="sourceLineNo">1052</span>     *            &lt;div class="zh"&gt;<a name="line.1052"></a>
<span class="sourceLineNo">1053</span>     *            &lt;p&gt;<a name="line.1053"></a>
<span class="sourceLineNo">1054</span>     *            源密钥类型,它的级别不能低于destKeyType, SM4类型秘钥只能用TLK和SM4_TMK发散。<a name="line.1054"></a>
<span class="sourceLineNo">1055</span>     *            &lt;/p&gt;<a name="line.1055"></a>
<span class="sourceLineNo">1056</span>     *            &lt;ul&gt;<a name="line.1056"></a>
<span class="sourceLineNo">1057</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1057"></a>
<span class="sourceLineNo">1058</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1058"></a>
<span class="sourceLineNo">1059</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1059"></a>
<span class="sourceLineNo">1060</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1060"></a>
<span class="sourceLineNo">1061</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1061"></a>
<span class="sourceLineNo">1062</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1062"></a>
<span class="sourceLineNo">1063</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1063"></a>
<span class="sourceLineNo">1064</span>     *            &lt;/ul&gt;<a name="line.1064"></a>
<span class="sourceLineNo">1065</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1065"></a>
<span class="sourceLineNo">1066</span>     *            &lt;p&gt;<a name="line.1066"></a>
<span class="sourceLineNo">1067</span>     *            Source Key Type，its level cannot be lower than destKeyType, SM4 type keys can only be diverged with TLK and SM4_TMK.<a name="line.1067"></a>
<span class="sourceLineNo">1068</span>     *            &lt;/p&gt;<a name="line.1068"></a>
<span class="sourceLineNo">1069</span>     *            &lt;ul&gt;<a name="line.1069"></a>
<span class="sourceLineNo">1070</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1070"></a>
<span class="sourceLineNo">1071</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1071"></a>
<span class="sourceLineNo">1072</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1072"></a>
<span class="sourceLineNo">1073</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1073"></a>
<span class="sourceLineNo">1074</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1074"></a>
<span class="sourceLineNo">1075</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1075"></a>
<span class="sourceLineNo">1076</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1076"></a>
<span class="sourceLineNo">1077</span>     *            &lt;/ul&gt;<a name="line.1077"></a>
<span class="sourceLineNo">1078</span>     *            &lt;/div&gt;<a name="line.1078"></a>
<span class="sourceLineNo">1079</span>     *<a name="line.1079"></a>
<span class="sourceLineNo">1080</span>     *<a name="line.1080"></a>
<span class="sourceLineNo">1081</span>     * @param srcKeyIndex<a name="line.1081"></a>
<span class="sourceLineNo">1082</span>     *            &lt;div class="zh"&gt;<a name="line.1082"></a>
<span class="sourceLineNo">1083</span>     *            &lt;p&gt;<a name="line.1083"></a>
<span class="sourceLineNo">1084</span>     *            源密钥索引<a name="line.1084"></a>
<span class="sourceLineNo">1085</span>     *            &lt;/p&gt;<a name="line.1085"></a>
<span class="sourceLineNo">1086</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1086"></a>
<span class="sourceLineNo">1087</span>     *            &lt;p&gt;<a name="line.1087"></a>
<span class="sourceLineNo">1088</span>     *            Source Key Index<a name="line.1088"></a>
<span class="sourceLineNo">1089</span>     *            &lt;/p&gt;<a name="line.1089"></a>
<span class="sourceLineNo">1090</span>     *            &lt;/div&gt;<a name="line.1090"></a>
<span class="sourceLineNo">1091</span>     *<a name="line.1091"></a>
<span class="sourceLineNo">1092</span>     * @param dstKeyType<a name="line.1092"></a>
<span class="sourceLineNo">1093</span>     *            &lt;div class="zh"&gt;<a name="line.1093"></a>
<span class="sourceLineNo">1094</span>     *            &lt;p&gt;<a name="line.1094"></a>
<span class="sourceLineNo">1095</span>     *            目的密钥类型<a name="line.1095"></a>
<span class="sourceLineNo">1096</span>     *            &lt;/p&gt;<a name="line.1096"></a>
<span class="sourceLineNo">1097</span>     *            &lt;ul&gt;<a name="line.1097"></a>
<span class="sourceLineNo">1098</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1098"></a>
<span class="sourceLineNo">1099</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1099"></a>
<span class="sourceLineNo">1100</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1100"></a>
<span class="sourceLineNo">1101</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1101"></a>
<span class="sourceLineNo">1102</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1102"></a>
<span class="sourceLineNo">1103</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1103"></a>
<span class="sourceLineNo">1104</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1104"></a>
<span class="sourceLineNo">1105</span>     *                &lt;li&gt;0x33:SM4_TPK&lt;/li&gt;<a name="line.1105"></a>
<span class="sourceLineNo">1106</span>     *                &lt;li&gt;0x34:SM4_TAK&lt;/li&gt;<a name="line.1106"></a>
<span class="sourceLineNo">1107</span>     *                &lt;li&gt;0x35:SM4_TDK&lt;/li&gt;<a name="line.1107"></a>
<span class="sourceLineNo">1108</span>     *                &lt;li&gt;0x36:SM4_TCHDK&lt;/li&gt;<a name="line.1108"></a>
<span class="sourceLineNo">1109</span>     *                &lt;li&gt;0x37:SM4_FACE_TDK&lt;/li&gt;<a name="line.1109"></a>
<span class="sourceLineNo">1110</span>     *            &lt;/ul&gt;<a name="line.1110"></a>
<span class="sourceLineNo">1111</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1111"></a>
<span class="sourceLineNo">1112</span>     *            &lt;p&gt;<a name="line.1112"></a>
<span class="sourceLineNo">1113</span>     *            Destination Key Type<a name="line.1113"></a>
<span class="sourceLineNo">1114</span>     *            &lt;/p&gt;<a name="line.1114"></a>
<span class="sourceLineNo">1115</span>     *            &lt;ul&gt;<a name="line.1115"></a>
<span class="sourceLineNo">1116</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1116"></a>
<span class="sourceLineNo">1117</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1117"></a>
<span class="sourceLineNo">1118</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1118"></a>
<span class="sourceLineNo">1119</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1119"></a>
<span class="sourceLineNo">1120</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1120"></a>
<span class="sourceLineNo">1121</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1121"></a>
<span class="sourceLineNo">1122</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1122"></a>
<span class="sourceLineNo">1123</span>     *                &lt;li&gt;0x33:SM4_TPK&lt;/li&gt;<a name="line.1123"></a>
<span class="sourceLineNo">1124</span>     *                &lt;li&gt;0x34:SM4_TAK&lt;/li&gt;<a name="line.1124"></a>
<span class="sourceLineNo">1125</span>     *                &lt;li&gt;0x35:SM4_TDK&lt;/li&gt;<a name="line.1125"></a>
<span class="sourceLineNo">1126</span>     *                &lt;li&gt;0x36:SM4_TCHDK&lt;/li&gt;<a name="line.1126"></a>
<span class="sourceLineNo">1127</span>     *                &lt;li&gt;0x37:SM4_FACE_TDK&lt;/li&gt;<a name="line.1127"></a>
<span class="sourceLineNo">1128</span>     *            &lt;/ul&gt;<a name="line.1128"></a>
<span class="sourceLineNo">1129</span>     *            &lt;/div&gt;<a name="line.1129"></a>
<span class="sourceLineNo">1130</span>     *<a name="line.1130"></a>
<span class="sourceLineNo">1131</span>     * @param dstKeyIndex<a name="line.1131"></a>
<span class="sourceLineNo">1132</span>     *            &lt;div class="zh"&gt;<a name="line.1132"></a>
<span class="sourceLineNo">1133</span>     *            &lt;p&gt;<a name="line.1133"></a>
<span class="sourceLineNo">1134</span>     *            目的密钥索引<a name="line.1134"></a>
<span class="sourceLineNo">1135</span>     *            &lt;/p&gt;<a name="line.1135"></a>
<span class="sourceLineNo">1136</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1136"></a>
<span class="sourceLineNo">1137</span>     *            &lt;p&gt;<a name="line.1137"></a>
<span class="sourceLineNo">1138</span>     *            Destination Key Index<a name="line.1138"></a>
<span class="sourceLineNo">1139</span>     *            &lt;/p&gt;<a name="line.1139"></a>
<span class="sourceLineNo">1140</span>     *            &lt;/div&gt;<a name="line.1140"></a>
<span class="sourceLineNo">1141</span>     *<a name="line.1141"></a>
<span class="sourceLineNo">1142</span>     * @param destKeyValue<a name="line.1142"></a>
<span class="sourceLineNo">1143</span>     *            &lt;div class="zh"&gt;<a name="line.1143"></a>
<span class="sourceLineNo">1144</span>     *            &lt;p&gt;<a name="line.1144"></a>
<span class="sourceLineNo">1145</span>     *            密钥明文或密文,长度可为8,16,24<a name="line.1145"></a>
<span class="sourceLineNo">1146</span>     *            &lt;/p&gt;<a name="line.1146"></a>
<span class="sourceLineNo">1147</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1147"></a>
<span class="sourceLineNo">1148</span>     *            &lt;p&gt;<a name="line.1148"></a>
<span class="sourceLineNo">1149</span>     *            Plaintext or ciphertext key, the length can be 8, 16, 24<a name="line.1149"></a>
<span class="sourceLineNo">1150</span>     *            &lt;/p&gt;<a name="line.1150"></a>
<span class="sourceLineNo">1151</span>     *            &lt;/div&gt;<a name="line.1151"></a>
<span class="sourceLineNo">1152</span>     *<a name="line.1152"></a>
<span class="sourceLineNo">1153</span>     * @param checkMode<a name="line.1153"></a>
<span class="sourceLineNo">1154</span>     *            {@link ECheckMode} &lt;div class="zh"&gt;<a name="line.1154"></a>
<span class="sourceLineNo">1155</span>     *            &lt;p&gt;<a name="line.1155"></a>
<span class="sourceLineNo">1156</span>     *            校验模式<a name="line.1156"></a>
<span class="sourceLineNo">1157</span>     *            &lt;/p&gt;<a name="line.1157"></a>
<span class="sourceLineNo">1158</span>     *            &lt;ul&gt;<a name="line.1158"></a>
<span class="sourceLineNo">1159</span>     *            &lt;li&gt;{@link ECheckMode#KCV_NONE}&lt;/li&gt;<a name="line.1159"></a>
<span class="sourceLineNo">1160</span>     *            &lt;li&gt;{@link ECheckMode#KCV_ENCRYPT_0}&lt;/li&gt;<a name="line.1160"></a>
<span class="sourceLineNo">1161</span>     *            &lt;li&gt;{@link ECheckMode#KCV_ENCRYPT_FIX_DATA}&lt;/li&gt;<a name="line.1161"></a>
<span class="sourceLineNo">1162</span>     *            &lt;li&gt;{@link ECheckMode#KCV_MAC_INPUT_DATA}&lt;/li&gt;<a name="line.1162"></a>
<span class="sourceLineNo">1163</span>     *            &lt;li&gt;{@link ECheckMode#KCV_SM4_ENCRYPT_0}&lt;/li&gt;<a name="line.1163"></a>
<span class="sourceLineNo">1164</span>     *            &lt;/ul&gt;<a name="line.1164"></a>
<span class="sourceLineNo">1165</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1165"></a>
<span class="sourceLineNo">1166</span>     *            &lt;p&gt;<a name="line.1166"></a>
<span class="sourceLineNo">1167</span>     *            Check Mode<a name="line.1167"></a>
<span class="sourceLineNo">1168</span>     *            &lt;/p&gt;<a name="line.1168"></a>
<span class="sourceLineNo">1169</span>     *            &lt;ul&gt;<a name="line.1169"></a>
<span class="sourceLineNo">1170</span>     *            &lt;li&gt;When checkMode=KCV_NONE -No Check&lt;/li&gt;<a name="line.1170"></a>
<span class="sourceLineNo">1171</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_0 -Perform DES/TDES encryption on 8 bytes 0x00, and use first 4 bytes<a name="line.1171"></a>
<span class="sourceLineNo">1172</span>     *            as KCV.&lt;/li&gt;<a name="line.1172"></a>
<span class="sourceLineNo">1173</span>     *<a name="line.1173"></a>
<span class="sourceLineNo">1174</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_FIX_DATA -Perform parity check first, then perform DES/TDES encryption<a name="line.1174"></a>
<span class="sourceLineNo">1175</span>     *            on 8 bytes―\x12\x34\x56\x78\x90\x12\x34\x56, and use first 4 bytes as KCV.&lt;/li&gt;<a name="line.1175"></a>
<span class="sourceLineNo">1176</span>     *<a name="line.1176"></a>
<span class="sourceLineNo">1177</span>     *            &lt;li&gt;When iCheckMode=KCV_MAC_INPUT_DATA -Send in data KcvData, use source key to perform specified mode<a name="line.1177"></a>
<span class="sourceLineNo">1178</span>     *            of MAC on [aucDesKeyValue +KcvData], and use the 8 bytes result as KCV.&lt;/li&gt;<a name="line.1178"></a>
<span class="sourceLineNo">1179</span>     *<a name="line.1179"></a>
<span class="sourceLineNo">1180</span>     *            &lt;li&gt;When iCheckMode=KCV_SM4_ENCRYPT_0 -Perform TDES encryption on 16 bytes 0x00 by SM4, and use first<a name="line.1180"></a>
<span class="sourceLineNo">1181</span>     *            4 bytes as KCV.&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;<a name="line.1181"></a>
<span class="sourceLineNo">1182</span>     *<a name="line.1182"></a>
<span class="sourceLineNo">1183</span>     * @param checkBuf<a name="line.1183"></a>
<span class="sourceLineNo">1184</span>     *            &lt;div class="zh"&gt;<a name="line.1184"></a>
<span class="sourceLineNo">1185</span>     *            &lt;p&gt;<a name="line.1185"></a>
<span class="sourceLineNo">1186</span>     *            校验数据缓冲区<a name="line.1186"></a>
<span class="sourceLineNo">1187</span>     *            &lt;/p&gt;<a name="line.1187"></a>
<span class="sourceLineNo">1188</span>     *            &lt;ul&gt;<a name="line.1188"></a>
<span class="sourceLineNo">1189</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_NONE}时 checkBuf的值无效,系统认为不验证KCV,可以为null&lt;/li&gt;<a name="line.1189"></a>
<span class="sourceLineNo">1190</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_ENCRYPT_0},4字节的kcv&lt;/li&gt;<a name="line.1190"></a>
<span class="sourceLineNo">1191</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_ENCRYPT_FIX_DATA},4字节的kcv&lt;/li&gt;<a name="line.1191"></a>
<span class="sourceLineNo">1192</span>     *            &lt;li&gt;当iCheckMode={@link ECheckMode#KCV_MAC_INPUT_DATA}时按以下规则提供checkBuf:<a name="line.1192"></a>
<span class="sourceLineNo">1193</span>     *            &lt;p&gt;<a name="line.1193"></a>
<span class="sourceLineNo">1194</span>     *            checkBuf[0]= KcvData长度(KcvDataLen)<a name="line.1194"></a>
<span class="sourceLineNo">1195</span>     *            &lt;/p&gt;<a name="line.1195"></a>
<span class="sourceLineNo">1196</span>     *            &lt;p&gt;<a name="line.1196"></a>
<span class="sourceLineNo">1197</span>     *            checkBuf+1: KcvData<a name="line.1197"></a>
<span class="sourceLineNo">1198</span>     *            &lt;/p&gt;<a name="line.1198"></a>
<span class="sourceLineNo">1199</span>     *            &lt;p&gt;<a name="line.1199"></a>
<span class="sourceLineNo">1200</span>     *            checkBuf[1+KcvDataLen]=MAC运算模式,参考{@link #getMac(byte, byte[], byte)}中的mode参数<a name="line.1200"></a>
<span class="sourceLineNo">1201</span>     *            &lt;/p&gt;<a name="line.1201"></a>
<span class="sourceLineNo">1202</span>     *            &lt;p&gt;<a name="line.1202"></a>
<span class="sourceLineNo">1203</span>     *            checkBuf[2+KcvDataLen]=KCV长度<a name="line.1203"></a>
<span class="sourceLineNo">1204</span>     *            &lt;/p&gt;<a name="line.1204"></a>
<span class="sourceLineNo">1205</span>     *            &lt;p&gt;<a name="line.1205"></a>
<span class="sourceLineNo">1206</span>     *            checkBuf[3+KcvDataLen]是KCV的值<a name="line.1206"></a>
<span class="sourceLineNo">1207</span>     *            &lt;/p&gt;<a name="line.1207"></a>
<span class="sourceLineNo">1208</span>     *            &lt;/li&gt;<a name="line.1208"></a>
<span class="sourceLineNo">1209</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_SM4_ENCRYPT_0},4字节的kcv&lt;/li&gt;<a name="line.1209"></a>
<span class="sourceLineNo">1210</span>     *            &lt;/ul&gt;<a name="line.1210"></a>
<span class="sourceLineNo">1211</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1211"></a>
<span class="sourceLineNo">1212</span>     *            &lt;p&gt;<a name="line.1212"></a>
<span class="sourceLineNo">1213</span>     *            Check Data Buffer<a name="line.1213"></a>
<span class="sourceLineNo">1214</span>     *            &lt;/p&gt;<a name="line.1214"></a>
<span class="sourceLineNo">1215</span>     *            &lt;ul&gt;<a name="line.1215"></a>
<span class="sourceLineNo">1216</span>     *            &lt;li&gt;When checkMode=KCV_NONE -PED wont check KCV, this data is no meaning.&lt;/li&gt;<a name="line.1216"></a>
<span class="sourceLineNo">1217</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_0 -4 bytes key check value&lt;/li&gt;<a name="line.1217"></a>
<span class="sourceLineNo">1218</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_FIX_DATA -4 bytes key check value&lt;/li&gt;<a name="line.1218"></a>
<span class="sourceLineNo">1219</span>     *            &lt;li&gt;When iCheckMode=KCV_MAC_INPUT_DATA - checkBuf as follows: checkBuf[0] = length of KcvData<a name="line.1219"></a>
<span class="sourceLineNo">1220</span>     *            checkBuf+1: kcvData checkBuf[1+kcvDataLen]: MAC computation mode<a name="line.1220"></a>
<span class="sourceLineNo">1221</span>     *            {@link #getMac(byte, byte[], byte)} checkBuf[2+kcvDataLen]:KCV length<a name="line.1221"></a>
<span class="sourceLineNo">1222</span>     *            checkBuf[3+kcvDataLen]:KCV Value&lt;/li&gt;<a name="line.1222"></a>
<span class="sourceLineNo">1223</span>     *            &lt;li&gt;When checkMode=KCV_SM4_ENCRYPT_0 -4 bytes key check value&lt;/li&gt;<a name="line.1223"></a>
<span class="sourceLineNo">1224</span>     *            &lt;/ul&gt;<a name="line.1224"></a>
<span class="sourceLineNo">1225</span>     *            &lt;/div&gt;<a name="line.1225"></a>
<span class="sourceLineNo">1226</span>     *<a name="line.1226"></a>
<span class="sourceLineNo">1227</span>     * @throws PedDevException<a name="line.1227"></a>
<span class="sourceLineNo">1228</span>     * @since V4.00.00<a name="line.1228"></a>
<span class="sourceLineNo">1229</span>     */<a name="line.1229"></a>
<span class="sourceLineNo">1230</span>    void writeKey(byte srcKeyType, byte srcKeyIndex, byte dstKeyType, byte dstKeyIndex,<a name="line.1230"></a>
<span class="sourceLineNo">1231</span>                         byte[] destKeyValue, ECheckMode checkMode, byte[] checkBuf) throws PedDevException;<a name="line.1231"></a>
<span class="sourceLineNo">1232</span><a name="line.1232"></a>
<span class="sourceLineNo">1233</span><a name="line.1233"></a>
<span class="sourceLineNo">1234</span>    /**<a name="line.1234"></a>
<span class="sourceLineNo">1235</span>     * &lt;div class="zh"&gt;写入一个AES密钥，并可以选择使用KCV验证密钥正确性。&lt;/div&gt; &lt;div class="en"&gt; To write Aes key to PED, and use KCV to check the<a name="line.1235"></a>
<span class="sourceLineNo">1236</span>     * key correction.&lt;/div&gt;<a name="line.1236"></a>
<span class="sourceLineNo">1237</span>     *<a name="line.1237"></a>
<span class="sourceLineNo">1238</span>     * @param srcKeyType<a name="line.1238"></a>
<span class="sourceLineNo">1239</span>     *            &lt;div class="zh"&gt;<a name="line.1239"></a>
<span class="sourceLineNo">1240</span>     *            &lt;p&gt;<a name="line.1240"></a>
<span class="sourceLineNo">1241</span>     *            源密钥类型。不得低于destKeyType所在的密钥级别。<a name="line.1241"></a>
<span class="sourceLineNo">1242</span>     *            &lt;/p&gt;<a name="line.1242"></a>
<span class="sourceLineNo">1243</span>     *            &lt;ul&gt;<a name="line.1243"></a>
<span class="sourceLineNo">1244</span>     *            &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1244"></a>
<span class="sourceLineNo">1245</span>     *            &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1245"></a>
<span class="sourceLineNo">1246</span>     *            &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1246"></a>
<span class="sourceLineNo">1247</span>     *            &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1247"></a>
<span class="sourceLineNo">1248</span>     *            &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1248"></a>
<span class="sourceLineNo">1249</span>     *            &lt;li&gt;0x20:TAESK&lt;/li&gt;<a name="line.1249"></a>
<span class="sourceLineNo">1250</span>     *            &lt;/ul&gt;<a name="line.1250"></a>
<span class="sourceLineNo">1251</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1251"></a>
<span class="sourceLineNo">1252</span>     *            &lt;p&gt;<a name="line.1252"></a>
<span class="sourceLineNo">1253</span>     *            Source Key Type. Must not be lower than the key level of destKeyType.<a name="line.1253"></a>
<span class="sourceLineNo">1254</span>     *            &lt;/p&gt;<a name="line.1254"></a>
<span class="sourceLineNo">1255</span>     *            &lt;ul&gt;<a name="line.1255"></a>
<span class="sourceLineNo">1256</span>     *            &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1256"></a>
<span class="sourceLineNo">1257</span>     *            &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1257"></a>
<span class="sourceLineNo">1258</span>     *            &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1258"></a>
<span class="sourceLineNo">1259</span>     *            &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1259"></a>
<span class="sourceLineNo">1260</span>     *            &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1260"></a>
<span class="sourceLineNo">1261</span>     *            &lt;li&gt;0x20:TAESK&lt;/li&gt;<a name="line.1261"></a>
<span class="sourceLineNo">1262</span>     *            &lt;/ul&gt;<a name="line.1262"></a>
<span class="sourceLineNo">1263</span>     *            &lt;/div&gt;<a name="line.1263"></a>
<span class="sourceLineNo">1264</span>     *<a name="line.1264"></a>
<span class="sourceLineNo">1265</span>     *<a name="line.1265"></a>
<span class="sourceLineNo">1266</span>     * @param srcKeyIndex<a name="line.1266"></a>
<span class="sourceLineNo">1267</span>     *            &lt;div class="zh"&gt;<a name="line.1267"></a>
<span class="sourceLineNo">1268</span>     *            &lt;p&gt;<a name="line.1268"></a>
<span class="sourceLineNo">1269</span>     *            原密钥索引。<a name="line.1269"></a>
<span class="sourceLineNo">1270</span>     *            &lt;/p&gt;<a name="line.1270"></a>
<span class="sourceLineNo">1271</span>     *            当srcKeyIndex = 0，密钥将以明文形式写入PED。 &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1271"></a>
<span class="sourceLineNo">1272</span>     *            &lt;p&gt;<a name="line.1272"></a>
<span class="sourceLineNo">1273</span>     *            Source Key Index.<a name="line.1273"></a>
<span class="sourceLineNo">1274</span>     *            &lt;/p&gt;<a name="line.1274"></a>
<span class="sourceLineNo">1275</span>     *            when srcKeyIndex = 0，The key will be written to PED in clear text. &lt;/div&gt;<a name="line.1275"></a>
<span class="sourceLineNo">1276</span>     *<a name="line.1276"></a>
<span class="sourceLineNo">1277</span>     * @param destKeyType &lt;div class="zh"&gt;<a name="line.1277"></a>
<span class="sourceLineNo">1278</span>     *            &lt;p&gt;<a name="line.1278"></a>
<span class="sourceLineNo">1279</span>     *            目的密钥类型。<a name="line.1279"></a>
<span class="sourceLineNo">1280</span>     *            &lt;/p&gt;<a name="line.1280"></a>
<span class="sourceLineNo">1281</span>     *            &lt;ul&gt;<a name="line.1281"></a>
<span class="sourceLineNo">1282</span>     *            &lt;li&gt;0x20:TAESK(AES_TDK).&lt;/li&gt;<a name="line.1282"></a>
<span class="sourceLineNo">1283</span>     *            &lt;li&gt;0x23:AES_TPK.&lt;/li&gt;<a name="line.1283"></a>
<span class="sourceLineNo">1284</span>     *            &lt;/ul&gt;<a name="line.1284"></a>
<span class="sourceLineNo">1285</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1285"></a>
<span class="sourceLineNo">1286</span>     *            &lt;p&gt;<a name="line.1286"></a>
<span class="sourceLineNo">1287</span>     *            Destination Key Type.<a name="line.1287"></a>
<span class="sourceLineNo">1288</span>     *            &lt;/p&gt;<a name="line.1288"></a>
<span class="sourceLineNo">1289</span>     *            &lt;ul&gt;<a name="line.1289"></a>
<span class="sourceLineNo">1290</span>     *            &lt;li&gt;0x20:TAESK(AES_TDK).&lt;/li&gt;<a name="line.1290"></a>
<span class="sourceLineNo">1291</span>     *            &lt;li&gt;0x23:AES_TPK.&lt;/li&gt;<a name="line.1291"></a>
<span class="sourceLineNo">1292</span>     *            &lt;/ul&gt; &lt;/div&gt;<a name="line.1292"></a>
<span class="sourceLineNo">1293</span>     *<a name="line.1293"></a>
<span class="sourceLineNo">1294</span>     * @param destKeyIndex<a name="line.1294"></a>
<span class="sourceLineNo">1295</span>     *            &lt;div class="zh"&gt;<a name="line.1295"></a>
<span class="sourceLineNo">1296</span>     *            &lt;p&gt;<a name="line.1296"></a>
<span class="sourceLineNo">1297</span>     *            目的密钥索引<a name="line.1297"></a>
<span class="sourceLineNo">1298</span>     *            &lt;/p&gt;<a name="line.1298"></a>
<span class="sourceLineNo">1299</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1299"></a>
<span class="sourceLineNo">1300</span>     *            &lt;p&gt;<a name="line.1300"></a>
<span class="sourceLineNo">1301</span>     *            Destination Key Index<a name="line.1301"></a>
<span class="sourceLineNo">1302</span>     *            &lt;/p&gt;<a name="line.1302"></a>
<span class="sourceLineNo">1303</span>     *            &lt;/div&gt;<a name="line.1303"></a>
<span class="sourceLineNo">1304</span>     *<a name="line.1304"></a>
<span class="sourceLineNo">1305</span>     * @param destKeyValue<a name="line.1305"></a>
<span class="sourceLineNo">1306</span>     *            &lt;div class="zh"&gt;<a name="line.1306"></a>
<span class="sourceLineNo">1307</span>     *            &lt;p&gt;<a name="line.1307"></a>
<span class="sourceLineNo">1308</span>     *            密钥明文或密文,16/24/32 bytes<a name="line.1308"></a>
<span class="sourceLineNo">1309</span>     *            &lt;/p&gt;<a name="line.1309"></a>
<span class="sourceLineNo">1310</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1310"></a>
<span class="sourceLineNo">1311</span>     *            &lt;p&gt;<a name="line.1311"></a>
<span class="sourceLineNo">1312</span>     *            Plaintext or ciphertext key, the length can be 16/24/32bytes<a name="line.1312"></a>
<span class="sourceLineNo">1313</span>     *            &lt;/p&gt;<a name="line.1313"></a>
<span class="sourceLineNo">1314</span>     *            &lt;/div&gt;<a name="line.1314"></a>
<span class="sourceLineNo">1315</span>     *<a name="line.1315"></a>
<span class="sourceLineNo">1316</span>     * @param checkMode<a name="line.1316"></a>
<span class="sourceLineNo">1317</span>     *            &lt;div class="zh"&gt;<a name="line.1317"></a>
<span class="sourceLineNo">1318</span>     *            &lt;p&gt;<a name="line.1318"></a>
<span class="sourceLineNo">1319</span>     *            校验模式<a name="line.1319"></a>
<span class="sourceLineNo">1320</span>     *            &lt;/p&gt;<a name="line.1320"></a>
<span class="sourceLineNo">1321</span>     *            &lt;ul&gt;<a name="line.1321"></a>
<span class="sourceLineNo">1322</span>     *            &lt;li&gt;checkMode=0x00 -无验证.&lt;/li&gt;<a name="line.1322"></a>
<span class="sourceLineNo">1323</span>     *            &lt;li&gt;checkMode=0x01 -对16个字节的0x00进行AES ECB模式加密运算，得到的密文的前4个字节即为KCV值。&lt;/li&gt;<a name="line.1323"></a>
<span class="sourceLineNo">1324</span>     *            &lt;li&gt;checkMode=0x02 -对16字节长度<a name="line.1324"></a>
<span class="sourceLineNo">1325</span>     *            ―\x12\x34\x56\x78\x90\x12\x34\x56\x12\x34\x56\x78\x90\x12\x34\x56 进行AES ECB模式的加密运算，得到的密文的前4个字节即为KCV值。&lt;/li&gt;<a name="line.1325"></a>
<span class="sourceLineNo">1326</span>     *            &lt;li&gt;checkMode=0x03 -传入一串数据KcvData，使用源密钥对[destKeyValue(密文)+<a name="line.1326"></a>
<span class="sourceLineNo">1327</span>     *            KcvData]进行指定模式的MAC运算，得到的8个字节的MAC值即为KCV值。&lt;/li&gt;<a name="line.1327"></a>
<span class="sourceLineNo">1328</span>     *            &lt;/ul&gt;<a name="line.1328"></a>
<span class="sourceLineNo">1329</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1329"></a>
<span class="sourceLineNo">1330</span>     *            &lt;p&gt;<a name="line.1330"></a>
<span class="sourceLineNo">1331</span>     *            Check Mode<a name="line.1331"></a>
<span class="sourceLineNo">1332</span>     *            &lt;/p&gt;<a name="line.1332"></a>
<span class="sourceLineNo">1333</span>     *            &lt;ul&gt;<a name="line.1333"></a>
<span class="sourceLineNo">1334</span>     *            &lt;li&gt;When checkMode=0x00 -No Check&lt;/li&gt;<a name="line.1334"></a>
<span class="sourceLineNo">1335</span>     *            &lt;li&gt;When checkMode=0x01 -Perform AES ECB mode encryption on 16 bytes 0x00, and use first 4<a name="line.1335"></a>
<span class="sourceLineNo">1336</span>     *            bytes as KCV.&lt;/li&gt;<a name="line.1336"></a>
<span class="sourceLineNo">1337</span>     *<a name="line.1337"></a>
<span class="sourceLineNo">1338</span>     *            &lt;li&gt;When checkMode=0x02 -Perform AES ECB mode<a name="line.1338"></a>
<span class="sourceLineNo">1339</span>     *            encryption on 16 bytes―\x12\x34\x56\x78\x90\x12\x34\x56\x12\x34\x56\x78\x90\x12\x34\x56, and use<a name="line.1339"></a>
<span class="sourceLineNo">1340</span>     *            first 4 bytes as KCV.&lt;/li&gt;<a name="line.1340"></a>
<span class="sourceLineNo">1341</span>     *<a name="line.1341"></a>
<span class="sourceLineNo">1342</span>     *            &lt;li&gt;When checkMode=0x03 -Send in data KcvData, use source key to perform specified mode<a name="line.1342"></a>
<span class="sourceLineNo">1343</span>     *            of MAC on [destKeyValue(ciphertext) +KcvData], and use the 8 bytes result as KCV.&lt;/li&gt;<a name="line.1343"></a>
<span class="sourceLineNo">1344</span>     *            &lt;/ul&gt;<a name="line.1344"></a>
<span class="sourceLineNo">1345</span>     *            &lt;/div&gt;<a name="line.1345"></a>
<span class="sourceLineNo">1346</span>     *<a name="line.1346"></a>
<span class="sourceLineNo">1347</span>     * @param checkBuf<a name="line.1347"></a>
<span class="sourceLineNo">1348</span>     *            &lt;div class="zh"&gt;<a name="line.1348"></a>
<span class="sourceLineNo">1349</span>     *            &lt;p&gt;<a name="line.1349"></a>
<span class="sourceLineNo">1350</span>     *            校验数据缓冲区<a name="line.1350"></a>
<span class="sourceLineNo">1351</span>     *            &lt;/p&gt;<a name="line.1351"></a>
<span class="sourceLineNo">1352</span>     *            &lt;ul&gt;<a name="line.1352"></a>
<span class="sourceLineNo">1353</span>     *            &lt;li&gt;当checkMode=0x00时，checkBuf的值无效,系统认为不验证KCV&lt;/li&gt;<a name="line.1353"></a>
<span class="sourceLineNo">1354</span>     *            &lt;li&gt;当checkMode=0x01时，checkBuf[0]= KCV的长度(4)，checkBuf + 1指向KCV的值。/li&gt;<a name="line.1354"></a>
<span class="sourceLineNo">1355</span>     *            &lt;li&gt;当checkMode=0x02时，checkBuf[0]= KCV的长度(4)，checkBuf + 1指向KCV的值。&lt;/li&gt;<a name="line.1355"></a>
<span class="sourceLineNo">1356</span>     *            &lt;li&gt;当checkMode=0x03时按以下规则提供checkBuf:<a name="line.1356"></a>
<span class="sourceLineNo">1357</span>     *            &lt;p&gt;<a name="line.1357"></a>
<span class="sourceLineNo">1358</span>     *            checkBuf[0]= KcvData长度(KcvDataLen)<a name="line.1358"></a>
<span class="sourceLineNo">1359</span>     *            &lt;/p&gt;<a name="line.1359"></a>
<span class="sourceLineNo">1360</span>     *            &lt;p&gt;<a name="line.1360"></a>
<span class="sourceLineNo">1361</span>     *            checkBuf+1: KcvData<a name="line.1361"></a>
<span class="sourceLineNo">1362</span>     *            &lt;/p&gt;<a name="line.1362"></a>
<span class="sourceLineNo">1363</span>     *            &lt;p&gt;<a name="line.1363"></a>
<span class="sourceLineNo">1364</span>     *            checkBuf[1+KcvDataLen]=MAC运算模式,参考{@link #getMacAes(byte, byte[], byte)}中的mode参数<a name="line.1364"></a>
<span class="sourceLineNo">1365</span>     *            &lt;/p&gt;<a name="line.1365"></a>
<span class="sourceLineNo">1366</span>     *            &lt;p&gt;<a name="line.1366"></a>
<span class="sourceLineNo">1367</span>     *            checkBuf[2+KcvDataLen]=KCV长度<a name="line.1367"></a>
<span class="sourceLineNo">1368</span>     *            &lt;/p&gt;<a name="line.1368"></a>
<span class="sourceLineNo">1369</span>     *            &lt;p&gt;<a name="line.1369"></a>
<span class="sourceLineNo">1370</span>     *            checkBuf[3+KcvDataLen]是KCV的值<a name="line.1370"></a>
<span class="sourceLineNo">1371</span>     *            &lt;/p&gt;<a name="line.1371"></a>
<span class="sourceLineNo">1372</span>     *            &lt;/li&gt;<a name="line.1372"></a>
<span class="sourceLineNo">1373</span>     *            &lt;/ul&gt;<a name="line.1373"></a>
<span class="sourceLineNo">1374</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1374"></a>
<span class="sourceLineNo">1375</span>     *            &lt;p&gt;<a name="line.1375"></a>
<span class="sourceLineNo">1376</span>     *            Check Data Buffer<a name="line.1376"></a>
<span class="sourceLineNo">1377</span>     *            &lt;/p&gt;<a name="line.1377"></a>
<span class="sourceLineNo">1378</span>     *            &lt;ul&gt;<a name="line.1378"></a>
<span class="sourceLineNo">1379</span>     *            &lt;li&gt;When checkMode=0x00 -PED won't check KCV, this data is no meaning.&lt;/li&gt;<a name="line.1379"></a>
<span class="sourceLineNo">1380</span>     *            &lt;li&gt;When checkMode=0x01 -checkBuf[0] = length of KCV (4), checkBuf + 1 points to the value of KCV.&lt;/li&gt;<a name="line.1380"></a>
<span class="sourceLineNo">1381</span>     *            &lt;li&gt;When checkMode=0x02 -checkBuf[0] = length of KCV (4), checkBuf + 1 points to the value of KCV.&lt;/li&gt;<a name="line.1381"></a>
<span class="sourceLineNo">1382</span>     *            &lt;li&gt;When checkMode=0x03 - checkBuf as follows: checkBuf[0] = length of KcvData<a name="line.1382"></a>
<span class="sourceLineNo">1383</span>     *            checkBuf+1: kcvData checkBuf[1+kcvDataLen]: MAC computation mode<a name="line.1383"></a>
<span class="sourceLineNo">1384</span>     *            {@link #getMacAes(byte, byte[], byte)} checkBuf[2+kcvDataLen]:KCV length<a name="line.1384"></a>
<span class="sourceLineNo">1385</span>     *            checkBuf[3+kcvDataLen]:KCV Value&lt;/li&gt;<a name="line.1385"></a>
<span class="sourceLineNo">1386</span>     *            &lt;/ul&gt;<a name="line.1386"></a>
<span class="sourceLineNo">1387</span>     *            &lt;/div&gt;<a name="line.1387"></a>
<span class="sourceLineNo">1388</span>     *<a name="line.1388"></a>
<span class="sourceLineNo">1389</span>     * @throws PedDevException<a name="line.1389"></a>
<span class="sourceLineNo">1390</span>     * @since V4.00.00<a name="line.1390"></a>
<span class="sourceLineNo">1391</span>     */<a name="line.1391"></a>
<span class="sourceLineNo">1392</span>    void writeAesKey(byte srcKeyType, byte srcKeyIndex, byte destKeyType, byte destKeyIndex, byte[] destKeyValue,<a name="line.1392"></a>
<span class="sourceLineNo">1393</span>                            byte checkMode, byte[] checkBuf) throws PedDevException;<a name="line.1393"></a>
<span class="sourceLineNo">1394</span><a name="line.1394"></a>
<span class="sourceLineNo">1395</span><a name="line.1395"></a>
<span class="sourceLineNo">1396</span>    /**<a name="line.1396"></a>
<span class="sourceLineNo">1397</span>     * &lt;div class="zh"&gt; 1.注入RSA密钥到PED &lt;br/&gt;<a name="line.1397"></a>
<span class="sourceLineNo">1398</span>     * 2.PED最多支持10组RSA密钥,目前最长只支持256字节长的RSA密钥。 &lt;br/&gt;<a name="line.1398"></a>
<span class="sourceLineNo">1399</span>     * 3.存储的RSA密钥是公钥还是私钥由密钥的指数长度决定,当密钥指数和模等长时,是私钥。 &lt;br/&gt;<a name="line.1399"></a>
<span class="sourceLineNo">1400</span>     * 4.PED通过writeRSAKey注入RSA密钥。 &lt;br/&gt;<a name="line.1400"></a>
<span class="sourceLineNo">1401</span>     * 5.通过RSARecover使用已注入的密钥进行RSA运算。 &lt;br/&gt;<a name="line.1401"></a>
<span class="sourceLineNo">1402</span>     * 6.任何时候,RSA密钥可以进行重写。 &lt;br/&gt;<a name="line.1402"></a>
<span class="sourceLineNo">1403</span>     * &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1403"></a>
<span class="sourceLineNo">1404</span>     * &lt;p&gt;<a name="line.1404"></a>
<span class="sourceLineNo">1405</span>     * 1. Import RSA to the PED<a name="line.1405"></a>
<span class="sourceLineNo">1406</span>     * &lt;/p&gt;<a name="line.1406"></a>
<span class="sourceLineNo">1407</span>     * &lt;p&gt;<a name="line.1407"></a>
<span class="sourceLineNo">1408</span>     * 2. PED can support 10 sets of RSA Key at most, current can supports a maximum length of 256 bytes RSA key.<a name="line.1408"></a>
<span class="sourceLineNo">1409</span>     * &lt;/p&gt;<a name="line.1409"></a>
<span class="sourceLineNo">1410</span>     * &lt;p&gt;<a name="line.1410"></a>
<span class="sourceLineNo">1411</span>     * 3. Whether the stored RSA is the public key or private key will be determined by the exponent length. If the<a name="line.1411"></a>
<span class="sourceLineNo">1412</span>     * length of key exponent is equal to modulus, it is a private key.<a name="line.1412"></a>
<span class="sourceLineNo">1413</span>     * &lt;/p&gt;<a name="line.1413"></a>
<span class="sourceLineNo">1414</span>     * &lt;p&gt;<a name="line.1414"></a>
<span class="sourceLineNo">1415</span>     * 4. PED uses writeRsaKey to Import RSA key.<a name="line.1415"></a>
<span class="sourceLineNo">1416</span>     * &lt;/p&gt;<a name="line.1416"></a>
<span class="sourceLineNo">1417</span>     * &lt;p&gt;<a name="line.1417"></a>
<span class="sourceLineNo">1418</span>     * 5. Use the imported key to do the RSA operation by calling PedRsaRecover.<a name="line.1418"></a>
<span class="sourceLineNo">1419</span>     * &lt;/p&gt;<a name="line.1419"></a>
<span class="sourceLineNo">1420</span>     * &lt;p&gt;<a name="line.1420"></a>
<span class="sourceLineNo">1421</span>     * 6. RSA key can be rewritten at any time<a name="line.1421"></a>
<span class="sourceLineNo">1422</span>     * &lt;/p&gt;<a name="line.1422"></a>
<span class="sourceLineNo">1423</span>     * &lt;/div&gt;<a name="line.1423"></a>
<span class="sourceLineNo">1424</span>     *<a name="line.1424"></a>
<span class="sourceLineNo">1425</span>     * @param rsaKeyIndex<a name="line.1425"></a>
<span class="sourceLineNo">1426</span>     *            &lt;div class="zh"&gt; RSA密钥索引[1~10] &lt;/div&gt; &lt;div class="en"&gt; RSA Key Index [1~10] &lt;/div&gt;<a name="line.1426"></a>
<span class="sourceLineNo">1427</span>     *<a name="line.1427"></a>
<span class="sourceLineNo">1428</span>     * @param info<a name="line.1428"></a>
<span class="sourceLineNo">1429</span>     *            {@link RSAKeyInfo}<a name="line.1429"></a>
<span class="sourceLineNo">1430</span>     * @throws PedDevException<a name="line.1430"></a>
<span class="sourceLineNo">1431</span>     * @since V4.00.00<a name="line.1431"></a>
<span class="sourceLineNo">1432</span>     */<a name="line.1432"></a>
<span class="sourceLineNo">1433</span>    void writeRSAKey(byte rsaKeyIndex, RSAKeyInfo info) throws PedDevException;<a name="line.1433"></a>
<span class="sourceLineNo">1434</span><a name="line.1434"></a>
<span class="sourceLineNo">1435</span><a name="line.1435"></a>
<span class="sourceLineNo">1436</span>    /**<a name="line.1436"></a>
<span class="sourceLineNo">1437</span>     * &lt;div class="zh"&gt; 写入TIK，并可以选择使用KCV验证密钥正确性。&lt;/div&gt;<a name="line.1437"></a>
<span class="sourceLineNo">1438</span>     * &lt;div class="en"&gt; Write in TIK, and can check the key correction by using KCV.&lt;/div&gt;<a name="line.1438"></a>
<span class="sourceLineNo">1439</span>     *<a name="line.1439"></a>
<span class="sourceLineNo">1440</span>     * @param groupIndex<a name="line.1440"></a>
<span class="sourceLineNo">1441</span>     *            &lt;div class="zh"&gt; [1~100] DUKPT密钥组索引号 &lt;/div&gt; &lt;div class="en"&gt; [1~100]DUKPT key group id &lt;/div&gt;<a name="line.1441"></a>
<span class="sourceLineNo">1442</span>     *<a name="line.1442"></a>
<span class="sourceLineNo">1443</span>     * @param srcKeyIndex<a name="line.1443"></a>
<span class="sourceLineNo">1444</span>     *            &lt;div class="zh"&gt; [1] 用于分散的密钥的密钥索引 &lt;/div&gt; &lt;div class="en"&gt; [1] The key index for diversified key.<a name="line.1444"></a>
<span class="sourceLineNo">1445</span>     *            &lt;/div&gt;<a name="line.1445"></a>
<span class="sourceLineNo">1446</span>     *<a name="line.1446"></a>
<span class="sourceLineNo">1447</span>     * @param keyValue<a name="line.1447"></a>
<span class="sourceLineNo">1448</span>     *            &lt;div class="zh"&gt; 指向TIK的密文,现 DUKPT 算法支持 8/16 字节长度的密钥 &lt;/div&gt; &lt;div class="en"&gt; Point to TIK cipher text. Now the DUKPT algorithm supports keys with a length of 8/16 bytes &lt;/div&gt;<a name="line.1448"></a>
<span class="sourceLineNo">1449</span>     *<a name="line.1449"></a>
<span class="sourceLineNo">1450</span>     * @param ksn<a name="line.1450"></a>
<span class="sourceLineNo">1451</span>     *            &lt;div class="zh"&gt; 指向初始化KSN &lt;/div&gt; &lt;div class="en"&gt; Point to KSN initialization. &lt;/div&gt;<a name="line.1451"></a>
<span class="sourceLineNo">1452</span>     *<a name="line.1452"></a>
<span class="sourceLineNo">1453</span>     * @param checkMode<a name="line.1453"></a>
<span class="sourceLineNo">1454</span>     *            &lt;div class="zh"&gt; {@link ECheckMode} &lt;/div&gt; &lt;div class="en"&gt; reference {@link #writeKey} checkMode<a name="line.1454"></a>
<span class="sourceLineNo">1455</span>     *            &lt;/div&gt;<a name="line.1455"></a>
<span class="sourceLineNo">1456</span>     * @param checkBuf<a name="line.1456"></a>
<span class="sourceLineNo">1457</span>     *            &lt;div class="zh"&gt; 参考{@link #writeKey} writeKey}关于checkBuf说明 &lt;/div&gt; &lt;div class="en"&gt; reference<a name="line.1457"></a>
<span class="sourceLineNo">1458</span>     *            {@link #writeKey} the information about checkBuf &lt;/div&gt;<a name="line.1458"></a>
<span class="sourceLineNo">1459</span>     *<a name="line.1459"></a>
<span class="sourceLineNo">1460</span>     * @throws PedDevException<a name="line.1460"></a>
<span class="sourceLineNo">1461</span>     * @since V4.00.00<a name="line.1461"></a>
<span class="sourceLineNo">1462</span>     */<a name="line.1462"></a>
<span class="sourceLineNo">1463</span>    void writeTIK(byte groupIndex, byte srcKeyIndex, byte[] keyValue, byte[] ksn, ECheckMode checkMode,<a name="line.1463"></a>
<span class="sourceLineNo">1464</span>                         byte[] checkBuf) throws PedDevException;<a name="line.1464"></a>
<span class="sourceLineNo">1465</span><a name="line.1465"></a>
<span class="sourceLineNo">1466</span><a name="line.1466"></a>
<span class="sourceLineNo">1467</span><a name="line.1467"></a>
<span class="sourceLineNo">1468</span>    /**<a name="line.1468"></a>
<span class="sourceLineNo">1469</span>     * &lt;div class="zh"&gt; 使用SecureData作为datain发散目的密钥。&lt;/div&gt;<a name="line.1469"></a>
<span class="sourceLineNo">1470</span>     * &lt;div class="en"&gt; Use SecureData as the datain divergence key.&lt;/div&gt;<a name="line.1470"></a>
<span class="sourceLineNo">1471</span>     *<a name="line.1471"></a>
<span class="sourceLineNo">1472</span>     * @param srcKeyType<a name="line.1472"></a>
<span class="sourceLineNo">1473</span>     *            &lt;div&gt; source key type, must be TMK(0x02) in DerivationMode 0  &lt;/div&gt;<a name="line.1473"></a>
<span class="sourceLineNo">1474</span>     *<a name="line.1474"></a>
<span class="sourceLineNo">1475</span>     * @param srcKeyIdx<a name="line.1475"></a>
<span class="sourceLineNo">1476</span>     *            &lt;div&gt; source key index, 1-100 in TMK area  &lt;/div&gt;<a name="line.1476"></a>
<span class="sourceLineNo">1477</span>     *<a name="line.1477"></a>
<span class="sourceLineNo">1478</span>     * @param dstKeyType<a name="line.1478"></a>
<span class="sourceLineNo">1479</span>     *            &lt;div&gt;  destination key type, must be TMK(0x02) in DerivationMode 0  &lt;/div&gt;<a name="line.1479"></a>
<span class="sourceLineNo">1480</span>     *<a name="line.1480"></a>
<span class="sourceLineNo">1481</span>     * @param dstKeyIdx<a name="line.1481"></a>
<span class="sourceLineNo">1482</span>     *            &lt;div&gt; destination key, 1-100 in TMK area &lt;/div&gt;<a name="line.1482"></a>
<span class="sourceLineNo">1483</span>     *<a name="line.1483"></a>
<span class="sourceLineNo">1484</span>     * @param secureDataIndex<a name="line.1484"></a>
<span class="sourceLineNo">1485</span>     *            &lt;div&gt;SecureData Index in working key area, 1-100  &lt;/div&gt;<a name="line.1485"></a>
<span class="sourceLineNo">1486</span>     * @param additionalDataIn<a name="line.1486"></a>
<span class="sourceLineNo">1487</span>     *            &lt;div&gt; 64 bytes Additional Data, can be null if not used. DerivationMode 0: not used, can be null. &lt;/div&gt;<a name="line.1487"></a>
<span class="sourceLineNo">1488</span>     * @param derivationMode<a name="line.1488"></a>
<span class="sourceLineNo">1489</span>     *            &lt;div&gt; only support 0, GOWF algorithm &lt;/div&gt;<a name="line.1489"></a>
<span class="sourceLineNo">1490</span>     *<a name="line.1490"></a>
<span class="sourceLineNo">1491</span>     * @throws PedDevException<a name="line.1491"></a>
<span class="sourceLineNo">1492</span>     * @since V4.00.00<a name="line.1492"></a>
<span class="sourceLineNo">1493</span>     */<a name="line.1493"></a>
<span class="sourceLineNo">1494</span>    void deriveKeyBySecureData(byte srcKeyType, byte srcKeyIdx, byte dstKeyType,  byte dstKeyIdx, byte secureDataIndex,<a name="line.1494"></a>
<span class="sourceLineNo">1495</span>                                      byte[] additionalDataIn, byte derivationMode) throws PedDevException;<a name="line.1495"></a>
<span class="sourceLineNo">1496</span><a name="line.1496"></a>
<span class="sourceLineNo">1497</span><a name="line.1497"></a>
<span class="sourceLineNo">1498</span><a name="line.1498"></a>
<span class="sourceLineNo">1499</span>    /**<a name="line.1499"></a>
<span class="sourceLineNo">1500</span>     * &lt;div class="zh"&gt; 删除应用密钥。&lt;/div&gt;<a name="line.1500"></a>
<span class="sourceLineNo">1501</span>     * &lt;div class="en"&gt; delete app key.&lt;/div&gt;<a name="line.1501"></a>
<span class="sourceLineNo">1502</span>     *<a name="line.1502"></a>
<span class="sourceLineNo">1503</span><a name="line.1503"></a>
<span class="sourceLineNo">1504</span>     * @param mode<a name="line.1504"></a>
<span class="sourceLineNo">1505</span>     *            &lt;div class="zh"&gt; 模式 0:表示删除密钥 ,目前仅支持0 &lt;/div&gt;<a name="line.1505"></a>
<span class="sourceLineNo">1506</span>     *            &lt;div class="en"&gt; Mode 0: means to delete the key, currently only supports 0&lt;/div&gt;<a name="line.1506"></a>
<span class="sourceLineNo">1507</span>     *<a name="line.1507"></a>
<span class="sourceLineNo">1508</span>     * @throws PedDevException<a name="line.1508"></a>
<span class="sourceLineNo">1509</span>     * @since V4.00.00<a name="line.1509"></a>
<span class="sourceLineNo">1510</span>     */<a name="line.1510"></a>
<span class="sourceLineNo">1511</span>    void eraseAppKeys(int mode) throws PedDevException;<a name="line.1511"></a>
<span class="sourceLineNo">1512</span><a name="line.1512"></a>
<span class="sourceLineNo">1513</span><a name="line.1513"></a>
<span class="sourceLineNo">1514</span>    /**<a name="line.1514"></a>
<span class="sourceLineNo">1515</span>     * &lt;div class="zh"&gt;擦除指定的密钥。&lt;/div&gt;<a name="line.1515"></a>
<span class="sourceLineNo">1516</span>     * &lt;div class="en"&gt;Erases the specified key. &lt;/div&gt;<a name="line.1516"></a>
<span class="sourceLineNo">1517</span>     *<a name="line.1517"></a>
<span class="sourceLineNo">1518</span>     * @param keyType  &lt;div class="zh"&gt;密钥类型。<a name="line.1518"></a>
<span class="sourceLineNo">1519</span>     *                 &lt;ul&gt;<a name="line.1519"></a>
<span class="sourceLineNo">1520</span>     *                 &lt;li&gt;0x02: TMK&lt;/li&gt;<a name="line.1520"></a>
<span class="sourceLineNo">1521</span>     *                 &lt;li&gt;0x0A: TWK&lt;/li&gt;<a name="line.1521"></a>
<span class="sourceLineNo">1522</span>     *                 &lt;li&gt;0x07: TIK&lt;/li&gt;<a name="line.1522"></a>
<span class="sourceLineNo">1523</span>     *                 &lt;li&gt;0x51: AES_TIK&lt;/li&gt;<a name="line.1523"></a>
<span class="sourceLineNo">1524</span>     *                 &lt;li&gt;0x61: ECC&lt;/li&gt;<a name="line.1524"></a>
<span class="sourceLineNo">1525</span>     *                 &lt;li&gt;0x0B: RSA&lt;/li&gt;<a name="line.1525"></a>
<span class="sourceLineNo">1526</span>     *                 &lt;li&gt;0x30: SM2_PVT_KEY&lt;/li&gt;<a name="line.1526"></a>
<span class="sourceLineNo">1527</span>     *                 &lt;li&gt;0x31: SM2_PUB_KEY&lt;/li&gt;<a name="line.1527"></a>
<span class="sourceLineNo">1528</span>     *                 &lt;/ul&gt;<a name="line.1528"></a>
<span class="sourceLineNo">1529</span>     *                 &lt;/div&gt;<a name="line.1529"></a>
<span class="sourceLineNo">1530</span>     *                 &lt;div class="en"&gt;Key type.<a name="line.1530"></a>
<span class="sourceLineNo">1531</span>     *                 &lt;ul&gt;<a name="line.1531"></a>
<span class="sourceLineNo">1532</span>     *                 &lt;li&gt;0x02: TMK&lt;/li&gt;<a name="line.1532"></a>
<span class="sourceLineNo">1533</span>     *                 &lt;li&gt;0x0A: TWK&lt;/li&gt;<a name="line.1533"></a>
<span class="sourceLineNo">1534</span>     *                 &lt;li&gt;0x07: TIK&lt;/li&gt;<a name="line.1534"></a>
<span class="sourceLineNo">1535</span>     *                 &lt;li&gt;0x51: AES_TIK&lt;/li&gt;<a name="line.1535"></a>
<span class="sourceLineNo">1536</span>     *                 &lt;li&gt;0x61: ECC&lt;/li&gt;<a name="line.1536"></a>
<span class="sourceLineNo">1537</span>     *                 &lt;li&gt;0x0B: RSA&lt;/li&gt;<a name="line.1537"></a>
<span class="sourceLineNo">1538</span>     *                 &lt;li&gt;0x30: SM2_PVT_KEY&lt;/li&gt;<a name="line.1538"></a>
<span class="sourceLineNo">1539</span>     *                 &lt;li&gt;0x31: SM2_PUB_KEY&lt;/li&gt;<a name="line.1539"></a>
<span class="sourceLineNo">1540</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.1540"></a>
<span class="sourceLineNo">1541</span>     * @param keyIndex &lt;div class="zh"&gt;密钥索引。<a name="line.1541"></a>
<span class="sourceLineNo">1542</span>     *                 &lt;ul&gt;<a name="line.1542"></a>
<span class="sourceLineNo">1543</span>     *                 &lt;li&gt;TMK [1~100]&lt;/li&gt;<a name="line.1543"></a>
<span class="sourceLineNo">1544</span>     *                 &lt;li&gt;TWK [1~100]&lt;/li&gt;<a name="line.1544"></a>
<span class="sourceLineNo">1545</span>     *                 &lt;li&gt;TIK [1~100]&lt;/li&gt;<a name="line.1545"></a>
<span class="sourceLineNo">1546</span>     *                 &lt;li&gt;RSA [1~10]&lt;/li&gt;<a name="line.1546"></a>
<span class="sourceLineNo">1547</span>     *                 &lt;li&gt;ECC [1~20]&lt;/li&gt;<a name="line.1547"></a>
<span class="sourceLineNo">1548</span>     *                 &lt;li&gt;SM2_PVT_KEY [1~20]&lt;/li&gt;<a name="line.1548"></a>
<span class="sourceLineNo">1549</span>     *                 &lt;li&gt;SM2_PUB_KEY [1~20]&lt;/li&gt;<a name="line.1549"></a>
<span class="sourceLineNo">1550</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.1550"></a>
<span class="sourceLineNo">1551</span>     *                 &lt;div class="en"&gt;Key index.<a name="line.1551"></a>
<span class="sourceLineNo">1552</span>     *                 &lt;ul&gt;<a name="line.1552"></a>
<span class="sourceLineNo">1553</span>     *                 &lt;li&gt;TMK [1~100]&lt;/li&gt;<a name="line.1553"></a>
<span class="sourceLineNo">1554</span>     *                 &lt;li&gt;TWK [1~100]&lt;/li&gt;<a name="line.1554"></a>
<span class="sourceLineNo">1555</span>     *                 &lt;li&gt;TIK [1~100]&lt;/li&gt;<a name="line.1555"></a>
<span class="sourceLineNo">1556</span>     *                 &lt;li&gt;RSA [1~10]&lt;/li&gt;<a name="line.1556"></a>
<span class="sourceLineNo">1557</span>     *                 &lt;li&gt;ECC [1~20]&lt;/li&gt;<a name="line.1557"></a>
<span class="sourceLineNo">1558</span>     *                 &lt;li&gt;SM2_PVT_KEY [1~20]&lt;/li&gt;<a name="line.1558"></a>
<span class="sourceLineNo">1559</span>     *                 &lt;li&gt;SM2_PUB_KEY [1~20]&lt;/li&gt;<a name="line.1559"></a>
<span class="sourceLineNo">1560</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.1560"></a>
<span class="sourceLineNo">1561</span>     * @throws PedDevException<a name="line.1561"></a>
<span class="sourceLineNo">1562</span>     * @since V4.00.00<a name="line.1562"></a>
<span class="sourceLineNo">1563</span>     */<a name="line.1563"></a>
<span class="sourceLineNo">1564</span>    void eraseKey(byte keyType, byte keyIndex) throws PedDevException;<a name="line.1564"></a>
<span class="sourceLineNo">1565</span><a name="line.1565"></a>
<span class="sourceLineNo">1566</span><a name="line.1566"></a>
<span class="sourceLineNo">1567</span>    /**<a name="line.1567"></a>
<span class="sourceLineNo">1568</span>     * &lt;div class="zh"&gt; 生成RSA密钥对然后注入PED。&lt;/div&gt;<a name="line.1568"></a>
<span class="sourceLineNo">1569</span>     * &lt;div class="en"&gt; Generate RSA key pair and inject into PED.&lt;/div&gt;<a name="line.1569"></a>
<span class="sourceLineNo">1570</span>     *<a name="line.1570"></a>
<span class="sourceLineNo">1571</span>     * @param mode  &lt;div class="zh"&gt;<a name="line.1571"></a>
<span class="sourceLineNo">1572</span>     *              &lt;ul&gt;<a name="line.1572"></a>
<span class="sourceLineNo">1573</span>     *              &lt;li&gt;mode = 0, 等同于{@link IPed#genRSAKey}&lt;/li&gt;<a name="line.1573"></a>
<span class="sourceLineNo">1574</span>     *              &lt;li&gt;mode = 1, 等同于{@link IPedTrSys#genRsaKey}&lt;/li&gt;<a name="line.1574"></a>
<span class="sourceLineNo">1575</span>     *              &lt;li&gt;mode = 2, 跟模式0一样，唯一区别是，私钥注入的是TYPE_AS2805_TCU_RSA类型的RSA。&lt;/li&gt;<a name="line.1575"></a>
<span class="sourceLineNo">1576</span>     *              &lt;/ul&gt;&lt;/div&gt;<a name="line.1576"></a>
<span class="sourceLineNo">1577</span>     *              &lt;div class="en"&gt;<a name="line.1577"></a>
<span class="sourceLineNo">1578</span>     *              &lt;ul&gt;<a name="line.1578"></a>
<span class="sourceLineNo">1579</span>     *              &lt;li&gt;mode = 0, same as {@link IPed#genRSAKey}&lt;/li&gt;<a name="line.1579"></a>
<span class="sourceLineNo">1580</span>     *              &lt;li&gt;mode = 1, same as {@link IPedTrSys#genRsaKey}&lt;/li&gt;<a name="line.1580"></a>
<span class="sourceLineNo">1581</span>     *              &lt;li&gt;mode = 2, same as mode 0, the only difference is that the private key is injected into RSA of type TYPE_AS2805_TCU_RSA.&lt;/li&gt;<a name="line.1581"></a>
<span class="sourceLineNo">1582</span>     *              &lt;/ul&gt;&lt;/div&gt;<a name="line.1582"></a>
<span class="sourceLineNo">1583</span>     *<a name="line.1583"></a>
<span class="sourceLineNo">1584</span>     *<a name="line.1584"></a>
<span class="sourceLineNo">1585</span>     * @param prvKeyIdx &lt;div class="zh"&gt;<a name="line.1585"></a>
<span class="sourceLineNo">1586</span>     *                  &lt;ul&gt;<a name="line.1586"></a>
<span class="sourceLineNo">1587</span>     *                  &lt;li&gt;mode = 0, 私钥索引为 1-10 &lt;/li&gt;<a name="line.1587"></a>
<span class="sourceLineNo">1588</span>     *                  &lt;li&gt;mode = 1, 私钥索引只支持 1&lt;/li&gt;<a name="line.1588"></a>
<span class="sourceLineNo">1589</span>     *                  &lt;li&gt;mode = 2, 私钥索引为 1-10 &lt;/li&gt;<a name="line.1589"></a>
<span class="sourceLineNo">1590</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1590"></a>
<span class="sourceLineNo">1591</span>     *                  &lt;div class="en"&gt;<a name="line.1591"></a>
<span class="sourceLineNo">1592</span>     *                  &lt;ul&gt;<a name="line.1592"></a>
<span class="sourceLineNo">1593</span>     *                  &lt;li&gt;mode = 0, the private key index is 1-10&lt;/li&gt;<a name="line.1593"></a>
<span class="sourceLineNo">1594</span>     *                  &lt;li&gt;mode = 1, the private key index only supports 1&lt;/li&gt;<a name="line.1594"></a>
<span class="sourceLineNo">1595</span>     *                  &lt;li&gt;mode = 2, the private key index is 1-10&lt;/li&gt;<a name="line.1595"></a>
<span class="sourceLineNo">1596</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1596"></a>
<span class="sourceLineNo">1597</span>     *<a name="line.1597"></a>
<span class="sourceLineNo">1598</span>     *<a name="line.1598"></a>
<span class="sourceLineNo">1599</span>     * @param pubKeyIdx &lt;div class="zh"&gt;<a name="line.1599"></a>
<span class="sourceLineNo">1600</span>     *                  &lt;ul&gt;<a name="line.1600"></a>
<span class="sourceLineNo">1601</span>     *                  &lt;li&gt;mode = 0, 公钥索引为 1-10 &lt;/li&gt;<a name="line.1601"></a>
<span class="sourceLineNo">1602</span>     *                  &lt;li&gt;mode = 1, 公钥索引只支持 2&lt;/li&gt;<a name="line.1602"></a>
<span class="sourceLineNo">1603</span>     *                  &lt;li&gt;mode = 2, 公钥索引为 1-10 &lt;/li&gt;<a name="line.1603"></a>
<span class="sourceLineNo">1604</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1604"></a>
<span class="sourceLineNo">1605</span>     *                  &lt;div class="en"&gt;<a name="line.1605"></a>
<span class="sourceLineNo">1606</span>     *                  &lt;ul&gt;<a name="line.1606"></a>
<span class="sourceLineNo">1607</span>     *                  &lt;li&gt;mode = 0, the public key index is 1-10&lt;/li&gt;<a name="line.1607"></a>
<span class="sourceLineNo">1608</span>     *                  &lt;li&gt;mode = 1, the public key index only supports 2&lt;/li&gt;<a name="line.1608"></a>
<span class="sourceLineNo">1609</span>     *                  &lt;li&gt;mode = 2, the public key index is 1-10&lt;/li&gt;<a name="line.1609"></a>
<span class="sourceLineNo">1610</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1610"></a>
<span class="sourceLineNo">1611</span>     *<a name="line.1611"></a>
<span class="sourceLineNo">1612</span>     *<a name="line.1612"></a>
<span class="sourceLineNo">1613</span>     * @param modLenBit &lt;div class="zh"&gt;Modulus 长度,支持 512,1024,2048. &lt;/div&gt; &lt;div class="en"&gt;Modulus length, support 512,1024,2048.&lt;/div&gt;<a name="line.1613"></a>
<span class="sourceLineNo">1614</span>     *<a name="line.1614"></a>
<span class="sourceLineNo">1615</span>     *<a name="line.1615"></a>
<span class="sourceLineNo">1616</span>     * @param pubExpType &lt;div class="zh"&gt;公共指数类型 0x00:3 , 0x01:65537 &lt;/div&gt;&lt;div class="en"&gt;public exponent type 0x00:3 , 0x01:65537&lt;/div&gt;<a name="line.1616"></a>
<span class="sourceLineNo">1617</span>     *<a name="line.1617"></a>
<span class="sourceLineNo">1618</span>     *<a name="line.1618"></a>
<span class="sourceLineNo">1619</span>     * @throws PedDevException<a name="line.1619"></a>
<span class="sourceLineNo">1620</span>     * @since V4.00.00<a name="line.1620"></a>
<span class="sourceLineNo">1621</span>     */<a name="line.1621"></a>
<span class="sourceLineNo">1622</span>    void genRsaKey(byte mode, byte prvKeyIdx, byte pubKeyIdx, short modLenBit, byte pubExpType) throws PedDevException;<a name="line.1622"></a>
<span class="sourceLineNo">1623</span><a name="line.1623"></a>
<span class="sourceLineNo">1624</span><a name="line.1624"></a>
<span class="sourceLineNo">1625</span><a name="line.1625"></a>
<span class="sourceLineNo">1626</span><a name="line.1626"></a>
<span class="sourceLineNo">1627</span><a name="line.1627"></a>
<span class="sourceLineNo">1628</span>    /**<a name="line.1628"></a>
<span class="sourceLineNo">1629</span>     * &lt;div class="zh"&gt; 写入一个密钥，包括TLK，TMK和TWK的写入、发散，并可以选择使用KCV验证密钥正确性。<a name="line.1629"></a>
<span class="sourceLineNo">1630</span>     * &lt;p&gt;<a name="line.1630"></a>
<span class="sourceLineNo">1631</span>     * 当写入PED_TLK时，PED首先格式化，清除所有已经下载的密钥，再写入PED_TLK。 明文写入密钥时，srcKeyIndex=0。<a name="line.1631"></a>
<span class="sourceLineNo">1632</span>     * &lt;/p&gt;<a name="line.1632"></a>
<span class="sourceLineNo">1633</span>     * &lt;/div&gt;<a name="line.1633"></a>
<span class="sourceLineNo">1634</span>     * &lt;div class="en"&gt; Write in one key includes write in and divergent of TLK, TMK and TWK. And use KCV to check the<a name="line.1634"></a>
<span class="sourceLineNo">1635</span>     * key correction.<a name="line.1635"></a>
<span class="sourceLineNo">1636</span>     * &lt;p&gt;<a name="line.1636"></a>
<span class="sourceLineNo">1637</span>     * When write PED_TLK,PED will format ,clear all the key has been downloaded,then write in PED_TLK. Writing the<a name="line.1637"></a>
<span class="sourceLineNo">1638</span>     * plaintext into a key, when scrKeyIndex=0.<a name="line.1638"></a>
<span class="sourceLineNo">1639</span>     * &lt;/p&gt;<a name="line.1639"></a>
<span class="sourceLineNo">1640</span>     * &lt;/div&gt;<a name="line.1640"></a>
<span class="sourceLineNo">1641</span>     *<a name="line.1641"></a>
<span class="sourceLineNo">1642</span>     * @param srcKeyType<a name="line.1642"></a>
<span class="sourceLineNo">1643</span>     *            &lt;div class="zh"&gt;<a name="line.1643"></a>
<span class="sourceLineNo">1644</span>     *            &lt;p&gt;<a name="line.1644"></a>
<span class="sourceLineNo">1645</span>     *            源密钥类型,它的级别不能低于destKeyType, SM4类型秘钥只能用TLK和SM4_TMK发散。<a name="line.1645"></a>
<span class="sourceLineNo">1646</span>     *            &lt;/p&gt;<a name="line.1646"></a>
<span class="sourceLineNo">1647</span>     *            &lt;ul&gt;<a name="line.1647"></a>
<span class="sourceLineNo">1648</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1648"></a>
<span class="sourceLineNo">1649</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1649"></a>
<span class="sourceLineNo">1650</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1650"></a>
<span class="sourceLineNo">1651</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1651"></a>
<span class="sourceLineNo">1652</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1652"></a>
<span class="sourceLineNo">1653</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1653"></a>
<span class="sourceLineNo">1654</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1654"></a>
<span class="sourceLineNo">1655</span>     *            &lt;/ul&gt;<a name="line.1655"></a>
<span class="sourceLineNo">1656</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1656"></a>
<span class="sourceLineNo">1657</span>     *            &lt;p&gt;<a name="line.1657"></a>
<span class="sourceLineNo">1658</span>     *            Source Key Type，its level cannot be lower than destKeyType, SM4 type keys can only be diverged with TLK and SM4_TMK.<a name="line.1658"></a>
<span class="sourceLineNo">1659</span>     *            &lt;/p&gt;<a name="line.1659"></a>
<span class="sourceLineNo">1660</span>     *            &lt;ul&gt;<a name="line.1660"></a>
<span class="sourceLineNo">1661</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1661"></a>
<span class="sourceLineNo">1662</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1662"></a>
<span class="sourceLineNo">1663</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1663"></a>
<span class="sourceLineNo">1664</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1664"></a>
<span class="sourceLineNo">1665</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1665"></a>
<span class="sourceLineNo">1666</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1666"></a>
<span class="sourceLineNo">1667</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1667"></a>
<span class="sourceLineNo">1668</span>     *            &lt;/ul&gt;<a name="line.1668"></a>
<span class="sourceLineNo">1669</span>     *            &lt;/div&gt;<a name="line.1669"></a>
<span class="sourceLineNo">1670</span>     *<a name="line.1670"></a>
<span class="sourceLineNo">1671</span>     *<a name="line.1671"></a>
<span class="sourceLineNo">1672</span>     * @param srcKeyIndex<a name="line.1672"></a>
<span class="sourceLineNo">1673</span>     *            &lt;div class="zh"&gt;<a name="line.1673"></a>
<span class="sourceLineNo">1674</span>     *            &lt;p&gt;<a name="line.1674"></a>
<span class="sourceLineNo">1675</span>     *            源密钥索引<a name="line.1675"></a>
<span class="sourceLineNo">1676</span>     *            &lt;/p&gt;<a name="line.1676"></a>
<span class="sourceLineNo">1677</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1677"></a>
<span class="sourceLineNo">1678</span>     *            &lt;p&gt;<a name="line.1678"></a>
<span class="sourceLineNo">1679</span>     *            Source Key Index<a name="line.1679"></a>
<span class="sourceLineNo">1680</span>     *            &lt;/p&gt;<a name="line.1680"></a>
<span class="sourceLineNo">1681</span>     *            &lt;/div&gt;<a name="line.1681"></a>
<span class="sourceLineNo">1682</span>     *<a name="line.1682"></a>
<span class="sourceLineNo">1683</span>     * @param dstKeyType<a name="line.1683"></a>
<span class="sourceLineNo">1684</span>     *            &lt;div class="zh"&gt;<a name="line.1684"></a>
<span class="sourceLineNo">1685</span>     *            &lt;p&gt;<a name="line.1685"></a>
<span class="sourceLineNo">1686</span>     *            目的密钥类型<a name="line.1686"></a>
<span class="sourceLineNo">1687</span>     *            &lt;/p&gt;<a name="line.1687"></a>
<span class="sourceLineNo">1688</span>     *            &lt;ul&gt;<a name="line.1688"></a>
<span class="sourceLineNo">1689</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1689"></a>
<span class="sourceLineNo">1690</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1690"></a>
<span class="sourceLineNo">1691</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1691"></a>
<span class="sourceLineNo">1692</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1692"></a>
<span class="sourceLineNo">1693</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1693"></a>
<span class="sourceLineNo">1694</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1694"></a>
<span class="sourceLineNo">1695</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1695"></a>
<span class="sourceLineNo">1696</span>     *                &lt;li&gt;0x33:SM4_TPK&lt;/li&gt;<a name="line.1696"></a>
<span class="sourceLineNo">1697</span>     *                &lt;li&gt;0x34:SM4_TAK&lt;/li&gt;<a name="line.1697"></a>
<span class="sourceLineNo">1698</span>     *                &lt;li&gt;0x35:SM4_TDK&lt;/li&gt;<a name="line.1698"></a>
<span class="sourceLineNo">1699</span>     *                &lt;li&gt;0x36:SM4_TCHDK&lt;/li&gt;<a name="line.1699"></a>
<span class="sourceLineNo">1700</span>     *                &lt;li&gt;0x37:SM4_FACE_TDK&lt;/li&gt;<a name="line.1700"></a>
<span class="sourceLineNo">1701</span>     *            &lt;/ul&gt;<a name="line.1701"></a>
<span class="sourceLineNo">1702</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1702"></a>
<span class="sourceLineNo">1703</span>     *            &lt;p&gt;<a name="line.1703"></a>
<span class="sourceLineNo">1704</span>     *            Destination Key Type<a name="line.1704"></a>
<span class="sourceLineNo">1705</span>     *            &lt;/p&gt;<a name="line.1705"></a>
<span class="sourceLineNo">1706</span>     *            &lt;ul&gt;<a name="line.1706"></a>
<span class="sourceLineNo">1707</span>     *                &lt;li&gt;0x01:TLK&lt;/li&gt;<a name="line.1707"></a>
<span class="sourceLineNo">1708</span>     *                &lt;li&gt;0x02:TMK&lt;/li&gt;<a name="line.1708"></a>
<span class="sourceLineNo">1709</span>     *                &lt;li&gt;0x03:TPK&lt;/li&gt;<a name="line.1709"></a>
<span class="sourceLineNo">1710</span>     *                &lt;li&gt;0x04:TAK&lt;/li&gt;<a name="line.1710"></a>
<span class="sourceLineNo">1711</span>     *                &lt;li&gt;0x05:TDK&lt;/li&gt;<a name="line.1711"></a>
<span class="sourceLineNo">1712</span>     *                &lt;li&gt;0x11:FACE_TDK&lt;/li&gt;<a name="line.1712"></a>
<span class="sourceLineNo">1713</span>     *                &lt;li&gt;0x32:SM4_TMK&lt;/li&gt;<a name="line.1713"></a>
<span class="sourceLineNo">1714</span>     *                &lt;li&gt;0x33:SM4_TPK&lt;/li&gt;<a name="line.1714"></a>
<span class="sourceLineNo">1715</span>     *                &lt;li&gt;0x34:SM4_TAK&lt;/li&gt;<a name="line.1715"></a>
<span class="sourceLineNo">1716</span>     *                &lt;li&gt;0x35:SM4_TDK&lt;/li&gt;<a name="line.1716"></a>
<span class="sourceLineNo">1717</span>     *                &lt;li&gt;0x36:SM4_TCHDK&lt;/li&gt;<a name="line.1717"></a>
<span class="sourceLineNo">1718</span>     *                &lt;li&gt;0x37:SM4_FACE_TDK&lt;/li&gt;<a name="line.1718"></a>
<span class="sourceLineNo">1719</span>     *            &lt;/ul&gt;<a name="line.1719"></a>
<span class="sourceLineNo">1720</span>     *            &lt;/div&gt;<a name="line.1720"></a>
<span class="sourceLineNo">1721</span>     *<a name="line.1721"></a>
<span class="sourceLineNo">1722</span>     * @param dstKeyIndex<a name="line.1722"></a>
<span class="sourceLineNo">1723</span>     *            &lt;div class="zh"&gt;<a name="line.1723"></a>
<span class="sourceLineNo">1724</span>     *            &lt;p&gt;<a name="line.1724"></a>
<span class="sourceLineNo">1725</span>     *            目的密钥索引<a name="line.1725"></a>
<span class="sourceLineNo">1726</span>     *            &lt;/p&gt;<a name="line.1726"></a>
<span class="sourceLineNo">1727</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1727"></a>
<span class="sourceLineNo">1728</span>     *            &lt;p&gt;<a name="line.1728"></a>
<span class="sourceLineNo">1729</span>     *            Destination Key Index<a name="line.1729"></a>
<span class="sourceLineNo">1730</span>     *            &lt;/p&gt;<a name="line.1730"></a>
<span class="sourceLineNo">1731</span>     *            &lt;/div&gt;<a name="line.1731"></a>
<span class="sourceLineNo">1732</span>     *<a name="line.1732"></a>
<span class="sourceLineNo">1733</span>     * @param dstKeyValue<a name="line.1733"></a>
<span class="sourceLineNo">1734</span>     *            &lt;div class="zh"&gt;<a name="line.1734"></a>
<span class="sourceLineNo">1735</span>     *            &lt;p&gt;<a name="line.1735"></a>
<span class="sourceLineNo">1736</span>     *            密钥明文或密文,长度可为8,16,24<a name="line.1736"></a>
<span class="sourceLineNo">1737</span>     *            &lt;/p&gt;<a name="line.1737"></a>
<span class="sourceLineNo">1738</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1738"></a>
<span class="sourceLineNo">1739</span>     *            &lt;p&gt;<a name="line.1739"></a>
<span class="sourceLineNo">1740</span>     *            Plaintext or ciphertext key, the length can be 8, 16, 24<a name="line.1740"></a>
<span class="sourceLineNo">1741</span>     *            &lt;/p&gt;<a name="line.1741"></a>
<span class="sourceLineNo">1742</span>     *            &lt;/div&gt;<a name="line.1742"></a>
<span class="sourceLineNo">1743</span>     *<a name="line.1743"></a>
<span class="sourceLineNo">1744</span>     * @param checkMode<a name="line.1744"></a>
<span class="sourceLineNo">1745</span>     *            {@link ECheckMode} &lt;div class="zh"&gt;<a name="line.1745"></a>
<span class="sourceLineNo">1746</span>     *            &lt;p&gt;<a name="line.1746"></a>
<span class="sourceLineNo">1747</span>     *            校验模式<a name="line.1747"></a>
<span class="sourceLineNo">1748</span>     *            &lt;/p&gt;<a name="line.1748"></a>
<span class="sourceLineNo">1749</span>     *            &lt;ul&gt;<a name="line.1749"></a>
<span class="sourceLineNo">1750</span>     *            &lt;li&gt;{@link ECheckMode#KCV_NONE}&lt;/li&gt;<a name="line.1750"></a>
<span class="sourceLineNo">1751</span>     *            &lt;li&gt;{@link ECheckMode#KCV_ENCRYPT_0}&lt;/li&gt;<a name="line.1751"></a>
<span class="sourceLineNo">1752</span>     *            &lt;li&gt;{@link ECheckMode#KCV_ENCRYPT_FIX_DATA}&lt;/li&gt;<a name="line.1752"></a>
<span class="sourceLineNo">1753</span>     *            &lt;li&gt;{@link ECheckMode#KCV_MAC_INPUT_DATA}&lt;/li&gt;<a name="line.1753"></a>
<span class="sourceLineNo">1754</span>     *            &lt;li&gt;{@link ECheckMode#KCV_SM4_ENCRYPT_0}&lt;/li&gt;<a name="line.1754"></a>
<span class="sourceLineNo">1755</span>     *            &lt;/ul&gt;<a name="line.1755"></a>
<span class="sourceLineNo">1756</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1756"></a>
<span class="sourceLineNo">1757</span>     *            &lt;p&gt;<a name="line.1757"></a>
<span class="sourceLineNo">1758</span>     *            Check Mode<a name="line.1758"></a>
<span class="sourceLineNo">1759</span>     *            &lt;/p&gt;<a name="line.1759"></a>
<span class="sourceLineNo">1760</span>     *            &lt;ul&gt;<a name="line.1760"></a>
<span class="sourceLineNo">1761</span>     *            &lt;li&gt;When checkMode=KCV_NONE -No Check&lt;/li&gt;<a name="line.1761"></a>
<span class="sourceLineNo">1762</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_0 -Perform DES/TDES encryption on 8 bytes 0x00, and use first 4 bytes<a name="line.1762"></a>
<span class="sourceLineNo">1763</span>     *            as KCV.&lt;/li&gt;<a name="line.1763"></a>
<span class="sourceLineNo">1764</span>     *<a name="line.1764"></a>
<span class="sourceLineNo">1765</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_FIX_DATA -Perform parity check first, then perform DES/TDES encryption<a name="line.1765"></a>
<span class="sourceLineNo">1766</span>     *            on 8 bytes―\x12\x34\x56\x78\x90\x12\x34\x56, and use first 4 bytes as KCV.&lt;/li&gt;<a name="line.1766"></a>
<span class="sourceLineNo">1767</span>     *<a name="line.1767"></a>
<span class="sourceLineNo">1768</span>     *            &lt;li&gt;When iCheckMode=KCV_MAC_INPUT_DATA -Send in data KcvData, use source key to perform specified mode<a name="line.1768"></a>
<span class="sourceLineNo">1769</span>     *            of MAC on [aucDesKeyValue +KcvData], and use the 8 bytes result as KCV.&lt;/li&gt;<a name="line.1769"></a>
<span class="sourceLineNo">1770</span>     *<a name="line.1770"></a>
<span class="sourceLineNo">1771</span>     *            &lt;li&gt;When iCheckMode=KCV_SM4_ENCRYPT_0 -Perform TDES encryption on 16 bytes 0x00 by SM4, and use first<a name="line.1771"></a>
<span class="sourceLineNo">1772</span>     *            4 bytes as KCV.&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;<a name="line.1772"></a>
<span class="sourceLineNo">1773</span>     *<a name="line.1773"></a>
<span class="sourceLineNo">1774</span>     * @param checkBuf<a name="line.1774"></a>
<span class="sourceLineNo">1775</span>     *            &lt;div class="zh"&gt;<a name="line.1775"></a>
<span class="sourceLineNo">1776</span>     *            &lt;p&gt;<a name="line.1776"></a>
<span class="sourceLineNo">1777</span>     *            校验数据缓冲区<a name="line.1777"></a>
<span class="sourceLineNo">1778</span>     *            &lt;/p&gt;<a name="line.1778"></a>
<span class="sourceLineNo">1779</span>     *            &lt;ul&gt;<a name="line.1779"></a>
<span class="sourceLineNo">1780</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_NONE}时 checkBuf的值无效,系统认为不验证KCV,可以为null&lt;/li&gt;<a name="line.1780"></a>
<span class="sourceLineNo">1781</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_ENCRYPT_0},4字节的kcv&lt;/li&gt;<a name="line.1781"></a>
<span class="sourceLineNo">1782</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_ENCRYPT_FIX_DATA},4字节的kcv&lt;/li&gt;<a name="line.1782"></a>
<span class="sourceLineNo">1783</span>     *            &lt;li&gt;当iCheckMode={@link ECheckMode#KCV_MAC_INPUT_DATA}时按以下规则提供checkBuf:<a name="line.1783"></a>
<span class="sourceLineNo">1784</span>     *            &lt;p&gt;<a name="line.1784"></a>
<span class="sourceLineNo">1785</span>     *            checkBuf[0]= KcvData长度(KcvDataLen)<a name="line.1785"></a>
<span class="sourceLineNo">1786</span>     *            &lt;/p&gt;<a name="line.1786"></a>
<span class="sourceLineNo">1787</span>     *            &lt;p&gt;<a name="line.1787"></a>
<span class="sourceLineNo">1788</span>     *            checkBuf+1: KcvData<a name="line.1788"></a>
<span class="sourceLineNo">1789</span>     *            &lt;/p&gt;<a name="line.1789"></a>
<span class="sourceLineNo">1790</span>     *            &lt;p&gt;<a name="line.1790"></a>
<span class="sourceLineNo">1791</span>     *            checkBuf[1+KcvDataLen]=MAC运算模式,参考{@link #getMac(byte, byte[], byte)}中的mode参数<a name="line.1791"></a>
<span class="sourceLineNo">1792</span>     *            &lt;/p&gt;<a name="line.1792"></a>
<span class="sourceLineNo">1793</span>     *            &lt;p&gt;<a name="line.1793"></a>
<span class="sourceLineNo">1794</span>     *            checkBuf[2+KcvDataLen]=KCV长度<a name="line.1794"></a>
<span class="sourceLineNo">1795</span>     *            &lt;/p&gt;<a name="line.1795"></a>
<span class="sourceLineNo">1796</span>     *            &lt;p&gt;<a name="line.1796"></a>
<span class="sourceLineNo">1797</span>     *            checkBuf[3+KcvDataLen]是KCV的值<a name="line.1797"></a>
<span class="sourceLineNo">1798</span>     *            &lt;/p&gt;<a name="line.1798"></a>
<span class="sourceLineNo">1799</span>     *            &lt;/li&gt;<a name="line.1799"></a>
<span class="sourceLineNo">1800</span>     *            &lt;li&gt;当checkMode={@link ECheckMode#KCV_SM4_ENCRYPT_0},4字节的kcv&lt;/li&gt;<a name="line.1800"></a>
<span class="sourceLineNo">1801</span>     *            &lt;/ul&gt;<a name="line.1801"></a>
<span class="sourceLineNo">1802</span>     *            &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1802"></a>
<span class="sourceLineNo">1803</span>     *            &lt;p&gt;<a name="line.1803"></a>
<span class="sourceLineNo">1804</span>     *            Check Data Buffer<a name="line.1804"></a>
<span class="sourceLineNo">1805</span>     *            &lt;/p&gt;<a name="line.1805"></a>
<span class="sourceLineNo">1806</span>     *            &lt;ul&gt;<a name="line.1806"></a>
<span class="sourceLineNo">1807</span>     *            &lt;li&gt;When checkMode=KCV_NONE -PED wont check KCV, this data is no meaning.&lt;/li&gt;<a name="line.1807"></a>
<span class="sourceLineNo">1808</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_0 -4 bytes key check value&lt;/li&gt;<a name="line.1808"></a>
<span class="sourceLineNo">1809</span>     *            &lt;li&gt;When checkMode=KCV_ENCRYPT_FIX_DATA -4 bytes key check value&lt;/li&gt;<a name="line.1809"></a>
<span class="sourceLineNo">1810</span>     *            &lt;li&gt;When iCheckMode=KCV_MAC_INPUT_DATA - checkBuf as follows: checkBuf[0] = length of KcvData<a name="line.1810"></a>
<span class="sourceLineNo">1811</span>     *            checkBuf+1: kcvData checkBuf[1+kcvDataLen]: MAC computation mode<a name="line.1811"></a>
<span class="sourceLineNo">1812</span>     *            {@link #getMac(byte, byte[], byte)} checkBuf[2+kcvDataLen]:KCV length<a name="line.1812"></a>
<span class="sourceLineNo">1813</span>     *            checkBuf[3+kcvDataLen]:KCV Value&lt;/li&gt;<a name="line.1813"></a>
<span class="sourceLineNo">1814</span>     *            &lt;li&gt;When checkMode=KCV_SM4_ENCRYPT_0 -4 bytes key check value&lt;/li&gt;<a name="line.1814"></a>
<span class="sourceLineNo">1815</span>     *            &lt;/ul&gt;<a name="line.1815"></a>
<span class="sourceLineNo">1816</span>     *            &lt;/div&gt;<a name="line.1816"></a>
<span class="sourceLineNo">1817</span>     *<a name="line.1817"></a>
<span class="sourceLineNo">1818</span>     * @param keyVarIn &lt;div class="zh"&gt;由keyVarIn生成dstKeyValue。&lt;/div&gt; &lt;div class="en"&gt;dstKeyValue is generated by keyVarIn.&lt;/div&gt;<a name="line.1818"></a>
<span class="sourceLineNo">1819</span>     *<a name="line.1819"></a>
<span class="sourceLineNo">1820</span>     * @param keyVarMode &lt;div class="zh"&gt;<a name="line.1820"></a>
<span class="sourceLineNo">1821</span>     *             &lt;ul&gt;<a name="line.1821"></a>
<span class="sourceLineNo">1822</span>     *             &lt;li&gt;0x00:同{@link #writeKey}；&lt;/li&gt;<a name="line.1822"></a>
<span class="sourceLineNo">1823</span>     *             &lt;li&gt;0x01:srcKeyIndex密钥和dstKeyIndex密钥的长度都必须是16字节。<a name="line.1823"></a>
<span class="sourceLineNo">1824</span>     *             srcKeyIndex对应密钥表示SrcKey，<a name="line.1824"></a>
<span class="sourceLineNo">1825</span>     *             SrcKey的左8个字节表示为SrcKey-L。SrcKey的右边8个字节表示为SrcKey-R。<a name="line.1825"></a>
<span class="sourceLineNo">1826</span>     *             keyVarIn的左8个字节表示为keyVarIn-L。右8字节的keyVarIn表示为keyVarIn-R。<a name="line.1826"></a>
<span class="sourceLineNo">1827</span>     *             K1 = SrcKey-L XOR keyVarIn-L<a name="line.1827"></a>
<span class="sourceLineNo">1828</span>     *             K2 = SrcKey-R XOR keyVarIn-L<a name="line.1828"></a>
<span class="sourceLineNo">1829</span>     *             K3 = SrcKey-L XOR keyVarIn-R<a name="line.1829"></a>
<span class="sourceLineNo">1830</span>     *             K4 = SrcKey-R XOR keyVarIn-R<a name="line.1830"></a>
<span class="sourceLineNo">1831</span>     *             使用K1K2解密dstKeyValue的左8字节，然后使用K3K4解密dstKeyValue的右8字节；&lt;/li&gt;<a name="line.1831"></a>
<span class="sourceLineNo">1832</span>     *             &lt;li&gt;0x02:使用OWF2算法对源密钥进行解密，解密结果存储为目标密钥； &lt;/li&gt;<a name="line.1832"></a>
<span class="sourceLineNo">1833</span>     *             &lt;li&gt;0x03:dstKeyValue将由源密钥用CBC TDES算法解密并存储为目标密钥；&lt;/li&gt;<a name="line.1833"></a>
<span class="sourceLineNo">1834</span>     *             &lt;li&gt;0x04:dstKeyValue将由指定的源密钥用CBC TDES算法加密并存储为目标密钥；&lt;/li&gt;<a name="line.1834"></a>
<span class="sourceLineNo">1835</span>     *             &lt;li&gt;0x05:使用3DES ECB加密模式从destKeyValue生成普通目的密钥； &lt;/li&gt;<a name="line.1835"></a>
<span class="sourceLineNo">1836</span>     *             &lt;li&gt;0x06:源密钥通过OWF2解密dstKeyValue后再异或dstKeyValue得到目的密钥；&lt;/li&gt;<a name="line.1836"></a>
<span class="sourceLineNo">1837</span>     *             &lt;li&gt;0x07:源密钥通过GOWF(OWF3)模式解密dstKeyValue得到目的密钥；&lt;/li&gt;<a name="line.1837"></a>
<span class="sourceLineNo">1838</span>     *             &lt;/ul&gt;<a name="line.1838"></a>
<span class="sourceLineNo">1839</span>     *             &lt;/div&gt; &lt;div class="en"&gt;<a name="line.1839"></a>
<span class="sourceLineNo">1840</span>     *             &lt;ul&gt;<a name="line.1840"></a>
<span class="sourceLineNo">1841</span>     *             &lt;li&gt;0x00:like {@link #writeKey};&lt;/li&gt;<a name="line.1841"></a>
<span class="sourceLineNo">1842</span>     *             &lt;li&gt;0x01:Both the srcKeyIndex key and dstKeyIndex key must be 16 bytes in length.<a name="line.1842"></a>
<span class="sourceLineNo">1843</span>     *             SrcKeyIndex corresponds to the key SrcKey, and the left 8 bytes of the SrcKey are represented as Srckey-L.<a name="line.1843"></a>
<span class="sourceLineNo">1844</span>     *             The 8 bytes to the right of the SrcKey are represented as Srckey-R.<a name="line.1844"></a>
<span class="sourceLineNo">1845</span>     *             The left 8 bytes of keyVarIn are represented as keyvarin-L.The right 8-byte keyVarIn is represented as keyvarin-R.<a name="line.1845"></a>
<span class="sourceLineNo">1846</span>     *             K1 = SrcKey-L XOR keyVarIn-L<a name="line.1846"></a>
<span class="sourceLineNo">1847</span>     *             K2 = SrcKey-R XOR keyVarIn-L<a name="line.1847"></a>
<span class="sourceLineNo">1848</span>     *             K3 = SrcKey-L XOR keyVarIn-R<a name="line.1848"></a>
<span class="sourceLineNo">1849</span>     *             K4 = SrcKey-R XOR keyVarIn-R<a name="line.1849"></a>
<span class="sourceLineNo">1850</span>     *             Decrypt the left 8 bytes of dstKeyValue with K1K2, and then decrypt the right 8 bytes of dstKeyValue with K3K4;&lt;/li&gt;<a name="line.1850"></a>
<span class="sourceLineNo">1851</span>     *             &lt;li&gt;0x02:The source key is decrypted using the OWF2 algorithm, and the decryption result is stored as the target key;&lt;/li&gt;<a name="line.1851"></a>
<span class="sourceLineNo">1852</span>     *             &lt;li&gt;0x03:The dstKeyValue will be decrypted by the source key using the CBC TDES algorithm and stored as the target key;&lt;/li&gt;<a name="line.1852"></a>
<span class="sourceLineNo">1853</span>     *             &lt;li&gt;0x04:The dstKeyValue will be encrypted by the specified source key with the CBC TDES algorithm and stored as the target key;&lt;/li&gt;<a name="line.1853"></a>
<span class="sourceLineNo">1854</span>     *             &lt;li&gt;0x05:Generate the general purpose key from dstKeyValue using 3DES ECB encryption mode;&lt;/li&gt;<a name="line.1854"></a>
<span class="sourceLineNo">1855</span>     *             &lt;li&gt;0x06:The source key uses OWF2 to decrypt the dstKeyValue and then xOR dstKeyValue to obtain the target key;&lt;/li&gt;<a name="line.1855"></a>
<span class="sourceLineNo">1856</span>     *             &lt;li&gt;0x07:The source key uses GOWF(OWF3) mode to decrypt the dstKeyValue to obtain the target key&lt;/li&gt;<a name="line.1856"></a>
<span class="sourceLineNo">1857</span>     *             &lt;/ul&gt;<a name="line.1857"></a>
<span class="sourceLineNo">1858</span>     *             &lt;/div&gt;<a name="line.1858"></a>
<span class="sourceLineNo">1859</span>     *<a name="line.1859"></a>
<span class="sourceLineNo">1860</span>     * @throws PedDevException<a name="line.1860"></a>
<span class="sourceLineNo">1861</span>     * @since V4.00.00<a name="line.1861"></a>
<span class="sourceLineNo">1862</span>     */<a name="line.1862"></a>
<span class="sourceLineNo">1863</span>    void writeKeyEx(byte srcKeyType, byte srcKeyIndex, byte dstKeyType, byte dstKeyIndex,<a name="line.1863"></a>
<span class="sourceLineNo">1864</span>                    byte[] dstKeyValue, ECheckMode checkMode, byte[] checkBuf, byte[] keyVarIn, byte keyVarMode) throws PedDevException;<a name="line.1864"></a>
<span class="sourceLineNo">1865</span><a name="line.1865"></a>
<span class="sourceLineNo">1866</span><a name="line.1866"></a>
<span class="sourceLineNo">1867</span>    /**<a name="line.1867"></a>
<span class="sourceLineNo">1868</span>     * &lt;div class="zh"&gt;使用AES_TAK对DataIn用Mode指定的算法进行MAC运算，将16字节的MAC结果输出， MAC运算密钥是主密钥/工作密钥体系或固定密钥体系密钥或DUKPT密钥体系。<a name="line.1868"></a>
<span class="sourceLineNo">1869</span>     *                  &lt;br/&gt;用法：<a name="line.1869"></a>
<span class="sourceLineNo">1870</span>     *                  &lt;br/&gt;1.敏感服务授权：在此接口内部，先进行认证以获取敏感服务授权，若授权失败则退出。<a name="line.1870"></a>
<span class="sourceLineNo">1871</span>     *                  &lt;br/&gt;2.补零规则：将报文数据分割成若干16个字节的BLOCK，最后一个BLOCK不满16个字节则后补0x00。&lt;/div&gt;<a name="line.1871"></a>
<span class="sourceLineNo">1872</span>     * &lt;div class="en"&gt;Use AES_TAK to perform MAC operation on dataIn with the algorithm specified by Mode, and output the 16-byte MAC result.<a name="line.1872"></a>
<span class="sourceLineNo">1873</span>     * The MAC operation key is the master key/working key system or fixed key system key or DUKPT key system.<a name="line.1873"></a>
<span class="sourceLineNo">1874</span>     *                  &lt;br/&gt;usage:<a name="line.1874"></a>
<span class="sourceLineNo">1875</span>     *                  &lt;br/&gt;1.Sensitive service authorization: In this interface, first perform authentication to obtain sensitive service authorization,<a name="line.1875"></a>
<span class="sourceLineNo">1876</span>     *                  and exit if authorization fails.<a name="line.1876"></a>
<span class="sourceLineNo">1877</span>     *                  &lt;br/&gt;2.Zero-filling rule: divide the message data into 16-byte BLOCKs, and add 0x00 after the last BLOCK is less than 16 bytes.&lt;/div&gt;<a name="line.1877"></a>
<span class="sourceLineNo">1878</span>     *<a name="line.1878"></a>
<span class="sourceLineNo">1879</span>     * @param keyIdx &lt;div class="zh"&gt;AES_TAK 1~100索引&lt;/div&gt;<a name="line.1879"></a>
<span class="sourceLineNo">1880</span>     *                 &lt;div class="en"&gt;AES_TAK 1~100 index&lt;/div&gt;<a name="line.1880"></a>
<span class="sourceLineNo">1881</span>     * @param dataIn  &lt;div class="zh"&gt;需进行 MAC 运算的数据包. 长度InLen&lt;=2048，长度不能被16整除时，则自动补0x00&lt;/div&gt;<a name="line.1881"></a>
<span class="sourceLineNo">1882</span>     *                &lt;div class="en"&gt;Data packet that needs MAC operation. Length&lt;=2048, when the length is not divisible by 16, it will automatically add 0x00&lt;/div&gt;<a name="line.1882"></a>
<span class="sourceLineNo">1883</span>     * @param mode &lt;div class="zh"&gt;<a name="line.1883"></a>
<span class="sourceLineNo">1884</span>     *             &lt;ul&gt;<a name="line.1884"></a>
<span class="sourceLineNo">1885</span>     *             &lt;li&gt;0x00: 将BLOCK1用MAC密钥做AES加密，加密结果与BLOCK2进行逐位异或后再用MAC密钥做AES加密，依次进行得到16字节的加密结果， KSN不自动加1。&lt;/li&gt;<a name="line.1885"></a>
<span class="sourceLineNo">1886</span>     *             &lt;li&gt;0x01: Hypercom Fast Mode，将BLOCK1和BLOCK2进行逐位异或，异或结果与BLOCK3进行逐位异或，依次进行，最后得到16字节的异或结果，将该结果用MAC密钥进行AES加密运算，KSN不自动加1。&lt;/li&gt;<a name="line.1886"></a>
<span class="sourceLineNo">1887</span>     *             &lt;li&gt;0x03: CMAC算法，KSN不自动加1。&lt;/li&gt;<a name="line.1887"></a>
<span class="sourceLineNo">1888</span>     *             &lt;li&gt;0x05: HMAC-SHA256算法，KSN不自动加1。&lt;/li&gt;<a name="line.1888"></a>
<span class="sourceLineNo">1889</span>     *             &lt;/ul&gt;&lt;/div&gt;<a name="line.1889"></a>
<span class="sourceLineNo">1890</span>     *             &lt;div class="en"&gt;<a name="line.1890"></a>
<span class="sourceLineNo">1891</span>     *             &lt;ul&gt;<a name="line.1891"></a>
<span class="sourceLineNo">1892</span>     *             &lt;li&gt;0x00: Use MAC key for AES encryption of BLOCK1, and perform bitwise XOR between the encrypted result and BLOCK2 and then use MAC key for AES encryption.<a name="line.1892"></a>
<span class="sourceLineNo">1893</span>     *             The 16-byte encryption result is obtained in sequence, and KSN does not automatically add 1.&lt;/li&gt;<a name="line.1893"></a>
<span class="sourceLineNo">1894</span>     *             &lt;li&gt;0x01: Hypercom Fast Mode, XOR BLOCK1 and BLOCK2 bit by bit, XOR result and BLOCK3 bit by bit XOR, in turn, finally get a 16-byte XOR result, the result is encrypted with MAC key AES Operation,<a name="line.1894"></a>
<span class="sourceLineNo">1895</span>     *             KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.1895"></a>
<span class="sourceLineNo">1896</span>     *             &lt;li&gt;0x03: CMAC algorithm, KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.1896"></a>
<span class="sourceLineNo">1897</span>     *             &lt;li&gt;0x05: HMAC-SHA256 algorithm, KSN does not automatically increase by 1.&lt;/li&gt;<a name="line.1897"></a>
<span class="sourceLineNo">1898</span>     *             &lt;/ul&gt;&lt;/div&gt;<a name="line.1898"></a>
<span class="sourceLineNo">1899</span>     * @return &lt;div class="zh"&gt;MAC输出，模式5的时候是32字节输出，其他模式16字节输出&lt;/div&gt;<a name="line.1899"></a>
<span class="sourceLineNo">1900</span>     *         &lt;div class="en"&gt;MAC output, 32-byte output in mode 5, 16-byte output in other modes&lt;/div&gt;<a name="line.1900"></a>
<span class="sourceLineNo">1901</span>     * @throws PedDevException PedDevException<a name="line.1901"></a>
<span class="sourceLineNo">1902</span>     * @since V4.00.00<a name="line.1902"></a>
<span class="sourceLineNo">1903</span>     */<a name="line.1903"></a>
<span class="sourceLineNo">1904</span>    byte[] getMacAes(byte keyIdx, byte[] dataIn, byte mode) throws PedDevException;<a name="line.1904"></a>
<span class="sourceLineNo">1905</span><a name="line.1905"></a>
<span class="sourceLineNo">1906</span><a name="line.1906"></a>
<span class="sourceLineNo">1907</span>    /**<a name="line.1907"></a>
<span class="sourceLineNo">1908</span>     * &lt;div class="zh"&gt;往PED中注入一个密钥&lt;/div&gt;<a name="line.1908"></a>
<span class="sourceLineNo">1909</span>     * &lt;div class="en"&gt;Inject a key into the PED.&lt;/div&gt;<a name="line.1909"></a>
<span class="sourceLineNo">1910</span>     *<a name="line.1910"></a>
<span class="sourceLineNo">1911</span>     * @param format &lt;div class="zh"&gt;固定式:0x08&lt;/div&gt;<a name="line.1911"></a>
<span class="sourceLineNo">1912</span>     *                 &lt;div class="en"&gt;Fixed: 0x08&lt;/div&gt;<a name="line.1912"></a>
<span class="sourceLineNo">1913</span>     * @param srcKeyType  &lt;div class="zh"&gt;源密钥类型:<a name="line.1913"></a>
<span class="sourceLineNo">1914</span>     *                    &lt;ul&gt;<a name="line.1914"></a>
<span class="sourceLineNo">1915</span>     *                    &lt;li&gt;0x01: TLK&lt;/li&gt;<a name="line.1915"></a>
<span class="sourceLineNo">1916</span>     *                    &lt;li&gt;0x02: TMK&lt;/li&gt;<a name="line.1916"></a>
<span class="sourceLineNo">1917</span>     *                    &lt;li&gt;0x21: AES_TLK&lt;/li&gt;<a name="line.1917"></a>
<span class="sourceLineNo">1918</span>     *                    &lt;li&gt;0x22: AES_TMK&lt;/li&gt;<a name="line.1918"></a>
<span class="sourceLineNo">1919</span>     *                    &lt;/ul&gt;&lt;/div&gt;<a name="line.1919"></a>
<span class="sourceLineNo">1920</span>     *                &lt;div class="en"&gt;source key type:<a name="line.1920"></a>
<span class="sourceLineNo">1921</span>     *                    &lt;ul&gt;<a name="line.1921"></a>
<span class="sourceLineNo">1922</span>     *                    &lt;li&gt;0x01: TLK&lt;/li&gt;<a name="line.1922"></a>
<span class="sourceLineNo">1923</span>     *                    &lt;li&gt;0x02: TMK&lt;/li&gt;<a name="line.1923"></a>
<span class="sourceLineNo">1924</span>     *                    &lt;li&gt;0x21: AES_TLK&lt;/li&gt;<a name="line.1924"></a>
<span class="sourceLineNo">1925</span>     *                    &lt;li&gt;0x22: AES_TMK&lt;/li&gt;<a name="line.1925"></a>
<span class="sourceLineNo">1926</span>     *                    &lt;/ul&gt;&lt;/div&gt;<a name="line.1926"></a>
<span class="sourceLineNo">1927</span>     * @param srcKeyIdx &lt;div class="zh"&gt;源密钥索引.源密钥是TLK/PED_AES_TLK时，索引为1.源密钥是TMK/PED_AES_TMK时，索引为1-100&lt;/div&gt;<a name="line.1927"></a>
<span class="sourceLineNo">1928</span>     *                  &lt;div class="en"&gt;Source key index. When the source key is TLK/PED_AES_TLK, the index is 1. When the source key is TMK/PED_AES_TMK, the index is 1-100&lt;/div&gt;<a name="line.1928"></a>
<span class="sourceLineNo">1929</span>     *<a name="line.1929"></a>
<span class="sourceLineNo">1930</span>     * @param dstKeyIdx &lt;div class="zh"&gt;目的密钥索引<a name="line.1930"></a>
<span class="sourceLineNo">1931</span>     *                  &lt;ul&gt;<a name="line.1931"></a>
<span class="sourceLineNo">1932</span>     *                  &lt;li&gt;TMK [1~100]&lt;/li&gt;<a name="line.1932"></a>
<span class="sourceLineNo">1933</span>     *                  &lt;li&gt;TPK [1~100]&lt;/li&gt;<a name="line.1933"></a>
<span class="sourceLineNo">1934</span>     *                  &lt;li&gt;TAK [1~100]&lt;/li&gt;<a name="line.1934"></a>
<span class="sourceLineNo">1935</span>     *                  &lt;li&gt;TDK [1~100]&lt;/li&gt;<a name="line.1935"></a>
<span class="sourceLineNo">1936</span>     *                  &lt;li&gt;TCHDK [1~100]&lt;/li&gt;<a name="line.1936"></a>
<span class="sourceLineNo">1937</span>     *                  &lt;li&gt;TIK [1~100]&lt;/li&gt;<a name="line.1937"></a>
<span class="sourceLineNo">1938</span>     *                  &lt;li&gt;AES_TMK [1~100]&lt;/li&gt;<a name="line.1938"></a>
<span class="sourceLineNo">1939</span>     *                  &lt;li&gt;AES_TPK [1~100]&lt;/li&gt;<a name="line.1939"></a>
<span class="sourceLineNo">1940</span>     *                  &lt;li&gt;AES_TAK [1~100]&lt;/li&gt;<a name="line.1940"></a>
<span class="sourceLineNo">1941</span>     *                  &lt;li&gt;AES_TDK [1~100]&lt;/li&gt;<a name="line.1941"></a>
<span class="sourceLineNo">1942</span>     *                  &lt;li&gt;AES_TCHDK [1~100]&lt;/li&gt;<a name="line.1942"></a>
<span class="sourceLineNo">1943</span>     *                  &lt;li&gt;AES_TIK [1~100]&lt;/li&gt;<a name="line.1943"></a>
<span class="sourceLineNo">1944</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1944"></a>
<span class="sourceLineNo">1945</span>     *                  &lt;div class="en"&gt;destination key index<a name="line.1945"></a>
<span class="sourceLineNo">1946</span>     *                  &lt;ul&gt;<a name="line.1946"></a>
<span class="sourceLineNo">1947</span>     *                  &lt;li&gt;TMK [1~100]&lt;/li&gt;<a name="line.1947"></a>
<span class="sourceLineNo">1948</span>     *                  &lt;li&gt;TPK [1~100]&lt;/li&gt;<a name="line.1948"></a>
<span class="sourceLineNo">1949</span>     *                  &lt;li&gt;TAK [1~100]&lt;/li&gt;<a name="line.1949"></a>
<span class="sourceLineNo">1950</span>     *                  &lt;li&gt;TDK [1~100]&lt;/li&gt;<a name="line.1950"></a>
<span class="sourceLineNo">1951</span>     *                  &lt;li&gt;TCHDK [1~100]&lt;/li&gt;<a name="line.1951"></a>
<span class="sourceLineNo">1952</span>     *                  &lt;li&gt;TIK [1~100]&lt;/li&gt;<a name="line.1952"></a>
<span class="sourceLineNo">1953</span>     *                  &lt;li&gt;AES_TMK [1~100]&lt;/li&gt;<a name="line.1953"></a>
<span class="sourceLineNo">1954</span>     *                  &lt;li&gt;AES_TPK [1~100]&lt;/li&gt;<a name="line.1954"></a>
<span class="sourceLineNo">1955</span>     *                  &lt;li&gt;AES_TAK [1~100]&lt;/li&gt;<a name="line.1955"></a>
<span class="sourceLineNo">1956</span>     *                  &lt;li&gt;AES_TDK [1~100]&lt;/li&gt;<a name="line.1956"></a>
<span class="sourceLineNo">1957</span>     *                  &lt;li&gt;AES_TCHDK [1~100]&lt;/li&gt;<a name="line.1957"></a>
<span class="sourceLineNo">1958</span>     *                  &lt;li&gt;AES_TIK [1~100]&lt;/li&gt;<a name="line.1958"></a>
<span class="sourceLineNo">1959</span>     *                  &lt;/ul&gt;&lt;/div&gt;<a name="line.1959"></a>
<span class="sourceLineNo">1960</span>     * @param keyBlock &lt;div class="zh"&gt;长度16-256,格式如下:&lt;br&gt;<a name="line.1960"></a>
<span class="sourceLineNo">1961</span>     *                 VersionID+Length+Usage+Algorithm+Mode+VersionNumber+Exportability+Number of Optional Blocks+ Reserved+Optional Blocks+Encryption body+MAC<a name="line.1961"></a>
<span class="sourceLineNo">1962</span>     *                 &lt;ul&gt;<a name="line.1962"></a>
<span class="sourceLineNo">1963</span>     *                 &lt;li&gt;VersionID:密钥块版本标识,1byte,'B'-TDEA,'D'-AES&lt;/li&gt;<a name="line.1963"></a>
<span class="sourceLineNo">1964</span>     *                 &lt;li&gt;Length:密钥块长度,4byte,十进制ASCII表示&lt;/li&gt;<a name="line.1964"></a>
<span class="sourceLineNo">1965</span>     *                 &lt;li&gt;Usage:密钥类型，2byte,'P0'-PIN encryption,'B1'-DUKPT TIK,'K0'-TMK,'D0'-TDK,'Mx'-TAK,'C1'-TCHDK,'99'-TSK&lt;/li&gt;<a name="line.1965"></a>
<span class="sourceLineNo">1966</span>     *                 &lt;li&gt;Algorithm:密钥算法,1byte,'T'-TDEA,'A'-AES&lt;/li&gt;<a name="line.1966"></a>
<span class="sourceLineNo">1967</span>     *                 &lt;li&gt;Mode:密钥使用方式,1byte,忽略&lt;/li&gt;<a name="line.1967"></a>
<span class="sourceLineNo">1968</span>     *                 &lt;li&gt;VersionNumber:密钥版本,2byte,忽略&lt;/li&gt;<a name="line.1968"></a>
<span class="sourceLineNo">1969</span>     *                 &lt;li&gt;Exportability:输出,1byte,忽略&lt;/li&gt;<a name="line.1969"></a>
<span class="sourceLineNo">1970</span>     *                 &lt;li&gt;Number of Optional Blocks:可选块个数,2byte,00/01/02&lt;/li&gt;<a name="line.1970"></a>
<span class="sourceLineNo">1971</span>     *                 &lt;li&gt;Reserved:保留域.2byte,忽略&lt;/li&gt;<a name="line.1971"></a>
<span class="sourceLineNo">1972</span>     *                 &lt;li&gt;Optional Blocks:可选块，长度是8('B'/TDES)或者16('D'/AES)的倍数，不足时需补充填充块以满足要求&lt;/li&gt;<a name="line.1972"></a>
<span class="sourceLineNo">1973</span>     *                 &lt;li&gt;Encryption body:密文块，2byte+key+padding&lt;/li&gt;<a name="line.1973"></a>
<span class="sourceLineNo">1974</span>     *                 &lt;li&gt;MAC:TDES是16byte， AES是32byte&lt;/li&gt;<a name="line.1974"></a>
<span class="sourceLineNo">1975</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.1975"></a>
<span class="sourceLineNo">1976</span>     *             &lt;div class="en"&gt;Length 16-256, the format is as follows:&lt;br&gt;<a name="line.1976"></a>
<span class="sourceLineNo">1977</span>     *                 VersionID+Length+Usage+Algorithm+Mode+VersionNumber+Exportability+Number of Optional Blocks+ Reserved+Optional Blocks+Encryption body+MAC<a name="line.1977"></a>
<span class="sourceLineNo">1978</span>     *                 &lt;ul&gt;<a name="line.1978"></a>
<span class="sourceLineNo">1979</span>     *                 &lt;li&gt;VersionID: key block version identifier,1byte, 'B'-TDEA,'D'-AES&lt;/li&gt;<a name="line.1979"></a>
<span class="sourceLineNo">1980</span>     *                 &lt;li&gt;Length: key block length, 4byte,十进制ASCII表示&lt;/li&gt;<a name="line.1980"></a>
<span class="sourceLineNo">1981</span>     *                 &lt;li&gt;Usage: key type，2byte,'P0'-PIN encryption,'B1'-DUKPT TIK,'K0'-TMK,'D0'-TDK,'Mx'-TAK,'C1'-TCHDK,'99'-TSK&lt;/li&gt;<a name="line.1981"></a>
<span class="sourceLineNo">1982</span>     *                 &lt;li&gt;Algorithm: key algorithm, 1byte,'T'-TDEA,'A'-AES&lt;/li&gt;<a name="line.1982"></a>
<span class="sourceLineNo">1983</span>     *                 &lt;li&gt;Mode: key Usage, 1byte, ignorable&lt;/li&gt;<a name="line.1983"></a>
<span class="sourceLineNo">1984</span>     *                 &lt;li&gt;VersionNumber: key version,2byte, ignorable&lt;/li&gt;<a name="line.1984"></a>
<span class="sourceLineNo">1985</span>     *                 &lt;li&gt;Exportability: output, 1byte, ignorable&lt;/li&gt;<a name="line.1985"></a>
<span class="sourceLineNo">1986</span>     *                 &lt;li&gt;Number of Optional Blocks: number of optional blocks, 2byte,00/01/02&lt;/li&gt;<a name="line.1986"></a>
<span class="sourceLineNo">1987</span>     *                 &lt;li&gt;Reserved: reserved domain. 2byte, ignorable&lt;/li&gt;<a name="line.1987"></a>
<span class="sourceLineNo">1988</span>     *                 &lt;li&gt;Optional Blocks:Optional blocks, the length is a multiple of 8('B'/TDES) or 16('D'/AES), if insufficient, fill blocks are required to meet the requirements&lt;/li&gt;<a name="line.1988"></a>
<span class="sourceLineNo">1989</span>     *                 &lt;li&gt;Encryption body: ciphertext block，2byte+key+padding&lt;/li&gt;<a name="line.1989"></a>
<span class="sourceLineNo">1990</span>     *                 &lt;li&gt;MAC: TDES is 16byte, AES is 32byte&lt;/li&gt;<a name="line.1990"></a>
<span class="sourceLineNo">1991</span>     *                 &lt;/ul&gt;&lt;/div&gt;<a name="line.1991"></a>
<span class="sourceLineNo">1992</span>     *<a name="line.1992"></a>
<span class="sourceLineNo">1993</span>     *<a name="line.1993"></a>
<span class="sourceLineNo">1994</span>     * @throws PedDevException PedDevException<a name="line.1994"></a>
<span class="sourceLineNo">1995</span>     * @since V4.00.00<a name="line.1995"></a>
<span class="sourceLineNo">1996</span>     */<a name="line.1996"></a>
<span class="sourceLineNo">1997</span>    void injectKeyBlock(byte format, byte srcKeyType, byte srcKeyIdx, byte dstKeyIdx, byte[] keyBlock) throws PedDevException;<a name="line.1997"></a>
<span class="sourceLineNo">1998</span><a name="line.1998"></a>
<span class="sourceLineNo">1999</span><a name="line.1999"></a>
<span class="sourceLineNo">2000</span>}<a name="line.2000"></a>




























































</pre>
</div>
</body>
</html>
